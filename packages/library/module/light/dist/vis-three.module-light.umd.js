(function(n,d){typeof exports=="object"&&typeof module<"u"?d(exports,require("@vis-three/tdcm"),require("three"),require("@vis-three/module-object"),require("@vis-three/core")):typeof define=="function"&&define.amd?define(["exports","@vis-three/tdcm","three","@vis-three/module-object","@vis-three/core"],d):(n=typeof globalThis<"u"?globalThis:n||self,d((n["vis-three"]=n["vis-three"]||{},n["vis-three"]["module-light"]={}),n.tdcm,n.three,n.moduleObject,n.core))})(this,function(n,d,s,p,w){"use strict";const u=function(){return Object.assign(p.getObjectConfig(),{type:"Light",color:"rgb(255, 255, 255)",intensity:1})},f=function(r){return Object.assign(u(),{shadow:{bias:0,normalBias:0,radius:1,mapSize:{x:512,y:512},camera:r}})},l=function(){return Object.assign(p.getObjectConfig(),{color:"rgb(255, 255, 255)",intensity:1})},m=function(){return Object.assign(f({fov:90,aspect:1,near:.5,far:500}),{distance:30,decay:.01})},L=function(){return Object.assign(f({fov:50,aspect:1,near:.5,far:500}),{distance:30,angle:Math.PI/180*45,penumbra:.01,decay:.01,target:""})},y=function(){return Object.assign(f({near:.5,far:500,top:window.innerHeight,bottom:-window.innerHeight,left:-window.innerWidth,right:window.innerWidth}),{})},C=function(){return Object.assign(u(),{color:"rgb(255, 255, 255)",groundColor:"rgb(0, 0, 0)"})},S=function(){return Object.assign(u(),{width:10,height:10})},g=p.defineObjectModel.extend(r=>({shared:{cacheMapSize:new s.Vector2,cacheViewportSize:new s.Vector2,updateShadowSize(e,o,i){const t=this.cacheMapSize,a=this.cacheViewportSize,h=e.shadow;e.shadow.mapSize.set(o.shadow.mapSize.x,o.shadow.mapSize.y),t.copy(h.mapSize);const c=h.getFrameExtents();t.multiply(c),a.copy(h.mapSize),(t.x>i||t.y>i)&&(t.x>i&&(a.x=Math.floor(i/c.x),t.x=a.x*c.x,h.mapSize.x=a.x),t.y>i&&(a.y=Math.floor(i/c.y),t.y=a.y*c.y,h.mapSize.y=a.y)),e.shadow.map.setSize(t.x,t.y)}},context(){return{cacheColor:new s.Color}},commands:{set:{color({model:e,target:o,value:i}){o.color.copy(e.cacheColor.set(i))},scale:d.emptyHandler,rotation:d.emptyHandler,lookAt:d.emptyHandler,shadow:{mapSize({model:e,target:o,config:i,engine:t,key:a,value:h}){o.shadow.mapSize[a]=h,e.updateShadowSize(o,i,t.webGLRenderer.capabilities.maxTextureSize)},camera({target:e,key:o,value:i}){e.shadow.camera[o]=i,e.shadow.camera.updateProjectionMatrix()}}}},create({model:e,light:o,config:i,filter:t,engine:a,shadow:h}){if(o.color.copy(e.cacheColor.set(i.color)),h){const c=i,b=()=>{o.shadow.map&&(e.updateShadowSize(o,c,a.webGLRenderer.capabilities.maxTextureSize),a.renderManager.removeEventListener(w.ENGINE_EVENT.RENDER,b))};if(a.renderManager.addEventListener(w.ENGINE_EVENT.RENDER,b),c.shadow){for(const E in c.shadow.camera)o.shadow.camera[E]=c.shadow.camera[E];o.shadow.camera.updateProjectionMatrix()}}r.create({model:e,target:o,config:i,filter:{color:!0,scale:!0,rotation:!0,lookAt:!0,shadow:{mapSize:!0,camera:!0},...t},engine:a})},dispose(e){r.dispose(e)}})),j=g(r=>({type:"AmbientLight",config:l,create({model:e,config:o,engine:i}){const t=new s.AmbientLight;return r.create({model:e,light:t,config:o,filter:{},engine:i,shadow:!1}),t},dispose({target:e}){r.dispose(e)}})),z=g(r=>({type:"DirectionalLight",config:y,create({model:e,config:o,engine:i}){const t=new s.DirectionalLight;return r.create({model:e,light:t,config:o,filter:{},engine:i,shadow:!0}),t},dispose({target:e}){r.dispose(e)}})),v=g(r=>({type:"HemisphereLight",config:C,shared:{cacheColor:new s.Color},commands:{set:{groundColor({model:e,target:o,value:i}){o.groundColor.copy(e.cacheColor.set(i))}}},create({model:e,config:o,engine:i}){const t=new s.HemisphereLight;return t.groundColor.copy(e.cacheColor.set(o.groundColor)),r.create({model:e,light:t,config:o,filter:{groundColor:!0},engine:i,shadow:!1}),t},dispose({target:e}){r.dispose(e)}})),M=g(r=>({type:"PointLight",config:m,create({model:e,config:o,engine:i}){const t=new s.PointLight;return r.create({model:e,light:t,config:o,filter:{},engine:i,shadow:!0}),t},dispose({target:e}){r.dispose(e)}})),O=g(r=>({type:"RectAreaLight",config:S,commands:{set:{rotation:void 0}},create({model:e,config:o,engine:i}){const t=new s.RectAreaLight;return t.rotation.set(o.rotation.x,o.rotation.y,o.rotation.z),t.updateMatrixWorld(),r.create({model:e,light:t,config:o,filter:{},engine:i,shadow:!0}),t},dispose({target:e}){r.dispose(e)}})),R=g(r=>({type:"SpotLight",config:L,create({model:e,config:o,engine:i}){const t=new s.SpotLight;let a={model:e,light:t,config:o,filter:{target:!0},engine:i,shadow:!0};return o.target?e.toTrigger("object",()=>{t.target=i.getObject3D(o.target),a.light=t,r.create(a)}):r.create(a),t},dispose({target:e}){r.dispose(e)}})),A=d.defineModule({type:"light",object:!0,models:[j,z,v,M,O,R],lifeOrder:d.SUPPORT_LIFE_CYCLE.THREE});n.default=A,n.getAmbientLightConfig=l,n.getDirectionalLightConfig=y,n.getHemisphereLightConfig=C,n.getPointLightConfig=m,n.getRectAreaLightConfig=S,n.getSpotLightConfig=L,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
