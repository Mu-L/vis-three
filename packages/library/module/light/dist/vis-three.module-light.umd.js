(function(n,h){typeof exports=="object"&&typeof module<"u"?h(exports,require("@vis-three/tdcm"),require("three"),require("@vis-three/module-object"),require("@vis-three/core")):typeof define=="function"&&define.amd?define(["exports","@vis-three/tdcm","three","@vis-three/module-object","@vis-three/core"],h):(n=typeof globalThis<"u"?globalThis:n||self,h((n["vis-three"]=n["vis-three"]||{},n["vis-three"]["module-light"]={}),n.tdcm,n.three,n.moduleObject,n.core))})(this,function(n,h,c,p,w){"use strict";const u=function(){return Object.assign(p.getObjectConfig(),{type:"Light",color:"rgb(255, 255, 255)",intensity:1})},f=function(r){return Object.assign(u(),{shadow:{bias:0,normalBias:0,radius:1,mapSize:{x:512,y:512},camera:r}})},l=function(){return Object.assign(p.getObjectConfig(),{color:"rgb(255, 255, 255)",intensity:1})},m=function(){return Object.assign(f({fov:90,aspect:1,near:.5,far:500}),{distance:30,decay:.01})},L=function(){return Object.assign(f({fov:50,aspect:1,near:.5,far:500}),{distance:30,angle:Math.PI/180*45,penumbra:.01,decay:.01,target:""})},y=function(){return Object.assign(f({near:.5,far:500,top:window.innerHeight,bottom:-window.innerHeight,left:-window.innerWidth,right:window.innerWidth}),{})},C=function(){return Object.assign(u(),{color:"rgb(255, 255, 255)",groundColor:"rgb(0, 0, 0)"})},S=function(){return Object.assign(u(),{width:10,height:10})},g=p.defineObjectModel.extend(r=>({shared:{cacheMapSize:new c.Vector2,cacheViewportSize:new c.Vector2,updateShadowSize(e,t,i){const o=this.cacheMapSize,a=this.cacheViewportSize,s=e.shadow;e.shadow.mapSize.set(t.shadow.mapSize.x,t.shadow.mapSize.y),o.copy(s.mapSize);const d=s.getFrameExtents();o.multiply(d),a.copy(s.mapSize),(o.x>i||o.y>i)&&(o.x>i&&(a.x=Math.floor(i/d.x),o.x=a.x*d.x,s.mapSize.x=a.x),o.y>i&&(a.y=Math.floor(i/d.y),o.y=a.y*d.y,s.mapSize.y=a.y)),e.shadow.map.setSize(o.x,o.y)}},context(){return{cacheColor:new c.Color}},commands:{set:{color({model:e,target:t,value:i}){t.color.copy(e.cacheColor.set(i))},scale:h.emptyHandler,rotation:h.emptyHandler,lookAt:h.emptyHandler,shadow:{mapSize({model:e,target:t,config:i,engine:o,key:a,value:s}){t.shadow.mapSize[a]=s,e.updateShadowSize(t,i,o.webGLRenderer.capabilities.maxTextureSize)},camera({target:e,key:t,value:i}){e.shadow.camera[t]=i,e.shadow.camera.updateProjectionMatrix()}}}},create({model:e,light:t,config:i,filter:o,engine:a,shadow:s}){if(t.color.copy(e.cacheColor.set(i.color)),s){const d=i,b=()=>{t.shadow.map&&(e.updateShadowSize(t,d,a.webGLRenderer.capabilities.maxTextureSize),a.renderManager.removeEventListener(w.ENGINE_EVENT.RENDER,b))};if(a.renderManager.addEventListener(w.ENGINE_EVENT.RENDER,b),d.shadow){for(const j in d.shadow.camera)t.shadow.camera[j]=d.shadow.camera[j];t.shadow.camera.updateProjectionMatrix()}}r.create({model:e,target:t,config:i,filter:{color:!0,scale:!0,rotation:!0,lookAt:!0,shadow:{mapSize:!0,camera:!0},...o},engine:a})},dispose(e){r.dispose(e)}})),E=g(r=>({type:"AmbientLight",config:l,create({model:e,config:t,engine:i}){const o=new c.AmbientLight;return r.create({model:e,light:o,config:t,filter:{},engine:i,shadow:!1}),o},dispose({target:e}){r.dispose(e)}})),z=g(r=>({type:"DirectionalLight",config:y,create({model:e,config:t,engine:i}){const o=new c.DirectionalLight;return r.create({model:e,light:o,config:t,filter:{},engine:i,shadow:!0}),o},dispose({target:e}){r.dispose(e)}})),v=g(r=>({type:"HemisphereLight",config:C,shared:{cacheColor:new c.Color},commands:{set:{groundColor({model:e,target:t,value:i}){t.groundColor.copy(e.cacheColor.set(i))}}},create({model:e,config:t,engine:i}){const o=new c.HemisphereLight;return o.groundColor.copy(e.cacheColor.set(t.groundColor)),r.create({model:e,light:o,config:t,filter:{groundColor:!0},engine:i,shadow:!1}),o},dispose({target:e}){r.dispose(e)}})),O=g(r=>({type:"PointLight",config:m,create({model:e,config:t,engine:i}){const o=new c.PointLight;return r.create({model:e,light:o,config:t,filter:{},engine:i,shadow:!0}),o},dispose({target:e}){r.dispose(e)}})),M=g(r=>({type:"RectAreaLight",config:S,commands:{set:{rotation:void 0}},create({model:e,config:t,engine:i}){const o=new c.RectAreaLight;return o.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z),o.updateMatrixWorld(),r.create({model:e,light:o,config:t,filter:{},engine:i,shadow:!0}),o},dispose({target:e}){r.dispose(e)}})),R=g(r=>({type:"SpotLight",config:L,create({model:e,config:t,engine:i}){const o=new c.SpotLight;let a={model:e,light:o,config:t,filter:{target:!0},engine:i,shadow:!0};return t.target?e.toTrigger("object",()=>{const s=i.getObject3D(t.target);s?(o.target=s,a.light=o):console.error("SpotLight model: can not found vid object in engine",t.target),r.create(a)}):r.create(a),o},dispose({target:e}){r.dispose(e)}})),A=h.defineModule({type:"light",object:!0,models:[E,z,v,O,M,R],lifeOrder:h.SUPPORT_LIFE_CYCLE.THREE});n.default=A,n.getAmbientLightConfig=l,n.getDirectionalLightConfig=y,n.getHemisphereLightConfig=C,n.getPointLightConfig=m,n.getRectAreaLightConfig=S,n.getSpotLightConfig=L,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
