(function(n,d){typeof exports=="object"&&typeof module<"u"?d(exports,require("@vis-three/tdcm"),require("three"),require("@vis-three/module-object"),require("@vis-three/core")):typeof define=="function"&&define.amd?define(["exports","@vis-three/tdcm","three","@vis-three/module-object","@vis-three/core"],d):(n=typeof globalThis<"u"?globalThis:n||self,d((n["vis-three"]=n["vis-three"]||{},n["vis-three"]["module-light"]={}),n.tdcm,n.three,n.moduleObject,n.core))})(this,function(n,d,s,p,w){"use strict";const u=function(){return Object.assign(p.getObjectConfig(),{type:"Light",color:"rgb(255, 255, 255)",intensity:1})},f=function(r){return Object.assign(u(),{shadow:{bias:0,normalBias:0,radius:1,mapSize:{x:512,y:512},camera:r}})},l=function(){return Object.assign(p.getObjectConfig(),{color:"rgb(255, 255, 255)",intensity:1})},m=function(){return Object.assign(f({fov:90,aspect:1,near:.5,far:500}),{distance:30,decay:.01})},L=function(){return Object.assign(f({fov:50,aspect:1,near:.5,far:500}),{distance:30,angle:Math.PI/180*45,penumbra:.01,decay:.01,targetAt:""})},y=function(){return Object.assign(f({near:.5,far:500,top:window.innerHeight,bottom:-window.innerHeight,left:-window.innerWidth,right:window.innerWidth}),{})},C=function(){return Object.assign(u(),{color:"rgb(255, 255, 255)",groundColor:"rgb(0, 0, 0)"})},S=function(){return Object.assign(u(),{width:10,height:10})},g=p.defineObjectModel.extend(r=>({shared:{cacheMapSize:new s.Vector2,cacheViewportSize:new s.Vector2,updateShadowSize(e,t,i){const o=this.cacheMapSize,a=this.cacheViewportSize,h=e.shadow;e.shadow.mapSize.set(t.shadow.mapSize.x,t.shadow.mapSize.y),o.copy(h.mapSize);const c=h.getFrameExtents();o.multiply(c),a.copy(h.mapSize),(o.x>i||o.y>i)&&(o.x>i&&(a.x=Math.floor(i/c.x),o.x=a.x*c.x,h.mapSize.x=a.x),o.y>i&&(a.y=Math.floor(i/c.y),o.y=a.y*c.y,h.mapSize.y=a.y)),e.shadow.map.setSize(o.x,o.y)}},context(){return{cacheColor:new s.Color}},commands:{set:{color({model:e,target:t,value:i}){t.color.copy(e.cacheColor.set(i))},scale:d.emptyHandler,rotation:d.emptyHandler,lookAt:d.emptyHandler,shadow:{mapSize({model:e,target:t,config:i,engine:o,key:a,value:h}){t.shadow.mapSize[a]=h,e.updateShadowSize(t,i,o.webGLRenderer.capabilities.maxTextureSize)},camera({target:e,key:t,value:i}){e.shadow.camera[t]=i,e.shadow.camera.updateProjectionMatrix()}}}},create({model:e,light:t,config:i,filter:o,engine:a,shadow:h}){if(t.color.copy(e.cacheColor.set(i.color)),h){const c=i,b=()=>{t.shadow.map&&(e.updateShadowSize(t,c,a.webGLRenderer.capabilities.maxTextureSize),a.renderManager.removeEventListener(w.ENGINE_EVENT.RENDER,b))};if(a.renderManager.addEventListener(w.ENGINE_EVENT.RENDER,b),c.shadow){for(const E in c.shadow.camera)t.shadow.camera[E]=c.shadow.camera[E];t.shadow.camera.updateProjectionMatrix()}}r.create({model:e,target:t,config:i,filter:{color:!0,scale:!0,rotation:!0,lookAt:!0,shadow:{mapSize:!0,camera:!0},...o},engine:a})},dispose(e){r.dispose(e)}})),z=g(r=>({type:"AmbientLight",config:l,create({model:e,config:t,engine:i}){const o=new s.AmbientLight;return r.create({model:e,light:o,config:t,filter:{},engine:i,shadow:!1}),o},dispose({target:e}){r.dispose(e)}})),j=g(r=>({type:"DirectionalLight",config:y,create({model:e,config:t,engine:i}){const o=new s.DirectionalLight;return r.create({model:e,light:o,config:t,filter:{},engine:i,shadow:!0}),o},dispose({target:e}){r.dispose(e)}})),v=g(r=>({type:"HemisphereLight",config:C,shared:{cacheColor:new s.Color},commands:{set:{groundColor({model:e,target:t,value:i}){t.groundColor.copy(e.cacheColor.set(i))}}},create({model:e,config:t,engine:i}){const o=new s.HemisphereLight;return o.groundColor.copy(e.cacheColor.set(t.groundColor)),r.create({model:e,light:o,config:t,filter:{groundColor:!0},engine:i,shadow:!1}),o},dispose({target:e}){r.dispose(e)}})),A=g(r=>({type:"PointLight",config:m,create({model:e,config:t,engine:i}){const o=new s.PointLight;return r.create({model:e,light:o,config:t,filter:{},engine:i,shadow:!0}),o},dispose({target:e}){r.dispose(e)}})),M=g(r=>({type:"RectAreaLight",config:S,commands:{set:{rotation:void 0}},create({model:e,config:t,engine:i}){const o=new s.RectAreaLight;return o.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z),o.updateMatrixWorld(),r.create({model:e,light:o,config:t,filter:{},engine:i,shadow:!0}),o},dispose({target:e}){r.dispose(e)}})),O=g(r=>({type:"SpotLight",config:L,create({model:e,config:t,engine:i}){const o=new s.SpotLight;return t.targetAt&&(o.target=i.getObject3D(t.targetAt)),r.create({model:e,light:o,config:t,filter:{},engine:i,shadow:!0}),o},dispose({target:e}){r.dispose(e)}})),R=d.defineModule({type:"light",object:!0,models:[z,j,v,A,M,O],lifeOrder:d.SUPPORT_LIFE_CYCLE.THREE});n.default=R,n.getAmbientLightConfig=l,n.getDirectionalLightConfig=y,n.getHemisphereLightConfig=C,n.getPointLightConfig=m,n.getRectAreaLightConfig=S,n.getSpotLightConfig=L,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
