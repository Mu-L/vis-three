(function(r,a){typeof exports=="object"&&typeof module<"u"?a(exports,require("three"),require("three/src/lights/LightShadow.js"),require("three/examples/jsm/lights/RectAreaLightUniformsLib.js")):typeof define=="function"&&define.amd?define(["exports","three","three/src/lights/LightShadow.js","three/examples/jsm/lights/RectAreaLightUniformsLib.js"],a):(r=typeof globalThis<"u"?globalThis:r||self,a((r["vis-three"]=r["vis-three"]||{},r["vis-three"].core={}),r.three,r.LightShadow_js,r.RectAreaLightUniformsLib_js))})(this,function(r,a,f,m){"use strict";class c{constructor(){this.listeners=new Map,this.throttleSymbol=Symbol.for("vis.throttle"),this.throttleTimers=new WeakSet,this.antiShakeSymbol=Symbol.for("vis.antiShake"),this.antiShakeTimers=new WeakMap}addEventListener(e,t){const s=this.listeners;s.has(e)||s.set(e,[]);const i=s.get(e);i.includes(t)||i.push(t)}hasEventListener(e,t){const s=this.listeners;return s.has(e)?s.get(e).includes(t):!1}removeEventListener(e,t){const s=this.listeners;if(!s.has(e))return;const i=s.get(e);t[this.throttleSymbol]&&i.includes(t[this.throttleSymbol])&&(i.splice(i.indexOf(t[this.throttleSymbol]),1),delete t[this.throttleSymbol]),t[this.antiShakeSymbol]&&i.includes(t[this.antiShakeSymbol])&&(i.splice(i.indexOf(t[this.antiShakeSymbol]),1),delete t[this.antiShakeSymbol]),i.includes(t)&&i.splice(i.indexOf(t),1)}removeEvent(e){const t=this.listeners;t.has(e)&&t.delete(e)}dispatchEvent(e){var i;const t=e.type,s=this.listeners;if(s.has(t))try{(i=s.get(t))==null||i.forEach(o=>{o.call(this,e)})}catch(o){console.error(o)}}once(e,t){const s=function(i){t.call(this,i),Promise.resolve().then(()=>{this.removeEventListener(e,s)})};this.addEventListener(e,s)}emit(e,t={}){var i;const s=this.listeners;if(s.has(e))try{(i=s.get(e))==null||i.forEach(o=>{o.call(this,t)})}catch(o){console.error(o)}}on(e,t){this.addEventListener(e,t)}has(e,t){return this.hasEventListener(e,t)}off(e,t){t?this.removeEventListener(e,t):this.removeEvent(e)}eventCount(e){return this.listeners.has(e)?this.listeners.get(e).length:0}popLatestEvent(e){this.listeners.has(e)&&this.listeners.get(e).pop()}clear(){this.listeners.clear()}useful(){return!![...this.listeners.keys()].length}onThrottle(e,t,s=1e3/60){if(t[this.throttleSymbol]){console.warn(`EventDispatcher: this listener has already been decorated with throttle in type ${e}.`,t);return}const i=function(o){this.throttleTimers.has(t)||(window.setTimeout(()=>{t.call(this,o),this.throttleTimers.delete(t)},s),this.throttleTimers.add(t))};t[this.throttleSymbol]=i,this.addEventListener(e,i)}onAntiShake(e,t,s=1e3/60){if(t[this.antiShakeSymbol]){console.warn(`EventDispatcher: this listener has already been decorated with anti-shake in type ${e}.`,t);return}const i=function(o){this.antiShakeTimers.has(t)&&clearTimeout(this.antiShakeTimers.get(t)),this.antiShakeTimers.set(t,window.setTimeout(()=>{t.call(this,o),this.antiShakeTimers.delete(t)},s))};t[this.antiShakeSymbol]=i,this.addEventListener(e,i)}}class d extends c{constructor(){super(...arguments),this.pluginTables=new Map,this.strategyTables=new Map}install(e){if(this.pluginTables.has(e.name))return console.warn("This plugin already exists",e.name),this;const t=s=>this.pluginTables.has(s)?!0:(console.error(`${e.name} must install this plugin before: ${s}`),!1);if(e.deps)if(Array.isArray(e.deps))for(const s of e.deps)t(s);else t(e.deps);return e.install(this),this.pluginTables.set(e.name,e),this}uninstall(e){if(!this.pluginTables.has(e))return this;for(const s of this.strategyTables.values())s.condition.includes(e)&&(console.info(`engine auto rollback strategy: ${s.name} before uninstall plugin: ${e}.`),this.rollback(s.name));for(const s of this.pluginTables.values())s.deps&&(Array.isArray(s.deps)&&s.deps.includes(e)||s.deps===e)&&(console.info(`engine auto uninstall plugin: ${s.name} before uninstall plugin: ${e}.`),this.uninstall(s.name));return this.pluginTables.get(e).dispose(this),this.pluginTables.delete(e),this}exec(e){const t=this.strategyTables;if(t.has(e.name))return console.warn("This strategy already exists",e.name),this;const s=this.pluginTables;for(const i of e.condition)if(!s.has(i))return console.warn(`${e.name} does not meet the conditions for execution: ${i}`),this;return e.exec(this),t.set(e.name,e),this}rollback(e){const t=this.strategyTables;return t.has(e)?(t.get(e).rollback(this),t.delete(e),this):this}}var u=(n=>(n.SETDOM="setDom",n.SETSIZE="setSize",n.SETCAMERA="setCamera",n.SETSCENE="setScene",n.RENDER="render",n.DISPOSE="dispose",n))(u||{});const h=class h extends d{constructor(){super(),this.dom=document.createElement("div"),this.camera=new a.PerspectiveCamera,this.scene=new a.Scene,h.initFlag||h.init(),this.camera.position.set(50,50,50),this.camera.lookAt(0,0,0)}static init(){const e=new f.LightShadow(new a.OrthographicCamera(-256,256,256,-256));e.autoUpdate=!1,e.needsUpdate=!1,a.AmbientLight.prototype.shadow=e,a.RectAreaLight.prototype.shadow=e,a.HemisphereLight.prototype.shadow=e,m.RectAreaLightUniformsLib.init(),h.initFlag=!0}setDom(e){return this.dom=e,this.dispatchEvent({type:"setDom",dom:e}),this}setSize(e,t){var s,i;return e&&e<=0||t&&t<=0?(console.warn(`you must be input width and height bigger then zero, width: ${e}, height: ${t}`),this):(!e&&(e=((s=this.dom)==null?void 0:s.offsetWidth)||window.innerWidth),!t&&(t=((i=this.dom)==null?void 0:i.offsetHeight)||window.innerHeight),this.dispatchEvent({type:"setSize",width:e,height:t}),this)}setCamera(e,t){return this.dispatchEvent({type:"setCamera",camera:e,oldCamera:this.camera,options:Object.assign({orbitControls:!0,transformControls:!0},t||{})}),this.camera=e,this}setScene(e){return this.dispatchEvent({type:"setScene",scene:e,oldScene:this.scene}),this.scene=e,this}render(e=0){return this.dispatchEvent({type:"render",delta:e}),this}dispose(){return this.dispatchEvent({type:"dispose"}),this}};h.initFlag=!1;let l=h;const p=function(n){const e=new l;return n.plugins&&n.plugins.forEach(t=>{e.install(t)}),n.strategy&&n.strategy.forEach(t=>{e.exec(t)}),e},S=function(n){return()=>n},g=function(n){return()=>n},b="0.7.1";window.__THREE__||console.error("vis-three dependent on three.js module, pleace run 'npm i three' first."),window.__VIS__?console.warn("Duplicate vis-three frames are introduced"):window.__VIS__=b,r.Base=d,r.ENGINE_EVENT=u,r.Engine=l,r.EventDispatcher=c,r.defineEngine=p,r.definePlugin=S,r.defineStrategy=g,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
