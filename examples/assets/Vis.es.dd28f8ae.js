import{I as ee,c as $e,k as ks,J as Ir,O as Ie,b as A,K as Fs,P as Re,B as J,X as Mt,Y as bt,Z as jr,_ as Gr,$ as Qt,V as H,a0 as $s,g as ot,j as Nr,a1 as Ws,a2 as Vs,f as Ys,T as Qs,a3 as Xs,a4 as we,G as Ks,a5 as it,a6 as Hr,a7 as Ur,a8 as Zs,S as We,i as at,L as ct,e as vt,o as Js,a9 as Br,n as Ve,aa as Te,M as je,ab as te,a as k,W as lt,U as qs,q as Ge,ac as Ne,A as en,ad as zr,ae as Rt,af as Xt,ag as Kt,x as Ye,ah as ht,ai as tn,aj as rn,y as wt,p as me,F as oe,ak as sn,d as _r,al as Zt,h as kr,am as dt,an as Qe,Q as Jt,ao as Fr,ap as qt,aq as nn,ar as on,as as an,at as $r,au as cn,av as Wr,aw as ln,s as hn,ax as dn,ay as un,az as pn,aA as mn,aB as Vr,aC as Yr,aD as fn,aE as gn,m as Qr,aF as En,aG as yn,E as er,aH as Sn,aI as Mn,aJ as bn,aK as Xr,aL as Kr,C as vn,R as Rn}from"./three.1b4256b1.js";import{T as wn,C as ut,S as Tn,U as Cn,P as xn,F as On,L as Zr,b as Jr,d as Ln,E as tr,R as rr,O as An,M as Dn,v as Pn,e as U,f as Xe,k as Tt,h as sr,i as In,j as ie}from"./vis-three.72224a55.js";var jn=Object.defineProperty,Gn=Object.defineProperties,Nn=Object.getOwnPropertyDescriptors,qr=Object.getOwnPropertySymbols,Hn=Object.prototype.hasOwnProperty,Un=Object.prototype.propertyIsEnumerable,nr=(e,t,r)=>t in e?jn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,F=(e,t)=>{for(var r in t||(t={}))Hn.call(t,r)&&nr(e,r,t[r]);if(qr)for(var r of qr(t))Un.call(t,r)&&nr(e,r,t[r]);return e},Ct=(e,t)=>Gn(e,Nn(t)),i=(e,t,r)=>(nr(e,typeof t!="symbol"?t+"":t,r),r);class ae{constructor(){i(this,"listeners",new Map)}addEventListener(t,r){const s=this.listeners;s.has(t)||s.set(t,new Set),s.get(t).add(r)}hasEventListener(t,r){const s=this.listeners;return s.has(t)?s.get(t).has(r):!1}removeEventListener(t,r){const s=this.listeners;!s.has(t)||!s.get(t).has(r)||s.get(t).delete(r)}dispatchEvent(t){var r;const s=t.type,n=this.listeners;if(n.has(s))try{(r=n.get(s))==null||r.forEach(o=>{o.call(this,t)})}catch(o){console.error(o)}}clear(){this.listeners=new Map}useful(){return Boolean([...this.listeners.keys()].length)}}class Bn extends ae{constructor(t=0){super();i(this,"clock",new vn),i(this,"animationFrame",-1),i(this,"fps",0),i(this,"timer",null),i(this,"playFun",()=>{}),i(this,"render",()=>{this.dispatchEvent({type:"render",delta:this.clock.getDelta(),total:this.clock.getElapsedTime()})}),i(this,"play",()=>{if(this.hasRendering()){console.warn("render manager is rendering.");return}this.dispatchEvent({type:"play"}),this.playFun()}),i(this,"stop",()=>{this.animationFrame!==-1&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=-1),this.timer&&(clearTimeout(this.timer),this.timer=null),this.dispatchEvent({type:"stop"})}),i(this,"hasRendering",()=>Boolean(this.animationFrame!==-1||this.timer)),i(this,"hasVaildRender",()=>this.useful()),this.setFPS(t)}setFPS(t){return this.animationFrame!==-1&&cancelAnimationFrame(this.animationFrame),this.timer&&clearTimeout(this.timer),this.fps=t,t<=0?(this.fps=0,this.playFun=()=>{this.render(),this.animationFrame=requestAnimationFrame(this.playFun)}):this.playFun=()=>{this.timer=setTimeout(()=>{this.playFun()},t),this.render()},this.playFun(),this}dispose(){this.hasRendering()&&this.stop(),this.clear()}}const zn=function(){return this.renderManager?(console.warn("has installed render manager plugin."),!1):(this.renderManager=new Bn,this.render=function(){return this.renderManager.render(),this},this.play=function(){return this.renderManager.play(),this},this.stop=function(){return this.renderManager.stop(),this},this.addEventListener("dispose",()=>{this.renderManager.dispose()}),!0)};class es extends ae{constructor(t,r){super();i(this,"object"),i(this,"domElement"),i(this,"enabled",!0),i(this,"target",new A),i(this,"minDistance",0),i(this,"maxDistance",1/0),i(this,"minZoom",0),i(this,"maxZoom",1/0),i(this,"minPolarAngle",0),i(this,"maxPolarAngle",Math.PI),i(this,"minAzimuthAngle",-1/0),i(this,"maxAzimuthAngle",1/0),i(this,"enableDamping",!1),i(this,"dampingFactor",.05),i(this,"enableZoom",!0),i(this,"zoomSpeed",1),i(this,"enableRotate",!0),i(this,"rotateSpeed",1),i(this,"enablePan",!0),i(this,"panSpeed",1),i(this,"screenSpacePanning",!0),i(this,"keyPanSpeed",7),i(this,"autoRotate",!1),i(this,"autoRotateSpeed",2),i(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),i(this,"mouseButtons",{LEFT:null,MIDDLE:dt.DOLLY,RIGHT:dt.ROTATE}),i(this,"touches",{ONE:Qe.ROTATE,TWO:Qe.DOLLY_PAN}),i(this,"target0"),i(this,"position0"),i(this,"zoom0"),i(this,"_domElementKeyEvents",null),i(this,"spherical"),i(this,"reset"),i(this,"update"),i(this,"onContextMenu"),i(this,"onPointerDown"),i(this,"onPointerCancel"),i(this,"onMouseWheel"),i(this,"onPointerMove"),i(this,"onPointerUp"),i(this,"onKeyDown"),this.object=t||new ee,this.domElement=r||document.createElement("div"),this.domElement.style.touchAction="none",this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.update=(()=>{const u=new A,v=new Jt().setFromUnitVectors(this.object.up,new A(0,1,0)),_=v.clone().invert(),Y=new A,be=new Jt,ve=2*Math.PI;return()=>{const Pr=this.object.position;u.copy(Pr).sub(this.target),u.applyQuaternion(v),a.setFromVector3(u),this.autoRotate&&n===s.NONE&&D(E()),this.enableDamping?(a.theta+=c.theta*this.dampingFactor,a.phi+=c.phi*this.dampingFactor):(a.theta+=c.theta,a.phi+=c.phi);let ue=this.minAzimuthAngle,pe=this.maxAzimuthAngle;return isFinite(ue)&&isFinite(pe)&&(ue<-Math.PI?ue+=ve:ue>Math.PI&&(ue-=ve),pe<-Math.PI?pe+=ve:pe>Math.PI&&(pe-=ve),ue<=pe?a.theta=Math.max(ue,Math.min(pe,a.theta)):a.theta=a.theta>(ue+pe)/2?Math.max(ue,a.theta):Math.min(pe,a.theta)),a.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=d,a.radius=Math.max(this.minDistance,Math.min(this.maxDistance,a.radius)),this.enableDamping===!0?this.target.addScaledVector(h,this.dampingFactor):this.target.add(h),u.setFromSpherical(a),u.applyQuaternion(_),Pr.copy(this.target).add(u),this.object.lookAt(this.target),this.enableDamping===!0?(c.theta*=1-this.dampingFactor,c.phi*=1-this.dampingFactor,h.multiplyScalar(1-this.dampingFactor)):(c.set(0,0,0),h.set(0,0,0)),d=1,p||Y.distanceToSquared(this.object.position)>o||8*(1-be.dot(this.object.quaternion))>o?(this.dispatchEvent({type:"change"}),Y.copy(this.object.position),be.copy(this.object.quaternion),p=!1,!0):!1}})();const s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let n=s.NONE;const o=1e-6,a=new Fr,c=new Fr;let d=1;const h=new A;let p=!1;const f=new H,g=new H,S=new H,b=new H,T=new H,w=new H,M=new H,L=new H,P=new H,C=[],$={},E=()=>2*Math.PI/60/60*this.autoRotateSpeed,V=()=>Math.pow(.95,this.zoomSpeed),D=u=>{c.theta-=u},O=u=>{c.phi-=u},Sr=function(){const u=new A;return function(_,Y){u.setFromMatrixColumn(Y,0),u.multiplyScalar(-_),h.add(u)}}(),Mr=(()=>{const u=new A;return(v,_)=>{this.screenSpacePanning===!0?u.setFromMatrixColumn(_,1):(u.setFromMatrixColumn(_,0),u.crossVectors(this.object.up,u)),u.multiplyScalar(v),h.add(u)}})(),Fe=(()=>{const u=new A;return(v,_)=>{const Y=this.domElement;if(this.object instanceof ee){const be=this.object.position;u.copy(be).sub(this.target);let ve=u.length();ve*=Math.tan(this.object.fov/2*Math.PI/180),Sr(2*v*ve/Y.clientHeight,this.object.matrix),Mr(2*_*ve/Y.clientHeight,this.object.matrix)}else this.object instanceof Ie?(Sr(v*(this.object.right-this.object.left)/this.object.zoom/Y.clientWidth,this.object.matrix),Mr(_*(this.object.top-this.object.bottom)/this.object.zoom/Y.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}})(),Wt=u=>{this.object instanceof ee?d/=u:this.object instanceof Ie?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*u)),this.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)},br=u=>{this.object instanceof ee?d*=u:this.object instanceof Ie?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/u)),this.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)};function vr(u){f.set(u.clientX,u.clientY)}function Ts(u){M.set(u.clientX,u.clientY)}function Rr(u){b.set(u.clientX,u.clientY)}const Cs=u=>{g.set(u.clientX,u.clientY),S.subVectors(g,f).multiplyScalar(this.rotateSpeed);const v=this.domElement;D(2*Math.PI*S.x/v.clientHeight),O(2*Math.PI*S.y/v.clientHeight),f.copy(g),this.update()},xs=u=>{L.set(u.clientX,u.clientY),P.subVectors(L,M),P.y>0?Wt(V()):P.y<0&&br(V()),M.copy(L),this.update()},Os=u=>{T.set(u.clientX,u.clientY),w.subVectors(T,b).multiplyScalar(this.panSpeed),Fe(w.x,w.y),b.copy(T),this.update()},Ls=u=>{u.deltaY<0?br(V()):u.deltaY>0&&Wt(V()),this.update()},As=u=>{let v=!1;switch(u.code){case this.keys.UP:Fe(0,this.keyPanSpeed),v=!0;break;case this.keys.BOTTOM:Fe(0,-this.keyPanSpeed),v=!0;break;case this.keys.LEFT:Fe(this.keyPanSpeed,0),v=!0;break;case this.keys.RIGHT:Fe(-this.keyPanSpeed,0),v=!0;break}v&&(u.preventDefault(),this.update())};function wr(){if(C.length===1)f.set(C[0].pageX,C[0].pageY);else{const u=.5*(C[0].pageX+C[1].pageX),v=.5*(C[0].pageY+C[1].pageY);f.set(u,v)}}function Tr(){if(C.length===1)b.set(C[0].pageX,C[0].pageY);else{const u=.5*(C[0].pageX+C[1].pageX),v=.5*(C[0].pageY+C[1].pageY);b.set(u,v)}}function Cr(){const u=C[0].pageX-C[1].pageX,v=C[0].pageY-C[1].pageY,_=Math.sqrt(u*u+v*v);M.set(0,_)}const Ds=()=>{this.enableZoom&&Cr(),this.enablePan&&Tr()},Ps=()=>{this.enableZoom&&Cr(),this.enableRotate&&wr()},xr=u=>{if(C.length==1)g.set(u.pageX,u.pageY);else{const _=Yt(u),Y=.5*(u.pageX+_.x),be=.5*(u.pageY+_.y);g.set(Y,be)}S.subVectors(g,f).multiplyScalar(this.rotateSpeed);const v=this.domElement;D(2*Math.PI*S.x/v.clientHeight),O(2*Math.PI*S.y/v.clientHeight),f.copy(g)},Or=u=>{if(C.length===1)T.set(u.pageX,u.pageY);else{const v=Yt(u),_=.5*(u.pageX+v.x),Y=.5*(u.pageY+v.y);T.set(_,Y)}w.subVectors(T,b).multiplyScalar(this.panSpeed),Fe(w.x,w.y),b.copy(T)},Lr=u=>{const v=Yt(u),_=u.pageX-v.x,Y=u.pageY-v.y,be=Math.sqrt(_*_+Y*Y);L.set(0,be),P.set(0,Math.pow(L.y/M.y,this.zoomSpeed)),Wt(P.y),M.copy(L)},Is=u=>{this.enableZoom&&Lr(u),this.enablePan&&Or(u)},js=u=>{this.enableZoom&&Lr(u),this.enableRotate&&xr(u)};this.onPointerDown=u=>{this.enabled!==!1&&(C.length===0&&(this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp)),_s(u),u.pointerType==="touch"?Us(u):Gs(u))};let Vt=!1;this.onPointerMove=u=>{this.enabled!==!1&&(Vt||(this.domElement.setPointerCapture(u.pointerId),Vt=!0),u.pointerType==="touch"?Bs(u):Ns(u))},this.onPointerUp=u=>{this.enabled!==!1&&(Vt=!1,u.pointerType==="touch"?zs():Hs(u),Ar(u),C.length===0&&(this.domElement.releasePointerCapture(u.pointerId),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)))},this.onPointerCancel=u=>{Ar(u)};const Gs=u=>{let v;switch(u.button){case 0:v=this.mouseButtons.LEFT;break;case 1:v=this.mouseButtons.MIDDLE;break;case 2:v=this.mouseButtons.RIGHT;break;default:v=-1}switch(v){case dt.DOLLY:if(this.enableZoom===!1)return;Ts(u),n=s.DOLLY;break;case dt.ROTATE:if(u.ctrlKey||u.metaKey||u.shiftKey){if(this.enablePan===!1)return;Rr(u),n=s.PAN}else{if(this.enableRotate===!1)return;vr(u),n=s.ROTATE}break;case dt.PAN:if(u.ctrlKey||u.metaKey||u.shiftKey){if(this.enableRotate===!1)return;vr(u),n=s.ROTATE}else{if(this.enablePan===!1)return;Rr(u),n=s.PAN}break;default:n=s.NONE}n!==s.NONE&&this.dispatchEvent({type:"start"})},Ns=u=>{if(this.enabled!==!1)switch(n){case s.ROTATE:if(this.enableRotate===!1)return;Cs(u);break;case s.DOLLY:if(this.enableZoom===!1)return;xs(u);break;case s.PAN:if(this.enablePan===!1)return;Os(u);break}},Hs=u=>{this.dispatchEvent({type:"end"}),n=s.NONE};this.onMouseWheel=u=>{this.enabled===!1||this.enableZoom===!1||n!==s.NONE||(u.preventDefault(),this.dispatchEvent({type:"start"}),Ls(u),this.dispatchEvent({type:"end"}))},this.onKeyDown=u=>{this.enabled===!1||this.enablePan===!1||As(u)};const Us=u=>{switch(Dr(u),C.length){case 1:switch(this.touches.ONE){case Qe.ROTATE:if(this.enableRotate===!1)return;wr(),n=s.TOUCH_ROTATE;break;case Qe.PAN:if(this.enablePan===!1)return;Tr(),n=s.TOUCH_PAN;break;default:n=s.NONE}break;case 2:switch(this.touches.TWO){case Qe.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;Ds(),n=s.TOUCH_DOLLY_PAN;break;case Qe.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;Ps(),n=s.TOUCH_DOLLY_ROTATE;break;default:n=s.NONE}break;default:n=s.NONE}n!==s.NONE&&this.dispatchEvent({type:"start"})},Bs=u=>{switch(Dr(u),n){case s.TOUCH_ROTATE:if(this.enableRotate===!1)return;xr(u),this.update();break;case s.TOUCH_PAN:if(this.enablePan===!1)return;Or(u),this.update();break;case s.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;Is(u),this.update();break;case s.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;js(u),this.update();break;default:n=s.NONE}},zs=u=>{this.dispatchEvent({type:"end"}),n=s.NONE};this.onContextMenu=u=>{this.enabled!==!1&&u.preventDefault()};function _s(u){C.push(u)}const Ar=u=>{delete $[u.pointerId];for(let v=0;v<C.length;v++)if(C[v].pointerId==u.pointerId){C.splice(v,1);return}};function Dr(u){let v=$[u.pointerId];v===void 0&&(v=new H,$[u.pointerId]=v),v.set(u.pageX,u.pageY)}function Yt(u){const v=u.pointerId===C[0].pointerId?C[1]:C[0];return $[v.pointerId]}this.spherical=a,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1}),this.reset=()=>{this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent({type:"change"}),this.update(),n=s.NONE},this.update()}getPolarAngle(){return this.spherical.phi}getAzimuthalAngle(){return this.spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this.onKeyDown),this._domElementKeyEvents=t}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}setCamera(t){this.object=t}setDom(t){this.dispose(),this.domElement=t,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1})}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointercancel",this.onPointerCancel),this.domElement.removeEventListener("wheel",this.onMouseWheel),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),this._domElementKeyEvents!==null&&this._domElementKeyEvents.removeEventListener("keydown",this.onKeyDown)}}var j;(function(e){e.DEFAULT="default",e.TOP="top",e.BOTTOM="bottom",e.LEFT="left",e.RIGHT="right",e.FRONT="front",e.BACK="back"})(j||(j={}));const _n=function(e={}){var t;if(!this.webGLRenderer)return console.error("must install some renderer before BasicViewpoint plugin."),!1;!e.viewpoint&&(e.viewpoint=j.DEFAULT),!e.perspective&&(e.perspective={}),!e.perspective.position&&(e.perspective.position={x:60,y:60,z:60}),!e.perspective.lookAt&&(e.perspective.lookAt={x:0,y:0,z:0}),!e.perspective.up&&(e.perspective.up={x:0,y:1,z:0}),!e.orthograpbic&&(e.orthograpbic={}),!e.orthograpbic.up&&(e.orthograpbic.up={x:0,y:1,z:0});const r=new ee;r.position.set(e.perspective.position.x,e.perspective.position.y,e.perspective.position.z),r.lookAt(e.perspective.lookAt.x,e.perspective.lookAt.y,e.perspective.lookAt.z),r.up.set(e.perspective.up.x,e.perspective.up.y,e.perspective.up.z);const s=e.orthograpbic.distance||1e4,n=new Ie(-window.innerWidth/8,window.innerWidth/8,-window.innerHeight/8,window.innerHeight/8,0,s);return n.up.set(e.perspective.up.x,e.perspective.up.y,e.perspective.up.z),this.setViewpoint=function(o){return this.dispatchEvent({type:"setViewpoint",viewpoint:o}),this},this.addEventListener("setSize",o=>{const a=o.width,c=o.height,d=a/c;r.aspect=d,r.updateProjectionMatrix(),n.left=-s*d,n.right=s*d,n.top=s,n.bottom=-s,n.zoom=s/c*5,n.updateProjectionMatrix()}),(t=e.orthograpbic.allowRotate)!=null,this.addEventListener("setViewpoint",o=>{const a=o.viewpoint;if(a===j.DEFAULT){this.setCamera(r);return}a===j.TOP?n.position.set(0,s/2,0):a===j.BOTTOM?n.position.set(0,-s/2,0):a===j.RIGHT?n.position.set(s/2,0,0):a===j.LEFT?n.position.set(-s/2,0,0):a===j.FRONT?n.position.set(0,0,s/2):a===j.BACK&&n.position.set(0,0,-s/2),this.setCamera(n)}),this.completeSet.add(()=>{e.viewpoint===j.DEFAULT?this.setCamera(r):this.setCamera(n),this.objectHelperManager&&this.objectHelperManager.addFilteredObject(r,n)}),!0},kn=function(e){return this.orbitControls?(console.warn("this has installed orbitControls plugin."),!1):this.renderManager?(this.orbitControls=new es(this.camera,this.dom),this.addEventListener("setCamera",t=>{t.options.orbitControls&&this.orbitControls.setCamera(t.camera)}),this.addEventListener("setDom",t=>{this.orbitControls.setDom(t.dom)}),this.renderManager.addEventListener("render",()=>{this.orbitControls.update()}),this.completeSet.add(()=>{this.setViewpoint&&this.addEventListener("setViewpoint",t=>{const r=t.viewpoint;this.orbitControls.target.set(0,0,0),r===j.DEFAULT?this.orbitControls.enableRotate=!0:r===j.TOP?this.orbitControls.enableRotate=!1:r===j.BOTTOM?this.orbitControls.enableRotate=!1:r===j.RIGHT?this.orbitControls.enableRotate=!1:r===j.LEFT?this.orbitControls.enableRotate=!1:r===j.FRONT?this.orbitControls.enableRotate=!1:r===j.BACK&&(this.orbitControls.enableRotate=!1)})}),!0):(console.warn("this must install renderManager before install orbitControls plugin."),!1)};class Fn{constructor(t){i(this,"REVISION"),i(this,"dom"),i(this,"addPanel"),i(this,"showPanel"),i(this,"begin"),i(this,"end"),i(this,"update"),i(this,"domElement"),i(this,"setMode");const r=In();this.REVISION=r.REVISION,this.dom=r.dom,this.domElement=r.domElement,this.begin=r.begin.bind(r),this.end=r.end.bind(r),this.update=r.update.bind(r),this.addPanel=r.addPanel.bind(r),this.showPanel=r.showPanel.bind(r),this.setMode=r.setMode.bind(r);const s=this.domElement;s.style.position="absolute",s.style.top="0",s.style.left="35px",t&&(s.style.top=`${t.top}px`,s.style.left=`${t.left}px`,s.style.right=`${t.right}px`,s.style.bottom=`${t.bottom}px`)}}const $n=function(e){if(this.stats)return console.warn("this has installed stats plugin."),!1;if(!this.renderManager)return console.warn("this must install renderManager before install stats plugin."),!1;const t=new Fn(e);this.stats=t;const r=()=>{this.stats.update()};return this.setStats=function(s){if(s)this.dom.appendChild(this.stats.domElement),this.renderManager.addEventListener("render",r);else try{this.dom.removeChild(this.stats.domElement),this.renderManager.removeEventListener("render",r)}catch{}return this},!0},Wn=function(e={}){if(this.effectComposer)return console.warn("this has installed effect composer plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;let t;if(e.WebGLMultisampleRenderTarget||e.MSAA){const s=this.webGLRenderer,n=s.getPixelRatio(),o=s.getDrawingBufferSize(new H);Number(window.__THREE__)>137?t=new tr(s,new lt(o.width*n,o.height*n,{format:e.format||qt,samples:e.samples||4})):t=new tr(s,new nn(o.width*n,o.height*n,{format:e.format||qt}))}else t=new tr(this.webGLRenderer);this.effectComposer=t;let r;return this.scene&&this.camera&&(r=new rr(this.scene,this.camera),t.addPass(r)),this.addEventListener("setCamera",s=>{if(!r&&this.scene){r=new rr(this.scene,s.camera),t.addPass(r);return}else r&&(r.camera=s.camera)}),this.addEventListener("setScene",s=>{if(!r&&this.camera){r=new rr(s.scene,this.camera),t.addPass(r);return}else r&&(r.scene=s.scene)}),this.addEventListener("setSize",s=>{t.setSize(s.width,s.height)}),this.renderManager?(this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",s=>{this.effectComposer.render(s.delta)})):this.render=function(){return this.effectComposer.render(),this},!0};class Vn extends ae{constructor(t){super();i(this,"dom"),i(this,"mouse"),i(this,"canMouseMove"),i(this,"mouseEventTimer"),i(this,"throttleTime"),i(this,"pointerDownHandler"),i(this,"pointerMoveHandler"),i(this,"pointerUpHandler"),i(this,"mouseDownHandler"),i(this,"mouseUpHandler"),i(this,"clickHandler"),i(this,"dblclickHandler"),i(this,"contextmenuHandler"),this.dom=t.dom,this.mouse=new H,this.canMouseMove=!0,this.mouseEventTimer=null,this.throttleTime=t.throttleTime||1e3/60;const r=n=>{const o={mouse:{x:this.mouse.x,y:this.mouse.y}};for(const a in n)o[a]=n[a];return o},s=n=>{this.dispatchEvent(r(n))};this.pointerMoveHandler=n=>{!this.canMouseMove||(this.canMouseMove=!1,this.mouseEventTimer=window.setTimeout(()=>{const o=this.mouse,a=this.dom,c=a.getBoundingClientRect();o.x=(n.clientX-c.left)/a.offsetWidth*2-1,o.y=-((n.clientY-c.top)/a.offsetHeight)*2+1,this.canMouseMove=!0,this.dispatchEvent(r(n))},this.throttleTime))},this.mouseDownHandler=s,this.mouseUpHandler=s,this.pointerDownHandler=s,this.pointerUpHandler=s,this.clickHandler=s,this.dblclickHandler=s,this.contextmenuHandler=s}setDom(t){if(this.dom){const r=this.dom;r.removeEventListener("mousedown",this.mouseDownHandler),r.removeEventListener("mouseup",this.mouseUpHandler),r.removeEventListener("pointerdown",this.pointerDownHandler),r.removeEventListener("pointermove",this.pointerMoveHandler),r.removeEventListener("pointerup",this.pointerUpHandler),r.removeEventListener("click",this.clickHandler),r.removeEventListener("dblclick",this.dblclickHandler),r.removeEventListener("contextmenu",this.contextmenuHandler)}return t.addEventListener("mousedown",this.mouseDownHandler),t.addEventListener("mouseup",this.mouseUpHandler),t.addEventListener("pointerdown",this.pointerDownHandler),t.addEventListener("pointermove",this.pointerMoveHandler),t.addEventListener("pointerup",this.pointerUpHandler),t.addEventListener("click",this.clickHandler),t.addEventListener("dblclick",this.dblclickHandler),t.addEventListener("contextmenu",this.contextmenuHandler),this.dom=t,this}getNormalMouse(){return this.mouse}}const Yn=function(e){if(this.pointerManager)return console.warn("this has installed pointerManager plugin."),!1;const t=new Vn(Object.assign(e||{},{dom:this.dom}));return this.addEventListener("setDom",r=>{t.setDom(r.dom)}),this.pointerManager=t,!0};var or;(function(e){e.POINTERDOWN="pointerdown",e.POINTERUP="pointerup",e.POINTERMOVE="pointermove",e.POINTERENTER="pointerenter",e.POINTERLEAVE="pointerleave",e.CLICK="click",e.DBLCLICK="dblclick",e.CONTEXTMENU="contextmenu"})(or||(or={}));class Qn extends ae{constructor(t){super();i(this,"raycaster"),i(this,"scene"),i(this,"camera"),i(this,"filter",new Set),i(this,"recursive",!1),i(this,"penetrate",!1),i(this,"propagation",!1),i(this,"delegation",!1),this.raycaster=new Rn,this.camera=t.camera,this.scene=t.scene,t.recursive&&(this.recursive=t.recursive),t.penetrate&&(this.penetrate=t.penetrate)}setScene(t){return this.scene=t,this}setCamera(t){return this.camera=t,this}addFilterObject(t){return this.filter.add(t),this}removeFilterObject(t){return this.filter.delete(t),this}intersectObject(t){this.raycaster.setFromCamera(t,this.camera);const r=this.filter,s=this.scene.children.filter(n=>!r.has(n));return this.raycaster.intersectObjects(s,this.recursive)}use(t){const r=function(c,d){return Object.assign({},c,d)},s=(c,d)=>{const h=this.intersectObject(c.mouse);if(h.length)if(this.penetrate)for(const p of h)p.object.dispatchEvent(r(c,{type:d,intersection:p}));else{const p=h[0];p.object.dispatchEvent(r(c,{type:d,intersection:p}))}this.dispatchEvent(r(c,{type:d,intersections:h}))},n=["pointerdown","pointerup","mousedown","mouseup","pointermove","click","dblclick","contextmenu"];for(const c of n)t.addEventListener(c,d=>{s(d,c)});const o=new Map;let a=null;return t.addEventListener("pointermove",c=>{const d=this.intersectObject(c.mouse);if(this.penetrate){if(!d.length){o.forEach(h=>{h.object.dispatchEvent(r(c,{type:"pointerleave",intersection:h})),h.object.dispatchEvent(r(c,{type:"mouseleave",intersection:h}))}),o.clear();return}for(const h of d)o.has(h.object)?(h.object.dispatchEvent(r(c,{type:"pointermove",intersection:h})),h.object.dispatchEvent(r(c,{type:"mousemove",intersection:h})),o.delete(h.object)):(h.object.dispatchEvent(r(c,{type:"pointerenter",intersection:h})),h.object.dispatchEvent(r(c,{type:"mouseenter",intersection:h})));for(const h of o.values())h.object.dispatchEvent(r(c,{type:"pointerleave",intersection:h})),h.object.dispatchEvent(r(c,{type:"mouseleave",intersection:h}));o.clear();for(const h of d)o.set(h.object,h)}else{if(!d.length){a&&(a.object.dispatchEvent(r(c,{type:"pointerleave",intersection:a})),a.object.dispatchEvent(r(c,{type:"mouseleave",intersection:a})),a=null);return}const h=d[0];if(!a){h.object.dispatchEvent(r(c,{type:"pointerenter",intersection:h})),h.object.dispatchEvent(r(c,{type:"mouseenter",intersection:h})),a=h;return}if(h.object!==a.object){a.object.dispatchEvent(r(c,{type:"pointerleave",intersection:h})),a.object.dispatchEvent(r(c,{type:"mouseleave",intersection:h})),h.object.dispatchEvent(r(c,{type:"pointerenter",intersection:h})),h.object.dispatchEvent(r(c,{type:"mouseenter",intersection:h})),a=h;return}h.object===a.object&&(h.object.dispatchEvent(r(c,{type:"pointermove",intersection:h})),h.object.dispatchEvent(r(c,{type:"mousemove",intersection:h})))}this.dispatchEvent(r(c,{type:"pointermove",intersections:d})),this.dispatchEvent(r(c,{type:"mousemove",intersections:d}))}),this}}const Xn=function(e){if(this.eventManager)return console.warn("engine has installed eventManager plugin."),!1;if(!this.pointerManager)return console.error("must install pointerManager before this plugin."),!1;const t=new Qn(Object.assign({scene:this.scene,camera:this.camera},e));return t.use(this.pointerManager),this.eventManager=t,this.addEventListener("setCamera",r=>{this.eventManager.setCamera(r.camera)}),this.addEventListener("setScene",r=>{this.eventManager.setScene(r.scene)}),!0};var xt;(function(e){e.OBJECTCHANGED="objectChanged"})(xt||(xt={}));class ts extends wn{constructor(t,r){!t&&(t=new ee),!r&&(r=document.body);super(t,r);i(this,"target"),i(this,"transObjectSet"),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this._onPointerDown=d=>{var h;!this.enabled||!((h=this.object)==null?void 0:h.parent)||(this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(d)),this.pointerDown(this._getPointer(d)))},this.domElement.addEventListener("pointerdown",this._onPointerDown),this.target=new $e,this.transObjectSet=new Set;let s="";const n=this.target,o=this.transObjectSet,a={x:0,y:0,z:0},c=new WeakMap;this.addEventListener("mouseDown",d=>{s=d.target.mode,s==="translate"&&(s="position"),s==="rotate"&&(s="rotation"),a.x=n[s].x,a.y=n[s].y,a.z=n[s].z,o.forEach(h=>{c.set(h,h.matrixAutoUpdate),h.matrixAutoUpdate=!1})}),this.addEventListener("objectChange",d=>{const h=n[s].x-a.x,p=n[s].y-a.y,f=n[s].z-a.z;a.x=n[s].x,a.y=n[s].y,a.z=n[s].z,o.forEach(g=>{g[s].x+=h,g[s].y+=p,g[s].z+=f,g.updateMatrix(),g.updateMatrixWorld()}),this.dispatchEvent({type:xt.OBJECTCHANGED,transObjectSet:o,mode:s,target:n})}),this.addEventListener("mouseUp",d=>{o.forEach(h=>{h.matrixAutoUpdate=c.get(h),c.delete(h)})})}setDom(t){return this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),t.addEventListener("pointerdown",this._onPointerDown),t.addEventListener("pointermove",this._onPointerHover),t.addEventListener("pointerup",this._onPointerUp),this.domElement=t,this}setCamera(t){return this.camera=t,this}getTarget(){return this.target}getTransObjectSet(){return this.transObjectSet}setAttach(...t){if(this.transObjectSet.clear(),!t.length||!t[0])return this.detach(),this;this.attach(this.target);const r=this.target;if(t.length===1){const a=t[0];return a.matrixWorld.decompose(r.position,r.quaternion,r.scale),r.updateMatrix(),r.updateMatrixWorld(),this.transObjectSet.add(a),this}const s=[],n=[],o=[];return t.forEach(a=>{s.push(a.matrixWorld.elements[12]),n.push(a.matrixWorld.elements[13]),o.push(a.matrixWorld.elements[14])}),r.rotation.set(0,0,0),r.scale.set(0,0,0),r.position.x=(Math.max(...s)-Math.min(...s))/2+Math.min(...s),r.position.y=(Math.max(...n)-Math.min(...n))/2+Math.min(...n),r.position.z=(Math.max(...o)-Math.min(...o))/2+Math.min(...o),r.updateMatrix(),r.updateMatrixWorld(),t.forEach(a=>{this.transObjectSet.add(a)}),this}}const Kn=function(e){if(this.transformControls)return console.warn("this has installed transformControls plugin."),!1;if(!this.pointerManager)return console.warn("this must install pointerManager before install transformControls plugin."),!1;if(!this.eventManager)return console.warn("this must install eventManager before install transformControls plugin."),!1;const t=new ts(this.camera,this.dom);return t.detach(),this.transformControls=t,this.scene.add(this.transformControls),this.scene.add(this.transformControls.target),this.transformControls.addEventListener("mouseDown",()=>{this.transing=!0}),this.setTransformControls=function(r){return r?this.scene.add(this.transformControls):this.scene.remove(this.transformControls),this},this.addEventListener("setCamera",r=>{r.options.transformControls&&t.setCamera(r.camera)}),this.addEventListener("setDom",r=>{t.setDom(r.dom)}),this.addEventListener("setScene",r=>{const s=r.scene;s.add(this.transformControls.target),s.add(this.transformControls)}),this.selectionBox?this.addEventListener("selected",r=>{t.setAttach(...r.objects)}):this.eventManager.addEventListener("click",r=>{if(this.transing){this.transing=!1;return}if(r.button===0){const n=r.intersections.map(o=>o.object)[0]||null;n?t.setAttach(n):t.detach()}}),this.eventManager.addFilterObject(t),this.completeSet.add(()=>{if(this.IS_ENGINESUPPORT){const r=o=>{const a=this.compilerManager.getObjectSymbol(o);return a?this.dataSupportManager.getConfigBySymbol(a):null};let s=null,n;t.addEventListener(xt.OBJECTCHANGED,o=>{const a=o;a.transObjectSet.forEach(c=>{s=r(c),n=a.mode,s&&(s[n].x=c[n].x,s[n].y=c[n].y,s[n].z=c[n].z)})})}}),!0},Zn=function(e={}){if(this.webGLRenderer)return console.warn("this has installed webglRenderer plugin."),!1;this.webGLRenderer=new Rt(e);const t=this.webGLRenderer.domElement;return t.style.position="absolute",t.style.top="0",t.style.left="0",t.classList.add("vis-webgl"),this.getScreenshot=async function(r={}){const s={width:this.dom.offsetWidth,height:this.dom.offsetHeight};!r.width&&(r.width=this.dom.offsetWidth),!r.height&&(r.height=this.dom.offsetHeight),!r.mine&&(r.mine="image/png");let n=!1;this.renderManager.hasRendering()&&(this.renderManager.stop(),n=!0);let o="";const a=this.webGLRenderer.getContext(),d=a.getParameter(a.MAX_RENDERBUFFER_SIZE)/4;if(r.width>d||r.height>d){const h=[],p=Math.ceil(r.width/d),f=Math.ceil(r.height/d),g=r.width/p,S=r.height/f,b=document.createElement("canvas");b.setAttribute("width",r.width.toString()),b.setAttribute("height",r.height.toString());const T=b.getContext("2d");if(!T)return console.warn("can not support canvas 2d;"),o;this.setSize(g,S);for(let M=0;M<p;M+=1)for(let L=0;L<f;L+=1)h.push({x:g*M,y:S*L});const w=[];h.forEach(M=>{this.camera.setViewOffset(r.width,r.height,M.x,M.y,g,S),this.renderManager.render();const L=this.webGLRenderer.domElement.toDataURL(r.mine);w.push(new Promise((P,C)=>{const $=new Image;$.src=L,$.onload=()=>{T.drawImage($,M.x,M.y,g,S),P(null)}}))}),this.setSize(s.width,s.height),await Promise.all(w).catch(M=>{console.warn(M)}),o=b.toDataURL(r.mine),this.camera.clearViewOffset()}else this.setSize(r.width,r.height),this.renderManager.render(),o=this.webGLRenderer.domElement.toDataURL(r.mine),this.setSize(s.width,s.height);return n&&this.renderManager.play(),o},this.addEventListener("setDom",r=>{r.dom.appendChild(this.webGLRenderer.domElement)}),this.addEventListener("setSize",r=>{this.webGLRenderer.setSize(r.width,r.height,!0)}),this.addEventListener("dispose",()=>{this.webGLRenderer.dispose()}),this.renderManager?(this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",r=>{this.webGLRenderer.render(this.scene,this.camera)})):this.render=function(){return this.webGLRenderer.render(this.scene,this.camera),this},!0},pt=class extends ks{constructor(e){super(e)}load(e,t,r,s){this.path!==void 0&&(e=this.path+e),this.manager.itemStart(e),e=this.manager.resolveURL(e);const n=Ir.get(e);if(n!==void 0)return setTimeout(()=>{t&&t(n),this.manager.itemEnd(e)},0),n;const o=document.createElement("video");return o.preload=pt.preload,o.autoplay=pt.autoplay,o.loop=pt.loop,o.muted=pt.muted,o.src=e,o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.zIndex="-1",document.body.appendChild(o),o.oncanplay=()=>{Ir.add(e,o),this.manager.itemEnd(e),t&&t(o)},o.onerror=a=>{this.manager.itemEnd(e),s&&s(a)},o}};let mt=pt;i(mt,"autoplay",!0);i(mt,"preload","auto");i(mt,"muted",!0);i(mt,"loop",!0);var Q;(function(e){e.BEFORELOAD="beforeLoad",e.LOADING="loading",e.DETAILLOADING="detailLoading",e.DETAILLOADED="detailLoaded",e.LOADED="loaded"})(Q||(Q={}));class Jn extends ae{constructor(t){super();i(this,"resourceMap"),i(this,"loaderMap"),i(this,"loadTotal"),i(this,"loadSuccess"),i(this,"loadError"),i(this,"isError"),i(this,"isLoading"),i(this,"isLoaded"),i(this,"loadDetailMap"),i(this,"path",""),this.resourceMap=new Map,this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={};const r=new on,s=new mt;this.loaderMap={jpg:r,png:r,jpeg:r,obj:new An,mtl:new Dn,mp4:s,webm:s,ogg:s},t&&(this.loaderMap=Object.assign(this.loaderMap,t.loaderExtends))}loaded(){return this.dispatchEvent({type:Q.LOADED,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,resourceMap:this.resourceMap}),this}checkLoaded(){return this.loadTotal===this.loadSuccess+this.loadError&&(this.isError=!0,this.isLoaded=!0,this.isLoading=!1,this.loaded()),this}setPath(t){const r=this.loaderMap;return Object.keys(r).forEach(s=>{r[s].setPath(t)}),this.path=t,this}load(t){var r;if(this.reset(),this.isLoading=!0,this.dispatchEvent({type:Q.BEFORELOAD,urlList:[...t]}),t.length<=0)return this.checkLoaded(),console.warn("url list is empty."),this;this.loadTotal+=t.length;const s=this.resourceMap,n=this.loaderMap,o=this.loadDetailMap;for(const a of t){let c,d;typeof a=="string"?(c=a,d=((r=c.split(".").pop())==null?void 0:r.toLocaleLowerCase())||""):(c=a.url,d=a.ext.toLocaleLowerCase());const h={url:c,progress:0,error:!1,message:c};if(o[c]=h,s.has(c)){h.progress=1,this.loadSuccess+=1,this.dispatchEvent({type:Q.DETAILLOADED,detail:h}),this.dispatchEvent({type:Q.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded();continue}if(!d){h.message=`url: ${c} \u5730\u5740\u6709\u8BEF\uFF0C\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6\u683C\u5F0F\u3002`,console.warn(h.message),h.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:Q.DETAILLOADED,detail:h}),this.dispatchEvent({type:Q.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const p=n[d];if(!p){h.message=`url: ${c} \u4E0D\u652F\u6301\u6B64\u6587\u4EF6\u683C\u5F0F\u52A0\u8F7D\u3002`,console.warn(h.message),h.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:Q.DETAILLOADED,detail:h}),this.dispatchEvent({type:Q.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}p.loadAsync(c,f=>{h.progress=Number((f.loaded/f.total).toFixed(2)),this.dispatchEvent({type:Q.DETAILLOADING,detail:h})}).then(f=>{h.progress=1,this.loadSuccess+=1,this.resourceMap.set(c,f),this.dispatchEvent({type:Q.DETAILLOADED,detail:h}),this.dispatchEvent({type:Q.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()}).catch(f=>{h.error=!0,h.message=JSON.stringify(f),this.loadError+=1,this.dispatchEvent({type:Q.DETAILLOADED,detail:h}),this.dispatchEvent({type:Q.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()})}return this}reset(){return this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={},this}register(t,r){return this.loaderMap[t]=r,this}hasLoaded(t){return this.resourceMap.has(t)}getResource(t){return this.resourceMap.get(t)}getLoadDetailMap(){return this.loadDetailMap}setLoadDetailMap(t){return this.loadDetailMap=t,this}remove(t){}toJSON(){const t=[];return this.resourceMap.forEach((r,s)=>{t.push(s)}),JSON.stringify(t)}exportConfig(){const t=[];return this.resourceMap.forEach((r,s)=>{t.push(s)}),t}dispose(){return this.resourceMap.clear(),this}}const qn=function(e){if(this.loaderManager)return console.warn("engine has installed loaderManager plugin."),!1;const t=new Jn(e);return this.loaderManager=t,this.loadResources=(r,s)=>{if(this.resourceManager){const n=o=>{s(void 0,o),this.resourceManager.removeEventListener("mapped",n)};try{this.resourceManager.addEventListener("mapped",n)}catch(o){s(o)}}else{const n=o=>{s(void 0,o),this.loaderManager.removeEventListener("loaded",n)};try{this.loaderManager.addEventListener("loaded",n)}catch(o){s(o)}}return this.loaderManager.load(r),this},this.loadResourcesAsync=r=>new Promise((s,n)=>{if(this.resourceManager){const o=a=>{s(a),this.resourceManager.removeEventListener("mapped",o)};try{this.resourceManager.addEventListener("mapped",o)}catch(a){n(a)}}else{const o=a=>{s(a),this.loaderManager.removeEventListener("loaded",o)};try{this.loaderManager.addEventListener("loaded",o)}catch(a){n(a)}}this.loaderManager.load(r)}),!0},eo={name:"uvPulseShader",uniforms:{time:{value:0},width:{value:.5},color:{value:{r:1,g:0,b:0}},center:{value:{x:.5,y:.5}}},vertexShader:`
    varying vec2 vUv;

    void main () {

      vUv = uv;

      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }`,fragmentShader:`
    uniform float width;
    uniform float time;
    uniform vec3 color;
    uniform vec2 center;

    varying vec2 vUv;

    void main () {
      // \u6839\u636EuTime\u6C42\u51FA\u767E\u5206\u6BD4
      float deg = mod(degrees(time), 360.0);
      if (deg > 0.0 && deg < 180.0) {
        discard;
      }

      float percent = cos(time);
      float distancePercent = distance(center, vUv);

      // \u4ECE\u5916\u5411\u91CC
      if (distancePercent > 0.5) {
        discard;
      }

      if (distancePercent < percent) {
        discard;
      }

      if (distancePercent - percent > width) {
        discard;
      }

      float opacity =  (width - (distancePercent - percent)) / width;

      // float opacity = distancePercent;
      gl_FragColor = vec4(color, opacity);
    }`},to={name:"fragCoordTestingShader",uniforms:{resolution:{value:{x:1920,y:1080}}},vertexShader:`
  void main () {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,fragmentShader:`
    uniform vec2 resolution;

    void main () {
      vec2 st = gl_FragCoord.xy / resolution;
      gl_FragColor = vec4(st.x,st.y,0.0,1.0);
    }`},ro={name:"colorMixShader",uniforms:{colorA:{value:{r:1,g:0,b:0}},colorB:{value:{r:0,g:1,b:0}},percent:{value:.5}},vertexShader:`
  void main () {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,fragmentShader:`
    uniform vec3 colorA;
    uniform vec3 colorB;
    uniform float percent;

    void main () {
      gl_FragColor = vec4(mix(colorA, colorB, percent), 1.0);
    }`},so={name:"BloomShader",uniforms:{brightness:{value:.5},extend:{value:5},range:{value:10},specular:{value:.8},specularRange:{value:2},color:{value:{r:1,g:1,b:1}}},vertexShader:`
  uniform float extend;

  varying vec2 vUv;

  void main () {

    vUv = uv;

    vec3 extendPosition = position + normalize(position) * extend;

    gl_Position = projectionMatrix * modelViewMatrix * vec4(extendPosition , 1.0 );
  }`,fragmentShader:`
    uniform vec3 color;
    uniform float brightness;
    uniform float specular;
    uniform float range;
    uniform float specularRange;

    varying vec2 vUv;
    
    void main () {

      gl_FragColor = vec4(color, brightness);
    }`},Ce=class{static getShader(e){return Ce.library.has(e)?Ce.cloneShader(Ce.library.get(e)):(console.warn(`con not found shader in shader library: ${e}`),null)}static generateConfig(e){if(!Ce.library.has(e))return console.warn(`con not found shader in shader library: ${e}`),{};const t=Ce.library.get(e),r={shader:e,uniforms:{}};return t.uniforms&&(r.uniforms=JSON.parse(JSON.stringify(t.uniforms))),r}static cloneShader(e){const t={name:e.name};return e.vertexShader&&(t.vertexShader=e.vertexShader),e.fragmentShader&&(t.fragmentShader=e.fragmentShader),e.uniforms&&(t.uniforms=JSON.parse(JSON.stringify(e.uniforms))),t}};let ce=Ce;i(ce,"library",new Map);i(ce,"reigster",function(e){Ce.library.has(e.name)&&console.warn(`shader library has exist shader: ${e.name} that will be cover.`),Ce.library.set(e.name,e)});const no={name:"defaultShader"};ce.reigster(no);ce.reigster(eo);ce.reigster(to);ce.reigster(ro);ce.reigster(so);var l;(function(e){e.BOXGEOMETRY="BoxGeometry",e.SPHEREGEOMETRY="SphereGeometry",e.LOADGEOMETRY="LoadGeometry",e.PLANEGEOMETRY="PlaneGeometry",e.CIRCLEGEOMETRY="CircleGeometry",e.CONEGEOMETRY="ConeGeometry",e.CYLINDERGEOMETRY="CylinderGeometry",e.DODECAHEDRONGEOMETRY="DodecahedronGeometry",e.TORUSGEOMETRY="TorusGeometry",e.RINGGEOMETRY="RingGeometry",e.EDGESGEOMETRY="EdgesGeometry",e.LINECURVEGEOMETRY="LineCurveGeometry",e.SPLINECURVEGEOMETRY="SplineCurveGeometry",e.CUBICBEZIERCURVEGEOMETRY="CubicBezierCurveGeometry",e.QUADRATICBEZIERCURVEGEOMETRY="QuadraticBezierCurveGeometry",e.CUSTOMGEOMETRY="CustomGeometry",e.LINETUBEGEOMETRY="LineTubeGeometry",e.SPLINETUBEGEOMETRY="SplineTubeGeometry",e.LINESHAPEGEOMETRY="LineShapeGeometry",e.MESH="Mesh",e.LINE="Line",e.POINTS="Points",e.SPRITE="Sprite",e.GROUP="Group",e.CSS3DOBJECT="CSS3DObject",e.CSS3DSPRITE="CSS3DSprite",e.CSS3DPLANE="CSS3DPlane",e.IMAGETEXTURE="ImageTexture",e.CUBETEXTURE="CubeTexture",e.CANVASTEXTURE="CanvasTexture",e.VIDEOTEXTURE="VideoTexture",e.MESHBASICMATERIAL="MeshBasicMaterial",e.MESHSTANDARDMATERIAL="MeshStandardMaterial",e.MESHPHONGMATERIAL="MeshPhongMaterial",e.SPRITEMATERIAL="SpriteMaterial",e.LINEBASICMATERIAL="LineBasicMaterial",e.POINTSMATERIAL="PointsMaterial",e.SHADERMATERIAL="ShaderMaterial",e.AMBIENTLIGHT="AmbientLight",e.SPOTLIGHT="SpotLight",e.POINTLIGHT="PointLight",e.DIRECTIONALLIGHT="DirectionalLight",e.HEMISPHERELIGHT="HemisphereLight",e.PERSPECTIVECAMERA="PerspectiveCamera",e.ORTHOGRAPHICCAMERA="OrthographicCamera",e.WEBGLRENDERER="WebGLRenderer",e.CSS3DRENDERER="CSS3DRenderer",e.SCENE="Scene",e.TRNASFORMCONTROLS="TransformControls",e.ORBITCONTROLS="OrbitControls",e.SMAAPASS="SMAAPass",e.UNREALBLOOMPASS="UnrealBloomPass",e.SELECTIVEBLOOMPASS="SelectiveBloomPass",e.SCRIPTANIMATION="ScriptAnimation",e.KEYFRAMEANIMATION="KeyframeAnimation"})(l||(l={}));const xe=()=>({vid:"",name:"",type:"Object3D",castShadow:!0,receiveShadow:!0,lookAt:"",visible:!0,matrixAutoUpdate:!0,renderOrder:0,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},up:{x:0,y:1,z:0},parent:"",children:[],pointerdown:[],pointermove:[],pointerup:[],pointerenter:[],pointerleave:[],click:[],dblclick:[],contextmenu:[]}),Ot=function(){return Object.assign(xe(),{type:"Light",color:"rgb(255, 255, 255)",intensity:1})},oo=function(){return Object.assign(xe(),{type:l.AMBIENTLIGHT,color:"rgb(255, 255, 255)",intensity:1})},io=function(){return Object.assign(Ot(),{type:l.POINTLIGHT,distance:30,decay:.01})},ao=function(){return Object.assign(Ot(),{type:l.SPOTLIGHT,distance:30,angle:Math.PI/180*45,penumbra:.01,decay:.01})},co=function(){return Object.assign(Ot(),{type:l.DIRECTIONALLIGHT,shadow:{mapSize:{width:512,height:512},camera:{near:.5,far:500}}})},lo=function(){return Object.assign(Ot(),{type:l.HEMISPHERELIGHT,color:"rgb(255, 255, 255)",groundColor:"rgb(0, 0, 0)"})},X=function(){return{vid:"",type:"Geometry",position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},groups:[]}},ho=function(){return Object.assign(X(),{type:l.BOXGEOMETRY,width:5,height:5,depth:5,widthSegments:1,heightSegments:1,depthSegments:1})},uo=function(){return Object.assign(X(),{type:l.SPHEREGEOMETRY,radius:3,widthSegments:32,heightSegments:32,phiStart:0,phiLength:Math.PI*2,thetaStart:0,thetaLength:Math.PI})},po=function(){return Object.assign(X(),{type:l.PLANEGEOMETRY,width:5,height:5,widthSegments:1,heightSegments:1})},mo=function(){return Object.assign(X(),{type:l.CIRCLEGEOMETRY,radius:3,segments:8,thetaStart:0,thetaLength:Math.PI*2})},fo=function(){return Object.assign(X(),{type:l.CONEGEOMETRY,radius:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},go=function(){return Object.assign(X(),{type:l.TORUSGEOMETRY,radius:3,tube:.4,radialSegments:8,tubularSegments:6,arc:Math.PI*2})},Eo=function(){return Object.assign(X(),{type:l.RINGGEOMETRY,innerRadius:2,outerRadius:3,thetaSegments:8,phiSegments:8,thetaStart:0,thetaLength:Math.PI*2})},yo=function(){return Object.assign(X(),{type:l.LOADGEOMETRY,url:""})},So=function(){return Object.assign(X(),{type:l.CUSTOMGEOMETRY,attribute:{position:[],color:[],index:[],normal:[],uv:[],uv2:[]}})},Mo=function(){return Object.assign(X(),{type:l.CYLINDERGEOMETRY,radiusTop:3,radiusBottom:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},bo=function(){return Object.assign(X(),{type:"",radius:3,detail:0})},vo=function(){return Object.assign(X(),{type:l.LOADGEOMETRY,url:"",thresholdAngle:1})},Lt=function(){return Object.assign(X(),{path:[],divisions:36,space:!0})},Ro=function(){return Object.assign(Lt(),{type:l.LINECURVEGEOMETRY})},wo=function(){return Object.assign(Lt(),{type:l.SPLINECURVEGEOMETRY})},To=function(){return Object.assign(Lt(),{type:l.CUBICBEZIERCURVEGEOMETRY})},Co=function(){return Object.assign(Lt(),{type:l.QUADRATICBEZIERCURVEGEOMETRY})},rs=function(){return Object.assign(X(),{type:"TubeGeometry",path:[],tubularSegments:64,radius:1,radialSegments:8,closed:!1})},xo=function(){return Object.assign(rs(),{type:l.LINETUBEGEOMETRY})},Oo=function(){return Object.assign(rs(),{type:l.SPLINETUBEGEOMETRY})},Lo=function(){return Object.assign(X(),{path:[],curveSegments:12})},Ao=function(){return Object.assign(Lo(),{type:l.LINESHAPEGEOMETRY})},At=function(){return{vid:"",type:"Texture",name:"",mapping:an,wrapS:$r,wrapT:$r,magFilter:wt,minFilter:cn,anisotropy:1,format:qt,offset:{x:0,y:0},repeat:{x:1,y:1},rotation:0,center:{x:0,y:0},matrixAutoUpdate:!0,encoding:Wr,needsUpdate:!1}},Do=function(){return Object.assign(At(),{type:l.IMAGETEXTURE,url:""})},Po=function(){return Object.assign(At(),{type:l.VIDEOTEXTURE,url:"",minFilter:wt})},Io=function(){return Object.assign(At(),{type:l.CUBETEXTURE,cube:{nx:"",ny:"",nz:"",px:"",py:"",pz:""},mapping:ln,flipY:!1})},jo=function(){return Object.assign(At(),{type:l.CANVASTEXTURE,url:"",needsUpdate:!1})},He=function(){return{vid:"",type:"Material",alphaTest:0,colorWrite:!0,depthTest:!0,depthWrite:!0,fog:!0,name:"",needsUpdate:!1,opacity:1,dithering:!1,shadowSide:null,side:hn,toneMapped:!0,transparent:!1,visible:!0,blendDst:dn,blendDstAlpha:null,blendEquation:un,blendEquationAlpha:null,blending:pn,blendSrc:mn,blendSrcAlpha:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0}},Go=function(){return Object.assign(He(),{type:l.MESHBASICMATERIAL,color:"rgb(255, 255, 255)",combine:Vr,aoMapIntensity:1,fog:!0,lightMapIntensity:1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",wireframeLinewidth:1,map:"",envMap:"",alphaMap:"",aoMap:"",lightMap:"",specularMap:""})},No=function(){return Object.assign(He(),{type:l.MESHSTANDARDMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,metalness:0,normalMapType:Yr,refractionRatio:.98,roughness:1,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",roughnessMap:"",normalMap:"",metalnessMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:""})},Ho=function(){return Object.assign(He(),{type:l.MESHPHONGMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,normalMapType:Yr,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",specular:"rgb(17, 17, 17)",shininess:30,combine:Vr,normalMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:"",specularMap:""})},Uo=function(){return Object.assign(He(),{type:l.SPRITEMATERIAL,color:"rgb(255, 255, 255)",rotation:0,map:"",alphaMap:"",sizeAttenuation:!0})},Bo=function(){return Object.assign(He(),{type:l.LINEBASICMATERIAL,color:"rgb(255, 255, 255)",linecap:"round",linejoin:"round",linewidth:1})},zo=function(){return Object.assign(He(),{type:l.POINTSMATERIAL,map:"",alphaMap:"",color:"rgb(255, 255, 255)",sizeAttenuation:!0,size:1})},_o=function(){return Object.assign(He(),{type:l.SHADERMATERIAL,shader:"defaultShader",uniforms:{}})},ko=function(){return Object.assign(xe(),{type:l.PERSPECTIVECAMERA,adaptiveWindow:!1,fov:45,aspect:1920/1080,near:5,far:50})},Fo=function(){return Object.assign(xe(),{type:l.ORTHOGRAPHICCAMERA,adaptiveWindow:!1,left:-window.innerWidth,right:window.innerWidth,top:window.innerHeight,bottom:-window.innerHeight,near:5,far:50,zoom:1})},ss=function(){return{vid:"",type:"Renderer",size:null}},$o=function(){return Object.assign(ss(),{vid:l.WEBGLRENDERER,type:l.WEBGLRENDERER,clearColor:"rgba(0, 0, 0, 0)",outputEncoding:Wr,physicallyCorrectLights:!1,shadowMap:{enabled:!1,autoUpdate:!0,needsUpdate:!1,type:fn},toneMapping:gn,toneMappingExposure:1,pixelRatio:window.devicePixelRatio,adaptiveCamera:!1,viewport:null,scissor:null})},Wo=function(){return Object.assign(ss(),{vid:l.CSS3DRENDERER,type:l.CSS3DRENDERER})},Vo=function(){return Object.assign(xe(),{vid:l.SCENE,type:l.SCENE,background:"",environment:"",fog:{type:"",color:"rgb(150, 150, 150)",near:1,far:200,density:.003}})},Yo=function(){return{vid:l.TRNASFORMCONTROLS,type:l.TRNASFORMCONTROLS,axis:"XYZ",enabled:!0,mode:"translate",snapAllow:!1,rotationSnap:Math.PI/180*10,translationSnap:5,scaleSnap:.1,showX:!0,showY:!0,showZ:!0,size:1,space:"world"}},Qo=function(){return{vid:l.ORBITCONTROLS,type:l.ORBITCONTROLS,autoRotate:!1,autoRotateSpeed:2,enableDamping:!1,dampingFactor:.05,enabled:!0,enablePan:!0,enableRotate:!0,enableZoom:!0,maxAzimuthAngle:1/0,maxDistance:1/0,maxPolarAngle:Math.PI,maxZoom:1/0,minAzimuthAngle:-1/0,minDistance:0,minPolarAngle:0,minZoom:0,panSpeed:1,rotateSpeed:1,zoomSpeed:1,screenSpacePanning:!0,target:null}},Dt=function(){return Object.assign(xe(),{material:"",geometry:""})},Xo=function(){return Object.assign(Dt(),{type:"Sprite",material:"",center:{x:.5,y:.5}})},Ko=function(){return Object.assign(Dt(),{type:l.MESH,geometry:"",material:""})},Zo=function(){return Object.assign(Dt(),{type:l.POINTS,geometry:"",material:""})},Jo=function(){return Object.assign(Dt(),{type:l.LINE,geometry:"",material:""})},qo=function(){return Object.assign(xe(),{type:l.GROUP,children:[]})},ir=function(){return{vid:"",type:"Pass"}},ei=function(){return Object.assign(ir(),{type:l.SMAAPASS})},ti=function(){return Object.assign(ir(),{type:l.UNREALBLOOMPASS,strength:1.5,threshold:0,radius:0})},ri=function(){return Object.assign(ir(),{type:l.SELECTIVEBLOOMPASS,strength:1,threshold:0,radius:0,renderScene:"",renderCamera:"",selectedObjects:[]})},ns=function(){return{vid:"",type:"",name:"",target:"",attribute:"",play:!0}},si=function(){return Object.assign(ns(),{type:l.SCRIPTANIMATION,script:{name:""}})},ni=function(){return Object.assign(ns(),{type:l.KEYFRAMEANIMATION,script:{name:""}})},ar=function(){return Object.assign(xe(),{type:l.CSS3DOBJECT,element:"",width:50,height:50})},oi=function(){return Object.assign(ar(),{type:l.CSS3DPLANE})},ii=function(){return Object.assign(ar(),{type:l.CSS3DSPRITE,rotation2D:0})},Ke={[l.IMAGETEXTURE]:Do,[l.CUBETEXTURE]:Io,[l.CANVASTEXTURE]:jo,[l.VIDEOTEXTURE]:Po,[l.MESHBASICMATERIAL]:Go,[l.MESHSTANDARDMATERIAL]:No,[l.MESHPHONGMATERIAL]:Ho,[l.SPRITEMATERIAL]:Uo,[l.LINEBASICMATERIAL]:Bo,[l.POINTSMATERIAL]:zo,[l.SHADERMATERIAL]:_o,[l.AMBIENTLIGHT]:oo,[l.SPOTLIGHT]:ao,[l.POINTLIGHT]:io,[l.DIRECTIONALLIGHT]:co,[l.HEMISPHERELIGHT]:lo,[l.BOXGEOMETRY]:ho,[l.SPHEREGEOMETRY]:uo,[l.LOADGEOMETRY]:yo,[l.CUSTOMGEOMETRY]:So,[l.PLANEGEOMETRY]:po,[l.CIRCLEGEOMETRY]:mo,[l.CONEGEOMETRY]:fo,[l.CYLINDERGEOMETRY]:Mo,[l.EDGESGEOMETRY]:vo,[l.LINECURVEGEOMETRY]:Ro,[l.SPLINECURVEGEOMETRY]:wo,[l.CUBICBEZIERCURVEGEOMETRY]:To,[l.QUADRATICBEZIERCURVEGEOMETRY]:Co,[l.DODECAHEDRONGEOMETRY]:bo,[l.SPLINETUBEGEOMETRY]:Oo,[l.LINETUBEGEOMETRY]:xo,[l.TORUSGEOMETRY]:go,[l.RINGGEOMETRY]:Eo,[l.LINESHAPEGEOMETRY]:Ao,[l.SPRITE]:Xo,[l.LINE]:Jo,[l.MESH]:Ko,[l.POINTS]:Zo,[l.GROUP]:qo,[l.CSS3DOBJECT]:ar,[l.CSS3DSPRITE]:ii,[l.CSS3DPLANE]:oi,[l.PERSPECTIVECAMERA]:ko,[l.ORTHOGRAPHICCAMERA]:Fo,[l.WEBGLRENDERER]:$o,[l.CSS3DRENDERER]:Wo,[l.SCENE]:Vo,[l.TRNASFORMCONTROLS]:Yo,[l.ORBITCONTROLS]:Qo,[l.SMAAPASS]:ei,[l.UNREALBLOOMPASS]:ti,[l.SELECTIVEBLOOMPASS]:ri,[l.SCRIPTANIMATION]:si,[l.KEYFRAMEANIMATION]:ni};var m;(function(e){e.CAMERA="camera",e.LIGHT="light",e.GEOMETRY="geometry",e.TEXTURE="texture",e.MATERIAL="material",e.RENDERER="renderer",e.SCENE="scene",e.SPRITE="sprite",e.CONTROLS="controls",e.LINE="line",e.MESH="mesh",e.POINTS="points",e.GROUP="group",e.CSS3D="css3D",e.PASS="pass",e.MODIFIER="modifier",e.ANIMATION="animation"})(m||(m={}));var cr;(function(e){e[e.CAMERA=m.CAMERA]="CAMERA",e[e.LIGHT=m.LIGHT]="LIGHT",e[e.SCENE=m.SCENE]="SCENE",e[e.SPRITE=m.SPRITE]="SPRITE",e[e.LINE=m.LINE]="LINE",e[e.MESH=m.MESH]="MESH",e[e.POINTS=m.POINTS]="POINTS",e[e.GROUP=m.GROUP]="GROUP",e[e.CSS3D=m.CSS3D]="CSS3D"})(cr||(cr={}));const ai={[l.IMAGETEXTURE]:m.TEXTURE,[l.CUBETEXTURE]:m.TEXTURE,[l.CANVASTEXTURE]:m.TEXTURE,[l.VIDEOTEXTURE]:m.TEXTURE,[l.MESHBASICMATERIAL]:m.MATERIAL,[l.MESHSTANDARDMATERIAL]:m.MATERIAL,[l.MESHPHONGMATERIAL]:m.MATERIAL,[l.SPRITEMATERIAL]:m.MATERIAL,[l.LINEBASICMATERIAL]:m.MATERIAL,[l.POINTSMATERIAL]:m.MATERIAL,[l.SHADERMATERIAL]:m.MATERIAL,[l.AMBIENTLIGHT]:m.LIGHT,[l.SPOTLIGHT]:m.LIGHT,[l.POINTLIGHT]:m.LIGHT,[l.DIRECTIONALLIGHT]:m.LIGHT,[l.BOXGEOMETRY]:m.GEOMETRY,[l.SPHEREGEOMETRY]:m.GEOMETRY,[l.LOADGEOMETRY]:m.GEOMETRY,[l.CUSTOMGEOMETRY]:m.GEOMETRY,[l.PLANEGEOMETRY]:m.GEOMETRY,[l.CIRCLEGEOMETRY]:m.GEOMETRY,[l.CONEGEOMETRY]:m.GEOMETRY,[l.CIRCLEGEOMETRY]:m.GEOMETRY,[l.EDGESGEOMETRY]:m.GEOMETRY,[l.CYLINDERGEOMETRY]:m.GEOMETRY,[l.LINECURVEGEOMETRY]:m.GEOMETRY,[l.SPLINECURVEGEOMETRY]:m.GEOMETRY,[l.CUBICBEZIERCURVEGEOMETRY]:m.GEOMETRY,[l.QUADRATICBEZIERCURVEGEOMETRY]:m.GEOMETRY,[l.LINETUBEGEOMETRY]:m.GEOMETRY,[l.SPLINETUBEGEOMETRY]:m.GEOMETRY,[l.TORUSGEOMETRY]:m.GEOMETRY,[l.RINGGEOMETRY]:m.GEOMETRY,[l.LINESHAPEGEOMETRY]:m.GEOMETRY,[l.SPRITE]:m.SPRITE,[l.LINE]:m.LINE,[l.MESH]:m.MESH,[l.POINTS]:m.POINTS,[l.GROUP]:m.GROUP,[l.CSS3DOBJECT]:m.CSS3D,[l.CSS3DSPRITE]:m.CSS3D,[l.CSS3DPLANE]:m.CSS3D,[l.PERSPECTIVECAMERA]:m.CAMERA,[l.ORTHOGRAPHICCAMERA]:m.CAMERA,[l.WEBGLRENDERER]:m.RENDERER,[l.SCENE]:m.SCENE,[l.TRNASFORMCONTROLS]:m.CONTROLS,[l.ORBITCONTROLS]:m.CONTROLS,[l.SMAAPASS]:m.PASS,[l.UNREALBLOOMPASS]:m.PASS,[l.SCRIPTANIMATION]:m.ANIMATION,[l.KEYFRAMEANIMATION]:m.ANIMATION},lr=e=>{const t=r=>e.toLocaleLowerCase().includes(r.toLocaleLowerCase());for(const r of Object.values(m))if(t(r))return r;return null},G=function(e,t,r=!0,s=!0){if(!Ke[e])return console.error(`type: ${e} can not be found in configList.`),{vid:"",type:e};const n=(a,c)=>{for(const d in c){if(a[d]===void 0){!r&&(a[d]=c[d]),r&&s&&console.warn(`'${e}' config can not set key: ${d}`);continue}typeof c[d]=="object"&&c[d]!==null&&!Array.isArray(c[d])?(a[d]===null&&(a[d]=F({},c[d])),n(a[d],c[d])):a[d]=c[d]}},o=Ke[e]();if([l.SHADERMATERIAL].includes(e)){const a=ce.generateConfig((t==null?void 0:t.shader)||"defaultShader"),c=r;r=!1,n(o,a),r=c}if([l.SCRIPTANIMATION,l.KEYFRAMEANIMATION].includes(e)&&(r=!1),o.vid===""&&(o.vid=Pn()),t&&n(o,t),G.autoInject&&G.injectEngine){const a=G.injectEngine,c=a.reactiveConfig(o);if(G.injectScene&&lr(o.type)in cr&&o.type!==l.SCENE){let d=null;typeof G.injectScene=="boolean"?d=a.getObjectConfig(a.scene):typeof G.injectScene=="string"&&(d=a.getConfigBySymbol(G.injectScene)),d?d.children.push(o.vid):console.warn("current engine scene can not found it config",a,a.scene)}return c}return o};G.autoInject=!0;G.injectScene=!1;G.injectEngine=null;const Ze=(e,t)=>t===1/0?"Infinity":t===-1/0?"-Infinity":t,hr=(e,t)=>t==="Infinity"?1/0:t==="-Infinity"?-1/0:t,ft=e=>JSON.parse(JSON.stringify(e,Ze),hr);var Rl=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",stringify:Ze,parse:hr,clone:ft}),os;(function(e){e.MAPPED="mapped"})(os||(os={}));class ci extends ae{constructor(t={}){super();i(this,"structureMap",new Map),i(this,"configMap",new Map),i(this,"resourceMap",new Map),i(this,"configModuleMap",ai),i(this,"mappingHandler",new Map);const r=this.mappingHandler;r.set(HTMLImageElement,this.HTMLImageElementHandler),r.set(HTMLCanvasElement,this.HTMLCanvasElementHandler),r.set(HTMLVideoElement,this.HTMLVideoElementHandler),r.set($e,this.Object3DHandler),r.set(HTMLDivElement,this.HTMLDivElementHandler),r.set(HTMLSpanElement,this.HTMLSpanElementHandler);const s=new Map;for(const n in t)s.has(n)&&console.warn(`resourceManager construct params rescource already exist: ${n}, that will be cover.`),s.set(n,t[n]);this.mappingResource(s)}Object3DHandler(t,r){const s=this.structureMap,n=this.configMap,o=this.resourceMap,a=function(c,d){let h=c;o.set(h,d);const p=G(d.type,d,!0,!1);n.set(h,p);const f={type:`${d.type}`,url:h};if(d.geometry){const g=d.geometry;g.computeBoundingBox();const S=g.boundingBox,b=S.getCenter(new A);h=`${c}.geometry`,o.set(h,g);const T=G(l.LOADGEOMETRY,{url:h,position:{x:b.x/(S.max.x-S.min.x)*2,y:b.y/(S.max.y-S.min.y)*2,z:b.z/(S.max.z-S.min.z)*2}});n.set(h,T),f.geometry=h,p.geometry=T.vid}if(d.material){const g=d.material;if(g instanceof Array)f.material=[],p.material=[],g.forEach((S,b,T)=>{h=`${c}.material.${b}`,o.set(h,S);const w=G(S.type,S,!0,!1);n.set(h,w),f.material[b]=h,p.material.push(w.vid)});else{h=`${c}.material`,o.set(h,g);const S=G(g.type,g,!0,!1);n.set(h,S),f.material=h,p.material=S.vid}}if([l.GROUP,l.SCENE].includes(d.type)&&(n.get(f.url).children=[]),d.children.length)if(f.children=[],[l.GROUP,l.SCENE].includes(d.type)){const g=n.get(f.url);d.children.forEach((S,b,T)=>{h=`${c}.children.${b}`,g.children.push(h),f.children[b]=a(h,S)})}else d.children.forEach((g,S,b)=>{h=`${c}.children.${S}`,f.children[S]=a(h,g)});return f};return s.set(t,a(t,r)),this}HTMLImageElementHandler(t,r){return this.resourceMap.set(t,r),this.configMap.set(t,G(l.IMAGETEXTURE,{url:t})),this.structureMap.set(t,t),this}HTMLCanvasElementHandler(t,r){return this.resourceMap.set(t,r),this.configMap.set(t,G(l.CANVASTEXTURE,{url:t})),this.structureMap.set(t,t),this}HTMLVideoElementHandler(t,r){return this.resourceMap.set(t,r),this.configMap.set(t,G(l.VIDEOTEXTURE,{url:t})),this.structureMap.set(t,t),this}HTMLDivElementHandler(t,r){return this.resourceMap.set(t,r),this.configMap.set(t,G(l.CSS3DOBJECT,{element:t})),this.structureMap.set(t,t),this}HTMLSpanElementHandler(t,r){return this.resourceMap.set(t,r),this.configMap.set(t,G(l.CSS3DSPRITE,{element:t})),this.structureMap.set(t,t),this}mappingResource(t){const r=this.structureMap,s=this.configMap,n=this.resourceMap,o=this.mappingHandler,a=(h,p,f)=>Object.getPrototypeOf(f)?o.has(Object.getPrototypeOf(f).constructor)?(o.get(Object.getPrototypeOf(f).constructor).call(this,h,p),!0):a(h,p,Object.getPrototypeOf(f)):!1,c=G.autoInject;G.autoInject=!1;const d={};return t.forEach((h,p)=>{a(p,h,h)?d[p]=this.getResourceConfig(p):(n.set(p,h),r.set(p,p),console.warn("resource manager can not support this resource to generate config",h))}),G.autoInject=c,this.dispatchEvent({type:"mapped",structureMap:r,configMap:s,resourceMap:n,resourceConfig:d}),this}getResourceConfig(t){if(this.structureMap.has(t))if(this.structureMap.get(t)===t){const r=this.configMap.get(t);return r?{[this.configModuleMap[r.type]]:{[r.vid]:ft(r)}}:{}}else{const r={},s=this.configMap,n=this.configModuleMap,o=this.structureMap.get(t),a=c=>{let d=s.get(c.url),h=n[d.type];if(r[h]||(r[h]={}),r[h][d.vid]=ft(d),c.geometry&&(d=s.get(c.geometry),h=n[d.type],r[h]||(r[h]={}),r[h][d.vid]=ft(d)),c.material&&(d=s.get(c.material),h=n[d.type],r[h]||(r[h]={}),r[h][d.vid]=ft(d)),c.children&&c.children.length)for(const p of c.children)a(p)};return a(o),r}else return console.warn(`resource manager can not found this url resource: ${t}`),{}}hasResource(t){return this.resourceMap.has(t)}remove(t){if(this.structureMap.has(t))if(this.structureMap.get(t)===t){this.structureMap.delete(t),this.configMap.delete(t);const r=this.resourceMap.get(t);return(r==null?void 0:r.dispose)&&r.dispose(),this.resourceMap.delete(t),this}else{const r=this.configMap,s=this.resourceMap,n=this.structureMap.get(t),o=a=>{if(r.delete(a.url),s.delete(a.url),a.geometry&&(r.delete(a.geometry),s.delete(a.geometry)),a.material&&(r.delete(a.material),s.delete(a.material)),a.children&&a.children.length)for(const c of a.children)o(c)};return o(n),this}else return console.warn(`resource manager can not found this url resource: ${t}`),this}dispose(){this.resourceMap.forEach((t,r)=>{t.dispose&&t.dispose()}),this.resourceMap.clear(),this.configMap.clear(),this.structureMap.clear()}}const li=function(e){if(this.resourceManager)return console.warn("engine has installed resourceManager plugin."),!1;const t=new ci(e.resources);return this.resourceManager=t,this.loaderManager&&this.loaderManager.addEventListener("loaded",r=>{this.resourceManager.mappingResource(r.resourceMap)}),this.registerResources=r=>{const s=new Map;return Object.keys(r).forEach(n=>{s.set(n,r[n])}),this.resourceManager.mappingResource(s),this},this.addEventListener("dispose",()=>{this.resourceManager.dispose()}),!0};function hi(e,t){return e in t}function se(e,t,r,s){const n=(o,a,c)=>{for(const d in o)if(!(c&&c[d])){if(typeof o[d]=="object"&&typeof o[d]!==null){c&&typeof c[d]=="object"&&typeof c[d]!==null?n(o[d],a[d],c[d]):n(o[d],a[d]);continue}a[d]=o[d]}};n(e,t,r),s&&s()}const le=class extends ae{constructor(e){super();i(this,"ignoreAttribute"),this.ignoreAttribute=e||{}}static proxyGetter(e,t,r){return Reflect.get(e,t,r)}static proxySetter(e,t,r,s,n,o){if(typeof t=="symbol")return Reflect.set(e,t,r,s);let a;if(e[t]===void 0){if(typeof r=="object"&&r!==null&&!le.proxyWeakSet.has(r)&&!n.ignoreAttribute[t]){const c=o.concat([t]);r=n.proxyExtends(r,c)}a=Reflect.set(e,t,r),n.broadcast({operate:"add",path:o.concat([]),key:t,value:r})}else{if(typeof r=="object"&&r!==null&&!le.proxyWeakSet.has(r)&&!n.ignoreAttribute[t]){const c=o.concat([t]);r=n.proxyExtends(r,c)}if(a=Reflect.set(e,t,r),Array.isArray(e)&&t==="length"){const c=e[Symbol.for(le.arraySymobl)],d=c.length-e.length;if(d>0){let h=0,p=0;for(const f of c)if(!e.includes(f)&&(n.broadcast({operate:"delete",path:o.concat([]),key:p.toString(),value:f}),h+=1,p+=1,h===d))break}return e[Symbol.for(this.arraySymobl)]=e.concat([]),a}n.broadcast({operate:"set",path:o.concat([]),key:t,value:r})}return a}static proxyDeleter(e,t,r,s){const n=e[t],o=Reflect.deleteProperty(e,t);return Array.isArray(e)||typeof t=="symbol"||r.broadcast({operate:"delete",path:s.concat([]),key:t,value:n}),o}proxyExtends(e,t=[]){if(le.proxyWeakSet.has(e)||typeof e!="object")return e;const r={get:le.proxyGetter,set:(n,o,a,c)=>le.proxySetter(n,o,a,c,this,t),deleteProperty:(n,o)=>le.proxyDeleter(n,o,this,t)};if(typeof e=="object"&&e!==null)for(const n in e){const o=t.concat([n]);let a=this.ignoreAttribute,c=!1;for(const d of o.slice(1)){if(a[d]===!0){c=!0;break}a[d]&&(a=a[d])}c||hi(n,e)&&typeof e[n]=="object"&&e[n]!==null&&(Array.isArray(e[n])&&(e[n][Symbol.for(le.arraySymobl)]=e[n].concat([])),e[n]=this.proxyExtends(e[n],o))}const s=new Proxy(e,r);return le.proxyWeakSet.add(s),s}broadcast({operate:e,path:t,key:r,value:s}){return{__poto__:!0,length:!0}[r]?this:(this.dispatchEvent({type:"broadcast",notice:{operate:e,path:t,key:r,value:s}}),this)}};let dr=le;i(dr,"proxyWeakSet",new WeakSet);i(dr,"arraySymobl","vis.array");class di{constructor(){i(this,"rule"),i(this,"memberSet"),this.rule=function(){},this.memberSet=new Set}apply(t){return this.memberSet.add(t),this}cancel(t){return this.memberSet.delete(t),this}setRule(t){return this.rule=t,this}translate(t){const r=this.rule;return this.memberSet.forEach(s=>{r(t,s)}),this}}class he{constructor(t,r,s){i(this,"data"),i(this,"broadcast"),i(this,"translater"),this.translater=new di().setRule(t),this.broadcast=new dr(s),this.data=this.broadcast.proxyExtends(r),this.broadcast.addEventListener("broadcast",n=>{this.translater.translate(n.notice)})}getData(){return this.data}setData(t){return this.data=t,this}proxyData(t){return this.data=this.broadcast.proxyExtends(t),this.data}existSymbol(t){return Boolean(this.data[t])}addConfig(t){return this.data[t.vid]=t,this}getConfig(t){return this.data[t]}removeConfig(t){const r=this.data;r[t]!==void 0&&delete r[t]}addCompiler(t){return t.setTarget(this.data),t.compileAll(),this.translater.apply(t),this}toJSON(t=!0){return t?JSON.stringify(this.exportConfig(),Ze):JSON.stringify(this.data,Ze)}exportConfig(t=!0){if(t){const r=this.data,s={},n={},o=(a,c,d={})=>{for(const h in a){if(["vid","type"].includes(h)){d[h]=a[h];continue}if(typeof a[h]=="object"&&a[h]!==null){if(Array.isArray(a[h])){if(!a[h].length)continue;d[h]=a[h].map(p=>typeof p=="object"&&p!==null?JSON.parse(JSON.stringify(p)):p);continue}d[h]={},c[h]?(o(a[h],c[h],d[h]),Object.keys(d[h]).length===0&&delete d[h]):d[h]=JSON.parse(JSON.stringify(a[h]))}else c[h]!==a[h]&&(d[h]=a[h])}};for(const a of Object.values(r)){if(!n[a.type]){if(!Ke[a.type]){console.error(`can not font some config with: ${a.type}`);continue}n[a.type]=Ke[a.type]()}s[a.vid]={},o(a,n[a.type],s[a.vid])}return s}else return JSON.parse(JSON.stringify(this.data,Ze),hr)}load(t){const r=this.data,s={},n=(o,a)=>{for(const c in a)typeof o[c]=="object"&&o[c]!==null&&typeof a[c]=="object"&&a[c]!==null?n(o[c],a[c]):o[c]===void 0&&(o[c]=a[c])};for(const o in t){const a=t[o];if(!s[a.type]){if(!Ke[a.type]){console.error(`can not font some config with: ${a.type}`);continue}s[a.type]=Ke[a.type]()}n(a,s[a.type]),r[o]=a}return this}remove(t){const r=this.data;for(const s in t)r[s]!==void 0&&delete r[s];return this}getModule(){return this.MODULE}}const fe=(e,t,r=Xe)=>{const{operate:s,key:n,path:o,value:a}=e;let c=n;const d=[].concat(o);if(o.length&&(c=d.shift()),!r(c)){console.warn(`${t.MODULE} Rule: vid is illeage: ${c}`);return}if(s==="add"&&!d.length){t.add(a);return}if(e.operate==="delete"&&!d.length){t.remove(a);return}if(e.operate==="set"&&!d.length&&n===c){t.cover(a);return}t.compile(c,{operate:s,key:n,path:d,value:a})},ui=function(e,t){fe(e,t)};class pi extends he{constructor(t,r){!t&&(t={});super(ui,t,r);i(this,"MODULE",m.TEXTURE)}}const mi=function(e,t){fe(e,t)};class fi extends he{constructor(t,r){!t&&(t={});super(mi,t,r);i(this,"MODULE",m.MATERIAL)}}class gt extends he{constructor(t,r,s){!r&&(r=Object.create(Object.prototype));super(t,r,s);i(this,"MODULE",m.GROUP)}}const Oe=function(e,t){e.key!=="parent"&&fe(e,t)},gi=function(e,t){Oe(e,t)};class Ei extends gt{constructor(t,r){!t&&(t={});super(gi,t,r);i(this,"MODULE",m.LIGHT)}}const yi=function(e,t){fe(e,t)};class Si extends he{constructor(t,r){!t&&(t={});super(yi,t,r);i(this,"MODULE",m.GEOMETRY)}}const Mi=function(e,t){Oe(e,t)};class bi extends gt{constructor(t,r){!t&&(t={});super(Mi,t,r);i(this,"MODULE",m.CAMERA)}}const vi=function(e,t){fe(e,t,r=>Xe(r)||[l.WEBGLRENDERER,l.CSS3DRENDERER].includes(r))};class Ri extends he{constructor(t,r){!t&&(t={});super(vi,t,r);i(this,"MODULE",m.RENDERER)}}const wi=function(e,t){fe(e,t,r=>Xe(r)||[l.SCENE].includes(r))};class Ti extends gt{constructor(t,r){!t&&(t={});super(wi,t,r);i(this,"MODULE",m.SCENE)}}const Ci=function(e,t){fe(e,t,r=>Xe(r)||[l.TRNASFORMCONTROLS,l.ORBITCONTROLS].includes(r))};class xi extends he{constructor(t,r){!t&&(t={});super(Ci,t,r);i(this,"MODULE",m.CONTROLS)}}class Pt extends he{constructor(t,r,s){!r&&(r=Object.create(Object.prototype));super(t,r,s);i(this,"MODULE",m.MESH)}}const Oi=function(e,t){e.key!=="geometry"&&Oe(e,t)};class Li extends Pt{constructor(t,r){!t&&(t={});super(Oi,t,r);i(this,"MODULE",m.SPRITE)}}const Ai=function(e,t){Oe(e,t)};class Di extends Pt{constructor(t,r){!t&&(t={});super(Ai,t,r);i(this,"MODULE",m.LINE)}}const Pi=function(e,t){Oe(e,t)};class Ii extends Pt{constructor(t,r){!t&&(t={});super(Pi,t,r);i(this,"MODULE",m.MESH)}}const ji=function(e,t){Oe(e,t)};class Gi extends Pt{constructor(t,r){!t&&(t={});super(ji,t,r);i(this,"MODULE",m.POINTS)}}const Ni=function(e,t){Oe(e,t)};class Hi extends gt{constructor(t,r){!t&&(t={});super(Ni,t,r);i(this,"MODULE",m.GROUP)}}const Ui=function(e,t){fe(e,t)};class Bi extends he{constructor(t,r){!t&&(t={});super(Ui,t,r);i(this,"MODULE",m.PASS)}}const zi=function(e,t){e.key==="name"&&e.path.length===1||fe(e,t)};class _i extends he{constructor(t,r){!t&&(t={});super(zi,t,r);i(this,"MODULE",m.ANIMATION)}}const ki=function(e,t){Oe(e,t)};class Fi extends gt{constructor(t,r){!t&&(t={});super(ki,t,r);i(this,"MODULE",m.CSS3D)}}class $i{constructor(t){i(this,"cameraDataSupport",new bi),i(this,"lightDataSupport",new Ei),i(this,"geometryDataSupport",new Si),i(this,"textureDataSupport",new pi),i(this,"materialDataSupport",new fi),i(this,"rendererDataSupport",new Ri),i(this,"sceneDataSupport",new Ti),i(this,"controlsDataSupport",new xi),i(this,"spriteDataSupport",new Li),i(this,"lineDataSupport",new Di),i(this,"meshDataSupport",new Ii),i(this,"pointsDataSupport",new Gi),i(this,"groupDataSupport",new Hi),i(this,"css3DDataSupport",new Fi),i(this,"passDataSupport",new Bi),i(this,"animationDataSupport",new _i),i(this,"dataSupportMap"),t&&Object.keys(t).forEach(s=>{this[s]!==void 0&&(this[s]=t[s])});const r=new Map;Object.keys(this).forEach(s=>{const n=this[s];n instanceof he&&r.set(n.MODULE,n)}),this.dataSupportMap=r}getDataSupport(t){return this.dataSupportMap.has(t)?this.dataSupportMap.get(t):(console.warn(`can not found this type in dataSupportManager: ${t}`),null)}getSupportData(t){return this.dataSupportMap.has(t)?this.dataSupportMap.get(t).getData():(console.warn(`can not found this type in dataSupportManager: ${t}`),null)}setSupportData(t,r){return this.dataSupportMap.has(t)?this.dataSupportMap.get(t).setData(r):console.warn(`can not found this type in dataSupportManager: ${t}`),this}getConfigBySymbol(t){const r=this.dataSupportMap.values();for(const s of r){const n=s.getConfig(t);if(n)return n}return null}removeConfigBySymbol(...t){const r=this.dataSupportMap.values();for(const s of t)for(const n of r)if(n.existSymbol(s)){n.removeConfig(s);break}return this}getModuleBySymbol(t){const r=this.dataSupportMap.values();for(const s of r)if(s.existSymbol(t))return s.MODULE;return null}applyConfig(...t){for(const r of t){const s=lr(r.type);s?this.dataSupportMap.get(s).addConfig(r):console.warn(`dataSupportManager can not found this config module: ${r.type}`)}return this}reactiveConfig(t){const r=lr(t.type);return r?this.dataSupportMap.get(r).addConfig(t).getConfig(t.vid):(console.warn(`dataSupportManager can not found this config module: ${t.type}`),t)}load(t){return this.dataSupportMap.forEach((s,n)=>{t[n]&&s.load(t[n])}),this}remove(t){return this.dataSupportMap.forEach((s,n)=>{t[n]&&s.remove(t[n])}),this}toJSON(t={},r=!0){return JSON.stringify(this.exportConfig(t,r),Ze)}exportConfig(t={},r=!0){return this.dataSupportMap.forEach((n,o)=>{t[o]=n.exportConfig(r)}),t}}const Wi=function(e){if(this.dataSupportManager)return console.warn("engine has installed dataSupportManager plugin."),!1;const t=new $i(e);return this.dataSupportManager=t,this.applyConfig=function(...r){return this.dataSupportManager.applyConfig(...r),this},this.reactiveConfig=function(r){return this.dataSupportManager.reactiveConfig(r)},this.getConfigBySymbol=function(r){return this.dataSupportManager.getConfigBySymbol(r)},this.removeConfigBySymbol=function(...r){return this.dataSupportManager.removeConfigBySymbol(...r),this},this.toJSON=function(){if(this.loaderManager){const r={assets:JSON.parse(this.loaderManager.toJSON())};return this.dataSupportManager.toJSON(r)}return this.dataSupportManager.toJSON()},this.exportConfig=function(){let r={};return this.loaderManager&&(r={assets:this.loaderManager.exportConfig()}),this.dataSupportManager.exportConfig(r)},this.completeSet.add(()=>{const r=this.dataSupportManager.getDataSupport(m.RENDERER).getData();r.WebGLRenderer||(r.WebGLRenderer=G(l.WEBGLRENDERER));const s=this.dataSupportManager.getDataSupport(m.CONTROLS).getData();this.transformControls&&(s[l.TRNASFORMCONTROLS]||(s[l.TRNASFORMCONTROLS]=G(l.TRNASFORMCONTROLS))),this.orbitControls&&(s[l.ORBITCONTROLS]||(s[l.ORBITCONTROLS]=G(l.ORBITCONTROLS)))}),!0},de=class{constructor(){i(this,"target",{}),i(this,"map",new Map),i(this,"weakMap",new WeakMap),i(this,"engine"),i(this,"cacheCompile")}getMap(){return this.map}useEngine(e){return this.engine=e,this}setTarget(e){return this.target=e,this}add(e){if(!de.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),null;const r=de.processors.get(e.type).create(e,this.engine);return this.map.set(e.vid,r),this.weakMap.set(r,e.vid),r}remove(e){const t=e.vid;if(!this.map.has(t))return console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this;if(!de.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),this;const r=this.map.get(t);return de.processors.get(e.type).dispose(r),this.map.delete(t),this.weakMap.delete(r),this}cover(e){const t=e.vid;return this.map.has(t)?(Promise.resolve().then(()=>{se(e,e,{vid:!0,type:!0})}),this):(console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this)}compile(e,t){const r=this.cacheCompile;let s,n,o;if(r&&r.vid===e)s=r.target,n=r.config,o=r.processor;else{if(!this.map.has(e))return console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e}'`),this;if(!this.target[e])return console.warn(`${this.MODULE} compiler set function: can not found config which vid is: '${e}'`),this;if(s=this.map.get(e),n=this.target[e],!de.processors.has(n.type))return console.warn(`PassCompiler can not support this type: ${n.type}`),this;o=de.processors.get(n.type),this.cacheCompile={target:s,config:n,processor:o,vid:e}}return o.process(F({config:n,target:s,engine:this.engine,processor:o},t)),this}compileAll(){const e=this.target;for(const t of Object.values(e))this.add(t);return this}dispose(){this.cacheCompile&&(this.cacheCompile=void 0);for(const e of Object.values(this.target)){if(!this.map.has(e.vid)){console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e.vid}'`);continue}const t=this.map.get(e.vid);if(!de.processors.has(e.type)){console.warn(`${this.MODULE}  can not support this type: ${e.type}`);continue}de.processors.get(e.type).dispose(t)}return this.map.clear(),this.target={},this}getObjectSymbol(e){return this.weakMap.get(e)||null}getObjectBySymbol(e){return this.map.get(e)||null}};let R=de;i(R,"processors",new Map);i(R,"processor",function(e){de.processors.set(e.configType,e)});const Je="vis.scriptAni";class Vi{constructor(t){i(this,"configType"),i(this,"commands"),i(this,"create"),i(this,"dispose"),this.configType=t.configType,this.commands=t.commands,this.create=t.create,this.dispose=t.dispose}process(t){if(!this.commands||!this.commands[t.operate]){this[t.operate](t);return}let r=this.commands[t.operate];for(const s of[].concat(t.path,t.key))if(!r[s]&&!r.$reg){this[t.operate](t);return}else if(r[s])if(typeof r[s]=="function"){r[s](t);return}else r=r[s];else if(r.$reg){for(const n of r.$reg)if(n.reg.test(s)){n.handler(t);return}}this[t.operate](t)}add(t){let r=t.target;const s=t.path;for(const n of s)if(typeof r[n]!==void 0)r=r[n];else{console.warn("processor can not exec default add operate.",t);return}r[t.key]=t.value}set(t){let r=t.target;const s=t.path;for(const n of s)if(typeof r[n]!==void 0)r=r[n];else{console.warn("processor can not exec default set operate.",t);return}r[t.key]=t.value}delete(t){let r=t.target;const s=t.path;for(const n of s)if(typeof r[n]!==void 0)r=r[n];else{console.warn("processor can not exec default delete operate.",t);return}delete r[t.key]}}const x=e=>new Vi(e),It=function(){},Yi={name:"linearTime",multiply:1},Qi=function(e,t,r,s){return t[r]===void 0?(console.warn(`object not exist attribute: ${r}`,t),n=>{}):typeof t[r]!="number"?(console.warn("object attribute is not typeof number.",t,r),n=>{}):n=>{t[r]+=n.delta*s.multiply}},Xi={name:"sinWave",wavelength:1,offset:0,amplitude:1,speed:1},Ki=function(e,t,r,s){if(t[r]===void 0)return console.warn(`object not exist attribute: ${r}`,t),o=>{};if(typeof t[r]!="number")return console.warn("object attribute is not typeof number.",t,r),o=>{};const n=t[r];return o=>{t[r]=n+s.amplitude*Math.sin(o.total*s.speed/s.wavelength)+s.offset}},ge=class{static generateConfig(e,t){if(!ge.configLibrary.has(e))return console.warn(`event library can not found config by name: ${e}`),{name:""};const r=(n,o)=>{for(const a in o)n[a]!==void 0&&(typeof o[a]=="object"&&o[a]!==null&&!Array.isArray(o[a])?r(n[a],o[a]):n[a]=o[a])},s=JSON.parse(JSON.stringify(ge.configLibrary.get(e)));return r(s,t),s}static generateScript(e,t,r,s){return ge.generatorLibrary.has(s.name)?ge.generatorLibrary.get(s.name)(e,t,r,s):(console.error(`event library can not found generator by name: ${s.name}`),()=>{})}static has(e){return ge.configLibrary.has(e)}};let qe=ge;i(qe,"configLibrary",new Map);i(qe,"generatorLibrary",new Map);i(qe,"register",function(e,t){ge.configLibrary.has(e.name)&&console.warn(`EventLibrary has already exist this event generator: ${e.name}, that will be cover.`),ge.configLibrary.set(e.name,JSON.parse(JSON.stringify(e))),ge.generatorLibrary.set(e.name,t)});qe.register(Yi,Qi);qe.register(Xi,Ki);const is=function(e,t){let r=t.compilerManager.getObjectBySymbol(e.target);r||console.error(`can not found object in enigne: ${e.target}`);const s=e.attribute.split(".");s.shift();const n=s.pop();for(const o of s){if(r[o]===void 0)return console.error(`animaton processor: target object can not found key: ${o}`,r),()=>{};r=r[o]}return qe.generateScript(t,r,n,e.script)};var Zi=x({configType:l.SCRIPTANIMATION,commands:{set:{play({target:e,engine:t,value:r}){r?t.renderManager.addEventListener("render",e):t.renderManager.removeEventListener("render",e)},$reg:[{reg:new RegExp(".*"),handler({config:e,engine:t}){const r=e[Symbol.for(Je)];t.renderManager.removeEventListener("render",r);const s=is(e,t);e[Symbol.for(Je)]=s,e.play&&t.renderManager.addEventListener("render",r)}}]}},create(e,t){const r=is(e,t);return e.play&&t.renderManager.addEventListener("render",r),e[Symbol.for(Je)]=r,r},dispose(){}});class Ji extends R{constructor(){super();i(this,"MODULE",m.ANIMATION)}cover(t){super.cover(t);const r=this.map.get(t.vid);return t[Symbol.for(Je)]=r,this}remove(t){return delete t[Symbol.for(Je)],super.remove(t),this}compile(t,r){super.compile(t,r);const s=this.target[t],n=this.map.get(s.vid);return s[Symbol.for(Je)]=n,this}}R.processor(Zi);class Ue extends R{constructor(){super()}}const qi={name:"openWindow",params:{url:""}},ea=function(e,t){return()=>{window.open(t.params.url)}},ta={name:"visibleObject",params:{target:"",visible:!0,delay:0}},ra=function(e,t){const r=t.params,s=e.getObjectBySymbol(r.target);return s?()=>{setTimeout(()=>{s.visible=r.visible},r.delay)}:(console.warn(`basic event visibleObject: can not found vid object: ${r.target}`),()=>{})},sa={name:"addClass",params:{target:"",className:"",delay:0}},na=function(e,t){const r=t.params,s=[];if(r.target==="all")e.scene.traverse(n=>{n instanceof ut&&s.push(n)});else if(Array.isArray(r.target))r.target.forEach(n=>{const o=e.getObjectBySymbol(n);o?s.push(o):console.warn(`basic event AddClass: can not found vid object: ${r.target}`)});else{const n=e.getObjectBySymbol(r.target);if(!n)return console.warn(`basic event AddClass: can not found vid object: ${r.target}`),()=>{};if(!(n instanceof ut))return console.warn("basic event AddClass: object is not a CSS3DObject."),()=>{};s.push(n)}return s.length?()=>{setTimeout(()=>{s.forEach(n=>{n.element.classList.add(r.className)})},r.delay)}:(console.warn(`basic event AddClass: can not found vid object: ${r.target}`),()=>{})},oa={name:"changeScene",params:{scene:"Scene",delay:0}},ia=function(e,t){const r=t.params;return()=>{setTimeout(()=>{e.setScene(r.scene)},r.delay)}},aa={name:"changeCamera",params:{camera:"",delay:0}},ca=function(e,t){const r=t.params;return()=>{setTimeout(()=>{e.setCamera(r.camera)},r.delay)}},la={name:"switchAnimate",params:{target:"",toggle:"auto",delay:0}},ha=function(e,t){const r=t.params,s=e.getConfigBySymbol(r.target);return s?()=>{setTimeout(()=>{if(r.toggle==="auto"){s.play!=s.play;return}if(r.toggle==="off"){s.play=!1;return}if(r.toggle==="on"){s.play=!0;return}},r.delay)}:(console.warn(`basic event switchAnimate: can not found vid config: ${r.target}`),()=>{})};var K;(function(e){e.ELN="ELN",e.EQI="EQI",e.EQO="EQO",e.EASING_LINEAR_NONE="EASING_LINEAR_NONE",e.EASING_QUARTIC_IN="EASING_QUARTIC_IN",e.EASING_QUARTIC_OUT="EASING_QUARTIC_OUT",e.EASING_QUARTIC_INOUT="EASING_QUARTIC_INOUT",e.EASING_QUADRATIC_IN="EASING_QUADRATIC_IN",e.EASING_QUADRATIC_OUT="EASING_QUADRATIC_OUT",e.EASING_QUADRATIC_INOUT="EASING_QUADRATIC_INOUT"})(K||(K={}));const B={ELN:ie.Linear.None,EQI:ie.Quartic.In,EQO:ie.Quartic.Out,EASING_LINEAR_NONE:ie.Linear.None,EASING_QUARTIC_IN:ie.Quartic.In,EASING_QUARTIC_OUT:ie.Quartic.Out,EASING_QUARTIC_INOUT:ie.Quartic.InOut,EASING_QUADRATIC_IN:ie.Quadratic.In,EASING_QUADRATIC_OUT:ie.Quadratic.Out,EASING_QUADRATIC_INOUT:ie.Quadratic.InOut},da={name:"moveTo",params:{target:"",position:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:K.EASING_QUADRATIC_INOUT}},ua=function(e,t){const r=t.params,n=e.compilerManager.getObjectBySymbol(r.target);if(!n)return console.warn(`real time animation moveTO: can not found vid object: ${r.target}`),()=>{};const o=e.renderManager,a=e.dataSupportManager.getConfigBySymbol(r.target);if(!a)return console.warn(`can not found object config: ${r.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0;const d=new U(n.position).to(r.position).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start(),h=p=>{d.update()};o.addEventListener("render",h),d.onComplete(()=>{o.removeEventListener("render",h),a.position.x=r.position.x,a.position.y=r.position.y,a.position.z=r.position.z,c=!1})}},pa={name:"rotationTo",params:{target:"",rotation:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:K.EASING_QUADRATIC_INOUT}},ma=function(e,t){const r=t.params,n=e.compilerManager.getObjectBySymbol(r.target);if(!n)return console.warn(`real time animation moveTO: can not found vid object: ${r.target}`),()=>{};const o=e.renderManager,a=e.dataSupportManager.getConfigBySymbol(r.target);if(!a)return console.warn(`can not found object config: ${r.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0;const d=new U(n.rotation).to(r.rotation).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start(),h=p=>{d.update()};o.addEventListener("render",h),d.onComplete(()=>{o.removeEventListener("render",h),a.rotation.x=r.rotation.x,a.rotation.y=r.rotation.y,a.rotation.z=r.rotation.z,c=!1})}},fa={name:"upTo",params:{target:"",up:{x:0,y:1,z:0},delay:0,duration:1e3,timingFunction:K.EASING_QUADRATIC_INOUT}},ga=function(e,t){const r=t.params,n=e.compilerManager.getObjectBySymbol(r.target);if(!n)return console.warn(`real time animation upTo: can not found vid object: ${r.target}`),()=>{};const o=e.renderManager,a=e.dataSupportManager.getConfigBySymbol(r.target);if(!a)return console.warn(`can not found object config: ${r.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0;const d=new U(n.up).to(r.up).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start(),h=p=>{d.update()};o.addEventListener("render",h),d.onComplete(()=>{o.removeEventListener("render",h),a.up.x=r.up.x,a.up.y=r.up.y,a.up.z=r.up.z,c=!1})}},Ea={name:"moveFromTo",params:{target:"",from:{x:0,y:0,z:0},to:{x:10,y:10,z:10},delay:0,duration:1e3,timingFunction:K.EASING_QUADRATIC_INOUT}},ya=function(e,t){const r=t.params,n=e.compilerManager.getObjectBySymbol(r.target);if(!n)return console.warn(`real time animation moveTO: can not found vid object: ${r.target}`),()=>{};const o=e.renderManager,a=e.dataSupportManager.getConfigBySymbol(r.target);if(!a)return console.warn(`can not found object config: ${r.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0,n.position.set(r.from.x,r.from.y,r.from.z),n.updateMatrix(),n.updateMatrixWorld();const d=new U(n.position).to(r.to).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start(),h=p=>{d.update()};o.addEventListener("render",h),d.onComplete(()=>{o.removeEventListener("render",h),a.position.x=r.to.x,a.position.y=r.to.y,a.position.z=r.to.z,c=!1})}},Sa={name:"moveSpacing",params:{target:"",spacing:{x:10,y:10,z:10},delay:0,duration:1e3,timingFunction:K.EASING_QUADRATIC_INOUT}},Ma=function(e,t){const r=t.params,s=e.getObjectBySymbol(r.target);if(!s)return console.warn(`can not found vid object: ${r.target}`),()=>{};if(!(s instanceof $e))return console.warn(`object is not instanceof Object3D: ${r.target}`),()=>{};const n=e.renderManager,o=e.getConfigBySymbol(r.target);let a=!1;return()=>{if(a)return;a=!0;const c={x:s.position.x+r.spacing.x,y:s.position.y+r.spacing.y,z:s.position.z+r.spacing.z},d=new U(s.position).to(c).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start(),h=p=>{d.update()};n.addEventListener("render",h),d.onComplete(()=>{n.removeEventListener("render",h),o.position.x=c.x,o.position.y=c.y,o.position.z=c.z,a=!1})}},ba={name:"moveToObject",params:{target:"",to:"",offset:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:K.EASING_QUADRATIC_INOUT}},va=function(e,t){const r=t.params,s=e.compilerManager,n=s.getObjectBySymbol(r.target),o=s.getObjectBySymbol(r.to);if(!n)return console.warn(`real time animation MoveToObject: can not found vid object: ${r.target}`),()=>{};if(!o)return console.warn(`real time animation MoveToObject: can not found vid object: ${r.target}`),()=>{};const a=e.renderManager,c=e.dataSupportManager.getConfigBySymbol(r.target);if(!c)return console.warn(`can not found object config: ${r.target}`),()=>{};let d=!1;return()=>{if(d)return;d=!0;const h={x:o.position.x+r.offset.x,y:o.position.y+r.offset.y,z:o.position.z+r.offset.z},p=new U(n.position).to(h).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start(),f=g=>{p.update()};a.addEventListener("render",f),p.onComplete(()=>{a.removeEventListener("render",f),c.position.x=h.x,c.position.y=h.y,c.position.z=h.z,d=!1})}},Ra={name:"vector3To",params:{target:"",attribute:".position",props:{x:"x",y:"y",z:"z"},delay:0,duration:500,to:{},timingFunction:K.EASING_QUADRATIC_INOUT}},wa=function(e,t){var r,s,n;const o=t.params,a=e.compilerManager.getObjectBySymbol(o.target);if(!a)return console.warn(`real time animation vector3To: can not found vid object: ${o.target}`),()=>{};const c=e.renderManager;let d=e.dataSupportManager.getConfigBySymbol(o.target);if(!d)return console.warn(`real time animation vector3To: can not found object config: ${o.target}`),()=>{};const h=o.attribute.split(".");h.shift();let p=a;for(const b of h){if(p[b]===void 0)return console.error(`real time animation vector3To: object can not support key: ${b}`,a),()=>{};p=p[b],d=d[b]}const f=o.props;if(!(f.x in p)||!(f.y in p)||!(f.z in p))return console.error("real time animation vector3To: object can not support props:",p,f),()=>{};if(!(f.x in d)||!(f.y in d)||!(f.z in d))return console.error("real time animation vector3To: config can not support props:",d,f),()=>{};const g={x:(r=o.to.x)!=null?r:p[f.x],y:(s=o.to.y)!=null?s:p[f.y],z:(n=o.to.z)!=null?n:p[f.z]};let S=!1;return()=>{if(S)return;S=!0;const b=new U(p).to(g).duration(o.duration).delay(o.delay).easing(B[o.timingFunction]).start(),T=w=>{b.update()};c.addEventListener("render",T),b.onComplete(()=>{c.removeEventListener("render",T),d[f.x]=g.x,d[f.y]=g.y,d[f.z]=g.z,S=!1})}},Ta={name:"focusObject",params:{target:"",camera:"",space:"world",offset:{x:0,y:0,z:20},delay:0,duration:1e3,timingFunction:K.EASING_QUADRATIC_INOUT,back:!0}},Ca=function(e,t){const r=t.params,s=e.getObjectBySymbol(r.target),n=e.orbitControls.target;if(!s)return console.warn(`real time animation focusObject: can not found vid object: ${r.target}`),()=>{};if(!(s instanceof $e))return console.warn(`real time animation focusObject: vid object is not a class of THREE.Object3D: ${r.target}`),()=>{};let o=!1;const a=new er;return()=>{if(o)return;o=!0;let c=e.camera;r.camera&&(c=e.getObjectBySymbol(r.camera),c||(c=e.camera,console.warn(`real time animation focusObject: can not found camera config: ${r.camera}`)));const d=e.getObjectConfig(c),h=e.orbitControls&&e.orbitControls.object===c;d||console.warn("engine current camera can not found config.");const p=e.renderManager;let f={x:s.matrixWorld.elements[12]+r.offset.x,y:s.matrixWorld.elements[13]+r.offset.y,z:s.matrixWorld.elements[14]+r.offset.z};const g={x:c.position.x,y:c.position.y,z:c.position.z};if(r.space==="local"){const P=new A(r.offset.x,r.offset.y,r.offset.z).applyEuler(a.setFromRotationMatrix(s.matrixWorld));f={x:s.matrixWorld.elements[12]+P.x,y:s.matrixWorld.elements[13]+P.y,z:s.matrixWorld.elements[14]+P.z}}const S=new U(c.position).to(f).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start();let b;const T={x:c.up.x,y:c.up.y,z:c.up.z};if(r.space==="local"){const P=new A(0,1,0).applyEuler(a.setFromRotationMatrix(s.matrixWorld));b=new U(c.up).to({x:P.x,y:P.y,z:P.z}).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start()}let w;const M={x:n.x,y:n.y,z:n.z};h&&(w=new U(n).to({x:s.matrixWorld.elements[12],y:s.matrixWorld.elements[13],z:s.matrixWorld.elements[14]}).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start());let L;h&&r.space==="local"?L=P=>{S.update(),b.update(),w.update()}:h?L=P=>{S.update(),w.update()}:r.space==="local"?L=P=>{S.update(),b.update()}:L=P=>{S.update()},p.addEventListener("render",L),S.onComplete(()=>{if(p.removeEventListener("render",L),d&&(d.position.x=f.x,d.position.y=f.y,d.position.z=f.z),o=!1,r.back){const P=()=>{const C=new U(c.position).to(g).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start();let $;r.space==="local"&&($=new U(c.up).to(T).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start());let E;h&&(E=new U(n).to(M).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start());const V=D=>{C.update(),$&&$.update(),E&&E.update()};C.onComplete(()=>{p.removeEventListener("render",V)}),p.addEventListener("render",V),document.removeEventListener("dblclick",P)};document.addEventListener("dblclick",P)}})}},xa={name:"fadeObject",params:{target:"",direction:"out",delay:0,duration:300,timingFunction:K.EASING_QUADRATIC_INOUT,visible:!0}},Oa=function(e,t){const r=t.params,s=e.getObjectBySymbol(r.target);if(!s)return console.warn(`real time animation fadeObject: can not found vid object: ${r.target}`),()=>{};const n=e.getObjectConfig(s);if(!n.material)return console.warn(`real time animation fadeObject: target can not support fade: ${r.target}`),()=>{};const o=[],a=[],c=Array.isArray(n.material)?[].concat(n.material):[n.material];for(const h of c){const p=e.getObjectBySymbol(h),f=e.getConfigBySymbol(h);if(!(p instanceof Qr)){console.error(`real time animation fadeObject: object config material is not instanceof Material: ${h}`);continue}if(!f){console.error(`real time animation fadeObject: object config material can not found config: ${h}`);continue}o.push(p),a.push(f)}let d=!1;return()=>{if(d)return;d=!0;const h=e.renderManager;n.visible=!0,o.forEach((p,f,g)=>{p.visible=!0,p.transparent=!0,p.opacity=r.direction==="in"?0:1,p.needsUpdate=!0;const S=new U(p).to({opacity:r.direction==="in"?1:0}).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start(),b=T=>{S.update()};h.addEventListener("render",b),S.onComplete(()=>{h.removeEventListener("render",b),r.direction==="out"&&r.visible?(a[f].visible=!1,n.visible=!1):r.direction==="in"&&r.visible&&(a[f].visible=!0,n.visible=!0),a[f].opacity=r.direction==="in"?1:0,d=!1})})}},La={name:"showToCamera",params:{target:"",offset:{x:0,y:0,z:-30},delay:0,duration:1e3,timingFunction:K.EASING_QUADRATIC_INOUT,back:!0}},Aa=function(e,t){const r=t.params,s=e.getObjectBySymbol(r.target),n=e.getConfigBySymbol(r.target),o=e.camera;if(!s)return console.warn(`real time animation showToCamera: can not found vid object: ${r.target}`),()=>{};if(!s)return console.warn(`real time animation showToCamera: can not found vid config: ${r.target}`),()=>{};if(!(s instanceof $e))return console.warn(`real time animation showToCamera: vid object is not a class of THREE.Object3D: ${r.target}`),()=>{};const a=new _r,c=new er,d=new A;let h=!1;return()=>{if(h)return;h=!0;const p=e.renderManager;d.set(r.offset.x,r.offset.y,r.offset.z).applyEuler(o.rotation),d.set(o.position.x+d.x,o.position.y+d.y,o.position.z+d.z),a.lookAt(o.position,d,o.up),c.setFromRotationMatrix(a);const f={x:s.position.x,y:s.position.y,z:s.position.z},g={x:s.rotation.x,y:s.rotation.y,z:s.rotation.z},S=new U(s.position).to({x:d.x,y:d.y,z:d.z}).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start(),b=new U(s.rotation).to({x:c.x,y:c.y,z:c.z}).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start(),T=w=>{S.update(),b.update()};p.addEventListener("render",T),S.onComplete(()=>{if(p.removeEventListener("render",T),n.position.x=d.x,n.position.y=d.y,n.position.z=d.z,n.rotation.x=c.x,n.rotation.y=c.y,n.rotation.z=c.z,h=!1,r.back){const w=()=>{const M=new U(s.position).to(f).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start(),L=new U(s.rotation).to(g).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start(),P=C=>{M.update(),L.update()};M.onComplete(()=>{p.removeEventListener("render",P),n.position.x=f.x,n.position.y=f.y,n.position.z=f.z,n.rotation.x=g.x,n.rotation.y=g.y,n.rotation.z=g.z}),p.addEventListener("render",P),document.removeEventListener("dblclick",w)};document.addEventListener("dblclick",w)}})}},Da={name:"colorChange",params:{target:"",attribute:"color",color:"rgb(255, 255, 255)",delay:0,duration:500,timingFunction:K.EASING_QUADRATIC_INOUT}},Pa=function(e,t){const r=t.params,s=e.getObjectBySymbol(r.target);if(!s)return console.warn(`real time animation ColorChange: can not found vid material: ${r.target}`),()=>{};if(!s[r.attribute]||!(s[r.attribute]instanceof k))return console.warn(`real time animation ColorChange: material attribute is illeage: ${r.attribute}`),()=>{};const n=e.getConfigBySymbol(r.target);if(!n)return console.warn(`real time animation ColorChange: can not found material config: ${r.target}`),()=>{};const o=new k(r.color),a=e.renderManager;let c=!1;return()=>{if(c)return;c=!0;const d=new U(s[r.attribute]).to({r:o.r,g:o.g,b:o.b}).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start(),h=p=>{d.update()};a.addEventListener("render",h),d.onComplete(()=>{a.removeEventListener("render",h),n[r.attribute]=r.color,c=!1})}},Ia={name:"orbitTargetMove",params:{target:"",offset:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:K.EASING_QUADRATIC_INOUT}},ja=function(e,t){const r=t.params;if(e.compilerManager,!e.orbitControls)return console.warn("real time animation orbitTargetMove: engine can not install orbitControls."),()=>{};const s=e.renderManager;let n=!1;return()=>{if(n)return;n=!0;let o=r.offset;if(r.target){const d=e.getObjectBySymbol(r.target);d?o={x:d.matrixWorld.elements[12]+o.x,y:d.matrixWorld.elements[13]+o.y,z:d.matrixWorld.elements[14]+o.z}:console.warn(`real time animation orbitTargetMove: can not found vid object: ${r.target}`)}const a=new U(e.orbitControls.target).to(o).duration(r.duration).delay(r.delay).easing(B[r.timingFunction]).start(),c=d=>{a.update()};s.addEventListener("render",c),a.onComplete(()=>{s.removeEventListener("render",c),n=!1})}},Ee=class{static generateConfig(e,t){if(!Ee.configLibrary.has(e))return console.warn(`event library can not found config by name: ${e}`),{name:""};const r=(n,o)=>{for(const a in o)typeof o[a]=="object"&&o[a]!==null&&!Array.isArray(o[a])?r(n[a],o[a]):n[a]=o[a]},s=JSON.parse(JSON.stringify(Ee.configLibrary.get(e)));return r(s,t),s}static generateEvent(e,t){return Ee.generatorLibrary.has(e.name)?Ee.generatorLibrary.get(e.name)(t,e):(console.error(`event library can not found generator by name: ${e.name}`),()=>{})}static has(e){return Ee.configLibrary.has(e)}};let N=Ee;i(N,"configLibrary",new Map);i(N,"generatorLibrary",new Map);i(N,"register",function(e,t){Ee.configLibrary.has(e.name)&&console.warn(`EventLibrary has already exist this event generator: ${e.name}, that will be cover.`),Ee.configLibrary.set(e.name,JSON.parse(JSON.stringify(e))),Ee.generatorLibrary.set(e.name,t)});N.register(qi,ea);N.register(ta,ra);N.register(sa,na);N.register(oa,ia);N.register(aa,ca);N.register(la,ha);N.register(da,ua);N.register(pa,ma);N.register(fa,ga);N.register(Ea,ya);N.register(Sa,Ma);N.register(ba,va);N.register(Ra,wa);N.register(Ta,Ca);N.register(xa,Oa);N.register(La,Aa);N.register(Da,Pa);N.register(Ia,ja);const as=new WeakMap,cs=function({target:e,config:t,value:r,engine:s}){if(t.vid===r){console.warn("can not set object lookAt itself.");return}let n=as.get(e);if(n||(n={lookAtTarget:null,updateMatrixWorldFun:null},as.set(e,n)),!r){if(!n.updateMatrixWorldFun)return;e.updateMatrixWorld=n.updateMatrixWorldFun,n.lookAtTarget=null,n.updateMatrixWorldFun=null;return}const o=s.compilerManager.getObject3D(r);if(!o){console.warn(`lookAt handler can not found this vid mapping object: '${r}'`);return}const a=e.updateMatrixWorld;n.updateMatrixWorldFun=a,n.lookAtTarget=o.position,e.updateMatrixWorld=c=>{a.call(e,c),e.lookAt(n.lookAtTarget)}},Et="vis.event",ye=function({target:e,path:t,value:r,engine:s}){const n=t[0];if(!N.has(r.name)){console.warn(`EventLibrary: can not support this event: ${r.name}`);return}const o=N.generateEvent(r,s),a=Symbol.for(Et);r[a]=o,e.addEventListener(n,o)},Le=function({target:e,path:t,value:r}){const s=t[0],n=r[Symbol.for(Et)];if(!n){console.warn("event remove can not fun found event in config",r);return}e.removeEventListener(s,n),delete r[Symbol.for(Et)]},Ae=function({target:e,config:t,path:r,engine:s}){const n=r[0],o=t[r[0]][r[1]],a=o[Symbol.for(Et)];if(!a){console.warn("event remove can not fun found event in config",o);return}e.removeEventListener(n,a);const c=N.generateEvent(t,s);o[Et]=c,e.addEventListener(n,c)},ur=function({target:e,config:t,value:r,engine:s}){const n=s.getConfigBySymbol(r);if(!n){console.warn(` can not foud object config in engine: ${r}`);return}if(n.parent&&n.parent!==t.vid){const a=s.getConfigBySymbol(n.parent);if(!a){console.warn(` can not foud object parent config in engine: ${n.parent}`);return}a.children.splice(a.children.indexOf(r),1)}n.parent=t.vid;const o=s.compilerManager.getObject3D(r);if(!o){console.warn(`can not found this vid in engine: ${r}.`);return}e.add(o)},Ga=function({target:e,config:t,value:r,engine:s}){const n=s.compilerManager.getObject3D(r);if(!n){console.warn(`can not found this vid in engine: ${r}.`);return}e.remove(n);const o=s.getConfigBySymbol(r);if(!o){console.warn(`can not found this vid in engine: ${r}.`);return}o.parent=""},De=function(e,t,r,s){return Promise.resolve().then(()=>{!r.lookAt&&cs({target:e,config:t,engine:s,value:t.lookAt}),t.children.forEach(o=>{ur({target:e,config:t,value:o,engine:s})});for(const o of Object.values(or))t[o].forEach((a,c)=>{ye({target:e,path:[o,c.toString()],value:a,engine:s})})}),se(t,e,F({vid:!0,type:!0,lookAt:!0,parent:!0,children:!0,pointerdown:!0,pointermove:!0,pointerup:!0,pointerenter:!0,pointerleave:!0,click:!0,dblclick:!0,contextmenu:!0},r)),e},ne=function(e){e._listener={}},z={add:{pointerdown:ye,pointerup:ye,pointermove:ye,pointerenter:ye,pointerleave:ye,click:ye,dblclick:ye,contextmenu:ye,children:ur},set:{lookAt:cs,pointerdown:Ae,pointerup:Ae,pointermove:Ae,pointerenter:Ae,pointerleave:Ae,click:Ae,dblclick:Ae,contextmenu:Ae,parent:It,children:{$reg:[{reg:new RegExp(".*"),handler:ur}]}},delete:{pointerdown:Le,pointerup:Le,pointermove:Le,pointerenter:Le,pointerleave:Le,click:Le,dblclick:Le,contextmenu:Le,children:Ga}},re=new WeakMap;var Na=x({configType:l.PERSPECTIVECAMERA,commands:{add:F({scale(){}},z.add),set:Ct(F({scale(){},adaptiveWindow({target:e,value:t,engine:r}){if(t){if(!re.has(t)){const s=n=>{e.aspect=n.width/n.height,e.updateProjectionMatrix()};re.set(e,s),r.addEventListener("setSize",s),s({type:"setSize",width:r.dom.offsetWidth,height:r.dom.offsetHeight})}}else{const s=re.get(e);s&&(r.removeEventListener("setSize",s),re.delete(e))}}},z.set),{$reg:[{reg:new RegExp("fov|aspect|near|far"),handler({target:e,key:t,value:r}){e[t]=r,e.updateProjectionMatrix()}}]}),delete:F({scale(){}},z.delete)},create(e,t){const r=new ee;if(De(r,e,{scale:!0,adaptiveWindow:!0},t),r.updateProjectionMatrix(),e.adaptiveWindow){const s=n=>{r.aspect=n.width/n.height,r.updateProjectionMatrix()};re.set(r,s),t.addEventListener("setSize",s),s({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}return r},dispose(e){re.delete(e),ne(e)}}),Ha=x({configType:l.ORTHOGRAPHICCAMERA,commands:{add:F({scale(){}},z.add),set:Ct(F({scale(){},adaptiveWindow({target:e,value:t,engine:r}){if(t){if(!re.has(t)){const s=n=>{const o=n.width,a=n.height;e.left=-o,e.right=o,e.top=a,e.bottom=-a,e.updateProjectionMatrix()};re.set(e,s),r.addEventListener("setSize",s),s({type:"setSize",width:r.dom.offsetWidth,height:r.dom.offsetHeight})}}else{const s=re.get(e);s&&(r.removeEventListener("setSize",s),re.delete(e))}}},z.set),{$reg:[{reg:new RegExp("left|right|top|bottom|near|far|zoom"),handler({target:e,key:t,value:r}){e[t]=r,e.updateProjectionMatrix()}}]}),delete:F({scale(){}},z.delete)},create(e,t){const r=new Ie(-50,50,50,-50);if(De(r,e,{scale:!0,adaptiveWindow:!0},t),r.updateProjectionMatrix(),e.adaptiveWindow){const s=n=>{const o=n.width,a=n.height;r.left=-o,r.right=o,r.top=a,r.bottom=-a,r.updateProjectionMatrix()};re.set(r,s),t.addEventListener("setSize",s),s({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}return r},dispose(e){re.delete(e),ne(e)}});class Ua extends Ue{constructor(){super();i(this,"MODULE",m.CAMERA)}}R.processor(Na);R.processor(Ha);var Ba=x({configType:l.ORBITCONTROLS,commands:{set:{target({target:e,config:t,path:r,key:s,value:n}){const o=t.target;if(!t.type){t.target=new A(0,0,0);return}typeof t.target=="string"||(r.length>1?e.target[s]=n:e.target=new A(o.x,o.y,o.z))}}},create(e,t){let r;return t.orbitControls?r=t.orbitControls:(r=new es,r.setCamera(t.camera),r.setDom(t.dom)),e.target&&(typeof e.target=="string"||(r.target=new A(e.target.x,e.target.y,e.target.z))),se(e,r,{target:!0}),r},dispose(e){e.dispose()}}),za=x({configType:l.TRNASFORMCONTROLS,commands:{set:{snapAllow({target:e,config:t,value:r}){r?(e.translationSnap=t.translationSnap,e.rotationSnap=t.rotationSnap,e.scaleSnap=t.scaleSnap):(e.translationSnap=null,e.rotationSnap=null,e.scaleSnap=null)},translationSnap({target:e,config:t,value:r}){t.snapAllow&&(e.translationSnap=r)},rotationSnap({target:e,config:t,value:r}){t.snapAllow&&(e.rotationSnap=r)},scaleSnap({target:e,config:t,value:r}){t.snapAllow&&(e.scaleSnap=r)}}},create(e,t){let r;return t.transformControls?r=t.transformControls:(r=new ts,r.setCamera(t.camera),r.setDom(t.dom)),e.snapAllow&&(r.translationSnap=e.translationSnap,r.rotationSnap=e.rotationSnap,r.scaleSnap=e.scaleSnap),r},dispose(e){e.dispose()}});class _a extends R{constructor(){super();i(this,"MODULE",m.CONTROLS)}useEngine(t){return t.transformControls&&(this.map.set(l.TRNASFORMCONTROLS,t.transformControls),this.weakMap.set(t.transformControls,l.TRNASFORMCONTROLS)),t.orbitControls&&(this.map.set(l.ORBITCONTROLS,t.orbitControls),this.weakMap.set(t.orbitControls,l.ORBITCONTROLS)),super.useEngine(t)}}R.processor(Ba);R.processor(za);const jt=function(e,t){const r=t.resourceManager.resourceMap;if(!r.has(e))return console.warn(`css3D compiler: can not found resource element: ${e}`),document.createElement("div");const s=r.get(e);return s instanceof HTMLElement?s:(console.warn("css3D compiler can not suport render this resource type.",s.constructor,e),document.createElement("div"))};var ka=x({configType:l.CSS3DOBJECT,commands:{add:z.add,set:F({element({target:e,value:t,engine:r}){e.element=jt(t,r)}},z.set),delete:z.delete},create(e,t){return De(new ut(jt(e.element,t)),e,{element:!0},t)},dispose:ne});class Fa extends ut{constructor(t=document.createElement("div")){const r=document.createElement("div"),s=50,n=50;r.style.width=`${s}px`,r.style.height=`${n}px`,r.appendChild(t);super(r);i(this,"geometry"),i(this,"_width"),i(this,"_height"),i(this,"cacheBox",new Fs),this.geometry=new Re(s,n),this.geometry.computeBoundingBox(),this._width=s,this._height=n}get width(){return this._width}set width(t){this.geometry.dispose(),this.geometry=new Re(t,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${t}px`,this._width=t}get height(){return this._height}set height(t){this.geometry.dispose(),this.geometry=new Re(this._width,t),this.geometry.computeBoundingBox(),this.element.style.height=`${t}px`,this._height=t}}class $a extends Fa{constructor(t=document.createElement("div")){super(t);this.element.classList.add("vis-css3d-plane")}raycast(t,r){const s=this.cacheBox.copy(this.geometry.boundingBox);s.applyMatrix4(this.matrixWorld),t.ray.intersectsBox(s)&&r.push({distance:t.ray.origin.distanceTo(this.position),object:this,point:this.position})}}var Wa=x({configType:l.CSS3DPLANE,commands:{add:z.add,set:F({element({target:e,value:t,engine:r}){e.element=jt(t,r)}},z.set),delete:z.delete},create(e,t){return De(new $a(jt(e.element,t)),e,{element:!0},t)},dispose:ne});class Va extends Ue{constructor(){super();i(this,"MODULE",m.CSS3D)}}R.processor(Wa);R.processor(ka);class et extends J{constructor(t=[],r=36,s=!0){super();i(this,"parameters"),this.type="CurveGeometry",this.parameters={path:t.map(n=>n.clone()),space:s,divisions:r}}}class Ya extends et{constructor(t=[],r=36,s=!0){super(t,r,s);this.type="QuadraticBezierCurveGeometry";const n=new bt;if(t.length<3){console.warn("QuadraticBezierCurveGeometry path length at least 3.");return}const o=3+(t.length-3)-(t.length-3)%2;for(let c=1;c<o;c+=2)n.add(new En(t[c-1],t[c],t[c+1]));const a=n.curves.reduce((c,d)=>c+=d.arcLengthDivisions,0);if(r>a){const c=Math.ceil((r-a)/n.curves.length);n.curves.forEach(d=>{d.arcLengthDivisions=d.arcLengthDivisions*(c+1),d.updateArcLengths()})}this.setFromPoints(s?n.getSpacedPoints(r):n.getPoints(r))}}class Qa extends et{constructor(t=[],r=36,s=!0){super(t,r,s);this.type="CubicBezierCurveGeometry";const n=new bt;if(t.length<4){console.warn("CubicBezierCurveGeometry path length at least 4.");return}const o=4+(t.length-4)-(t.length-4)%3;for(let c=2;c<o;c+=3)n.add(new yn(t[c-2],t[c-1],t[c],t[c+1]));const a=n.curves.reduce((c,d)=>c+=d.arcLengthDivisions,0);if(r>a){const c=Math.ceil((r-a)/n.curves.length);n.curves.forEach(d=>{d.arcLengthDivisions=d.arcLengthDivisions*(c+1),d.updateArcLengths()})}this.setFromPoints(s?n.getSpacedPoints(r):n.getPoints(r))}}class Xa extends et{constructor(t=[],r=36,s=!0){super(t,r,s);if(this.type="LineCurveGeometry",!t.length){console.warn("LineCurveGeometry path length at least 1.");return}const n=new bt;for(let a=1;a<t.length;a+=1)n.add(new jr(t[a-1],t[a]));const o=n.curves.reduce((a,c)=>a+=c.arcLengthDivisions,0);if(r>o){const a=Math.ceil((r-o)/n.curves.length);n.curves.forEach(c=>{c.arcLengthDivisions=c.arcLengthDivisions*(a+1),c.updateArcLengths()})}this.setFromPoints(s?n.getSpacedPoints(r):n.getPoints(r))}}class Ka extends et{constructor(t=[],r=36,s=!0){super(t,r,s);if(this.type="SplineCurveGeometry",!t.length){console.warn("SplineCurveGeometry path length at least 1.");return}const n=new Gr(t);this.setFromPoints(s?n.getSpacedPoints(r):n.getPoints(r))}}class Za extends Mt{constructor(t=[],r=64,s=1,n=8,o=!1){if(!t.length){console.warn("LineTubeGeometry path length at least 1.");return}const a=new bt;for(let c=1;c<t.length;c+=1)a.add(new jr(t[c-1],t[c]));super(a,r,s,n,o);this.type="LineTubeGeometry"}}class Ja extends Mt{constructor(t=[],r=64,s=1,n=8,o=!1){if(!t.length){console.warn("SplineTubeGeometry path length at least 1.");return}const a=new Gr(t);super(a,r,s,n,o);this.type="SplineTubeGeometry"}}class qa extends Qt{constructor(t=[new H(0,0)],r=12){const s=new $s,n=t[0];if(n){s.moveTo(n.x,n.y);for(let o=1;o<t.length;o+=1)s.lineTo(t[o].x,t[o].y)}super(s,r);this.type="LineShapeGeometry"}}const ec=function(e,t){!(e instanceof et)&&!(e instanceof Mt)&&!(e instanceof Qt)&&e.center(),e.computeBoundingBox();const r=e.boundingBox,s=t.position,n=t.rotation,o=t.scale,a=new Jt().setFromEuler(new er(n.x,n.y,n.z,"XYZ"));return e.applyQuaternion(a),e.scale(o.x,o.y,o.z),!(e instanceof et)&&!(e instanceof Mt)&&!(e instanceof Qt)&&e.center(),e.computeBoundingBox(),e.translate((r.max.x-r.min.x)/2*s.x,(r.max.y-r.min.y)/2*s.y,(r.max.z-r.min.z)/2*s.z),e},pr={reg:new RegExp(".*"),handler({config:e,target:t,processor:r,engine:s}){const n=r.create(e,s);t.copy(n),t.dispatchEvent({type:"update"}),t.uuid=n.uuid,n.dispose()}},Gt={add:{groups({target:e,value:t}){e.addGroup(t.start,t.count,t.materialIndex)},$reg:[pr]},set:{groups(e){const{path:t,target:r,config:s}=e;if(t[1]!==void 0){r.groups.splice(Number(e.path[1]),1);const n=s.groups[t[1]];r.addGroup(n.start,n.count,n.materialIndex)}else console.warn("geometry processor can not set group",e)},$reg:[pr]},delete:{groups({target:e,key:t}){e.groups.splice(Number(t),1)},$reg:[pr]}},Nt=function(e,t){e.clearGroups();for(const r of t.groups)e.addGroup(r.start,r.count,r.materialIndex);return ec(e,t)},W=new Map;W.set(l.BOXGEOMETRY,e=>new ot(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments));W.set(l.SPHEREGEOMETRY,e=>new Nr(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength));W.set(l.PLANEGEOMETRY,e=>new Re(e.width,e.height,e.widthSegments,e.heightSegments));W.set(l.CIRCLEGEOMETRY,e=>new Ws(e.radius,e.segments,e.thetaStart,e.thetaLength));W.set(l.CONEGEOMETRY,e=>new Vs(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength));W.set(l.CYLINDERGEOMETRY,e=>new Ys(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength));W.set(l.LINECURVEGEOMETRY,e=>new Xa(e.path.map(t=>new A(t.x,t.y,t.z)),e.divisions,e.space));W.set(l.SPLINECURVEGEOMETRY,e=>new Ka(e.path.map(t=>new A(t.x,t.y,t.z)),e.divisions,e.space));W.set(l.CUBICBEZIERCURVEGEOMETRY,e=>new Qa(e.path.map(t=>new A(t.x,t.y,t.z)),e.divisions,e.space));W.set(l.QUADRATICBEZIERCURVEGEOMETRY,e=>new Ya(e.path.map(t=>new A(t.x,t.y,t.z)),e.divisions,e.space));W.set(l.LINETUBEGEOMETRY,e=>new Za(e.path.map(t=>new A(t.x,t.y,t.z)),e.tubularSegments,e.radius,e.radialSegments,e.closed));W.set(l.SPLINETUBEGEOMETRY,e=>new Ja(e.path.map(t=>new A(t.x,t.y,t.z)),e.tubularSegments,e.radius,e.radialSegments,e.closed));W.set(l.TORUSGEOMETRY,e=>new Qs(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc));W.set(l.RINGGEOMETRY,e=>new Xs(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength));W.set(l.LINESHAPEGEOMETRY,e=>new qa(e.path.map(t=>new H(t.x,t.y)),e.curveSegments));const tc=function(e){return W.has(e.type)?Nt(W.get(e.type)(e),e):(console.error(`parametric geometry can not support this type config: ${e.type}`),new J)},rc=function(e){e.dispose()},sc=function(e){return x({configType:e,commands:Gt,create:tc,dispose:rc})},nc=[l.BOXGEOMETRY,l.SPHEREGEOMETRY,l.PLANEGEOMETRY,l.CIRCLEGEOMETRY,l.CONEGEOMETRY,l.CYLINDERGEOMETRY,l.LINECURVEGEOMETRY,l.SPLINECURVEGEOMETRY,l.CUBICBEZIERCURVEGEOMETRY,l.QUADRATICBEZIERCURVEGEOMETRY,l.LINETUBEGEOMETRY,l.SPLINETUBEGEOMETRY,l.TORUSGEOMETRY,l.RINGGEOMETRY,l.LINESHAPEGEOMETRY],oc=nc.map(e=>sc(e));class ic extends J{constructor(t){super();i(this,"type","LoadBufferGeometry"),t&&this.copy(t)}}var ac=x({configType:l.LOADGEOMETRY,commands:Gt,create(e,t){const r=t.resourceManager.resourceMap.get(e.url);return!r&&!(r instanceof J)?(console.error(`engine rescoure can not found url: ${e.url}`),new ot(5,5,5)):Nt(new ic(r),e)},dispose(e){e.dispose()}});const cc=function(e){const t=new J;return e.position.length&&t.setAttribute("position",new oe(e.position,3)),e.color.length&&t.setAttribute("color",new oe(e.color,3)),e.normal.length&&t.setAttribute("normal",new oe(e.normal,3)),e.uv.length&&t.setAttribute("uv",new oe(e.uv,2)),e.uv2.length&&t.setAttribute("uv2",new oe(e.uv2,2)),e.index.length&&t.setIndex(e.index),t};var lc=x({configType:l.CUSTOMGEOMETRY,commands:Gt,create(e){return Nt(cc(e.attribute),e)},dispose(e){e.dispose()}}),hc=x({configType:l.EDGESGEOMETRY,commands:Gt,create(e,t){const r=t.compilerManager.getObjectBySymbol(e.url);return!r||!(r instanceof J)?(console.error(`engine rescoure can not found url: ${e.url}`),new we(new ot(5,5,5))):Nt(new we(r),e)},dispose(e){e.dispose()}});class dc extends R{constructor(){super();i(this,"MODULE",m.GEOMETRY)}}oc.forEach(e=>{R.processor(e)});R.processor(ac);R.processor(lc);R.processor(hc);var uc=x({configType:l.GROUP,commands:z,create(e,t){return De(new Ks,e,{},t)},dispose:ne});class pc extends Ue{constructor(){super();i(this,"MODULE",m.GROUP)}}R.processor(uc);const mc=function({target:e,value:t}){e.color.copy(new k(t))},Ht=function(e,t,r,s){return e.color.copy(new k(t.color)),De(e,t,F({color:!0,scale:!0,rotation:!0,lookAt:!0},r),s)},Ut=Object.assign({},z,{set:{color:mc,scale:It,rotation:It,lookAt:It}});var fc=x({configType:l.AMBIENTLIGHT,commands:Ut,create(e,t){return Ht(new it,e,{},t)},dispose:ne}),gc=x({configType:l.DIRECTIONALLIGHT,commands:Ut,create(e,t){return Ht(new Hr,e,{},t)},dispose:ne}),Ec=x({configType:l.POINTLIGHT,commands:Ut,create(e,t){return Ht(new Ur,e,{},t)},dispose:ne}),yc=x({configType:l.SPOTLIGHT,commands:Ut,create(e,t){return Ht(new Zs,e,{},t)},dispose:ne});class Sc extends Ue{constructor(){super();i(this,"MODULE",m.LIGHT)}}R.processor(fc);R.processor(gc);R.processor(Ec);R.processor(yc);class Bt extends Ue{constructor(){super()}}const zt=new We({fragmentShader:`
  void main () {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);
  }
  `}),ls=new ot(10,10,10),Mc=function({target:e,value:t,engine:r}){const s=r.compilerManager.getGeometry(t);if(!s){console.warn(`can not found geometry by vid in engine: ${t}`),e.geometry=ls;return}e.geometry=s},mr=function({target:e,config:t,engine:r}){let s;typeof t.material=="string"?s=r.compilerManager.getMaterial(t.material)||zt:s=t.material.map(n=>r.compilerManager.getMaterial(n)||zt),e.material=s},_t=function(e,t,r,s){if(!r.geometry){let n=s.getObjectBySymbol(t.geometry);n instanceof J||(console.warn(`geometry vid in engine is not instance of BufferGeometry: ${t.geometry}`,n),n=ls),e.geometry.dispose(),e.geometry=n}if(!r.material){let n;typeof t.material=="string"?n=s.compilerManager.getMaterial(t.material)||zt:n=t.material.map(o=>s.compilerManager.getMaterial(o)||zt),e.material=n}return De(e,t,F({geometry:!0,material:!0},r),s)},kt=function(e){ne(e)},tt={add:F({material:mr},z.add),set:F({geometry:Mc,material:mr},z.set),delete:F({material:mr},z.delete)};var bc=x({configType:l.LINE,commands:tt,create(e,t){return _t(new at,e,{},t)},dispose:kt});class vc extends Bt{constructor(){super();i(this,"MODULE",m.LINE)}}R.processor(bc);const Be={reg:new RegExp("transparent|sizeAttenuation"),handler({target:e,key:t,value:r,engine:s}){e[t]=r,e.needsUpdate=!0}},rt={reg:new RegExp("map$","i"),handler({target:e,key:t,value:r,engine:s}){const n=s.resourceManager.resourceMap.get(r);n instanceof Ye||console.warn(`this url resource is not instance of Texture: ${t}`,r,n),e[t]=n,e.needsUpdate=!0}},Se=function({target:e,key:t,value:r}){e[t].copy(new k(r))},st=function(e,t,r){const s={};for(const n of Object.keys(t))if(n.toLocaleLowerCase().endsWith("map")&&t[n]){const o=r.compilerManager.getObjectBySymbol(t[n]);if(!(o instanceof Ye)){console.warn(`this url resource is not instance of Texture: ${n}`,t[n],o);continue}e[n]=o,s[n]=!0}else["color","emissive","specular"].includes(n)&&(e[n]=new k(t[n]),s[n]=!0);return se(t,e,s),e.needsUpdate=!0,e},ze=function(e){e.dispose()};var hs=x({configType:l.LINEBASICMATERIAL,commands:{set:{color:Se,$reg:[rt,Be]}},create:function(e,t){return st(new ct,e,t)},dispose:ze}),Rc=x({configType:l.MESHBASICMATERIAL,commands:{set:{color:Se,$reg:[rt,Be]}},create:function(e,t){return st(new vt,e,t)},dispose:ze}),wc=x({configType:l.MESHPHONGMATERIAL,commands:{set:{color:Se,emissive:Se,specular:Se,$reg:[rt,Be]}},create:function(e,t){return st(new Js,e,t)},dispose:ze}),Tc=x({configType:l.MESHSTANDARDMATERIAL,commands:{set:{color:Se,emissive:Se,$reg:[rt,Be]}},create:function(e,t){return st(new Br,e,t)},dispose:ze}),Cc=x({configType:l.POINTSMATERIAL,commands:{set:{color:Se,$reg:[rt,Be]}},create:function(e,t){return st(new Ve,e,t)},dispose:ze}),xc=x({configType:l.SHADERMATERIAL,commands:{set:{shader({target:e,value:t}){const r=ce.getShader(t);(r==null?void 0:r.vertexShader)&&(e.vertexShader=r.vertexShader),(r==null?void 0:r.fragmentShader)&&(e.fragmentShader=r.fragmentShader),(r==null?void 0:r.uniforms)&&(e.uniforms=r.uniforms),(r==null?void 0:r.defines)&&(e.defines=r.defines),e.needsUpdate=!0},$reg:[Be]}},create:function(e,t){const r=new We,s=ce.getShader(e.shader);return(s==null?void 0:s.vertexShader)&&(r.vertexShader=s.vertexShader),(s==null?void 0:s.fragmentShader)&&(r.fragmentShader=s.fragmentShader),(s==null?void 0:s.uniforms)&&(r.uniforms=s.uniforms),(s==null?void 0:s.defines)&&(r.defines=s.defines),se(e,r,{type:!0,shader:!0}),r.needsUpdate=!0,r},dispose:ze}),Oc=x({configType:l.SPRITEMATERIAL,commands:{set:{color:Se,$reg:[rt,Be]}},create:function(e,t){return st(new Te,e,t)},dispose:ze});class Lc extends R{constructor(){super();i(this,"MODULE",m.MATERIAL)}}R.processor(Rc);R.processor(Tc);R.processor(wc);R.processor(hs);R.processor(Cc);R.processor(Oc);R.processor(hs);R.processor(xc);var Ac=x({configType:l.MESH,commands:tt,create(e,t){return _t(new je,e,{},t)},dispose:kt});class Dc extends Bt{constructor(){super();i(this,"MODULE",m.MESH)}}R.processor(Ac);var Pc=x({configType:l.SMAAPASS,create(e,t){const r=window.devicePixelRatio;return new Tn(t.dom?t.dom.offsetWidth*r:window.innerWidth*r,t.dom?t.dom.offsetHeight*r:window.innerWidth*r)},dispose(e){}}),Ic=x({configType:l.UNREALBLOOMPASS,create(e,t){const r=window.devicePixelRatio;return new Cn(new H(t.dom?t.dom.offsetWidth*r:window.innerWidth*r,t.dom?t.dom.offsetHeight*r:window.innerWidth*r),e.strength,e.radius,e.threshold)},dispose(e){e.dispose()}});const fr=class extends xn{constructor(e=new H(256,256),t=1,r=0,s=0,n=new te,o=new ee,a){super();i(this,"resolution"),i(this,"strength"),i(this,"radius"),i(this,"threshold"),i(this,"selectedObjects",[]),i(this,"renderScene"),i(this,"renderCamera"),i(this,"clearColor",new k(0,0,0)),i(this,"renderTargetsHorizontal",[]),i(this,"renderTargetsVertical",[]),i(this,"nMips",5),i(this,"selectRenderTarget"),i(this,"renderTargetBright"),i(this,"highPassUniforms"),i(this,"materialHighPassFilter"),i(this,"separableBlurMaterials",[]),i(this,"compositeMaterial"),i(this,"bloomTintColors"),i(this,"mixMaterial"),i(this,"enabled",!0),i(this,"needsSwap",!1),i(this,"_oldClearColor",new k),i(this,"oldClearAlpha",1),i(this,"basic",new vt),i(this,"fsQuad",new On),i(this,"materialCache",new Map),i(this,"sceneBackgroundCache",null),i(this,"overrideBackground",new k("black")),i(this,"overrideMeshMaterial",new vt({color:"black"})),i(this,"overrideLineMaterial",new ct({color:"black"})),i(this,"overridePointsMaterial",new Ve({color:"black"})),i(this,"overrideSpriteMaterial",new Te({color:"black"})),this.resolution=e,this.strength=t,this.radius=r,this.threshold=s,this.renderScene=n,this.renderCamera=o,this.selectedObjects=a;let c=Math.round(this.resolution.x/2),d=Math.round(this.resolution.y/2);this.selectRenderTarget=new lt(c,d),this.selectRenderTarget.texture.name="UnrealBloomPass.selected",this.selectRenderTarget.texture.generateMipmaps=!1,this.renderTargetBright=new lt(c,d),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let g=0;g<this.nMips;g++){const S=new lt(c,d);S.texture.name="UnrealBloomPass.h"+g,S.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(S);const b=new lt(c,d);b.texture.name="UnrealBloomPass.v"+g,b.texture.generateMipmaps=!1,this.renderTargetsVertical.push(b),c=Math.round(c/2),d=Math.round(d/2)}Zr===void 0&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");const h=Zr;this.highPassUniforms=qs.clone(h.uniforms),this.highPassUniforms.luminosityThreshold.value=s,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new We({uniforms:this.highPassUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,defines:{}});const p=[3,5,7,9,11];c=Math.round(this.resolution.x/2),d=Math.round(this.resolution.y/2);for(let g=0;g<this.nMips;g++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(p[g])),this.separableBlurMaterials[g].uniforms.texSize.value=new H(c,d),c=Math.round(c/2),d=Math.round(d/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;const f=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=f,this.bloomTintColors=[new A(1,1,1),new A(1,1,1),new A(1,1,1),new A(1,1,1),new A(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,this.mixMaterial=this.getMixMaterial()}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()}setSize(e,t){let r=Math.round(e/2),s=Math.round(t/2);this.selectRenderTarget.setSize(r,s),this.renderTargetBright.setSize(r,s);for(let n=0;n<this.nMips;n++)this.renderTargetsHorizontal[n].setSize(r,s),this.renderTargetsVertical[n].setSize(r,s),this.separableBlurMaterials[n].uniforms.texSize.value=new H(r,s),r=Math.round(r/2),s=Math.round(s/2)}render(e,t,r,s,n){if(!this.selectedObjects.length){this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e));return}e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),n&&e.state.buffers.stencil.setTest(!1);const a=new Map;for(const h of this.selectedObjects)a.set(h,!0);const c=this.materialCache;this.renderScene.background&&(this.sceneBackgroundCache=this.renderScene.background,this.renderScene.background=this.overrideBackground),this.renderScene.traverse(h=>{!a.has(h)&&!h.isLight&&h.visible&&(c.set(h,h.material),h instanceof je?h.material=this.overrideMeshMaterial:h instanceof at?h.material=this.overrideLineMaterial:h instanceof Ge?h.material=this.overridePointsMaterial:h instanceof Ne&&(h.material=this.overrideSpriteMaterial))}),e.setRenderTarget(this.selectRenderTarget),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=this.selectRenderTarget.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=this.selectRenderTarget.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let d=this.renderTargetBright;for(let h=0;h<this.nMips;h++)this.fsQuad.material=this.separableBlurMaterials[h],this.separableBlurMaterials[h].uniforms.colorTexture.value=d.texture,this.separableBlurMaterials[h].uniforms.direction.value=fr.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[h]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[h].uniforms.colorTexture.value=this.renderTargetsHorizontal[h].texture,this.separableBlurMaterials[h].uniforms.direction.value=fr.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[h]),e.clear(),this.fsQuad.render(e),d=this.renderTargetsVertical[h];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.mixMaterial,this.mixMaterial.uniforms.bloom.value=this.renderTargetsHorizontal[0].texture,this.mixMaterial.uniforms.origin.value=r.texture,n&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o;for(const h of c.entries())h[0].material=h[1];c.clear(),this.sceneBackgroundCache&&(this.renderScene.background=this.sceneBackgroundCache,this.sceneBackgroundCache=null)}getMixMaterial(){return new We({blending:en,depthTest:!1,depthWrite:!1,transparent:!0,uniforms:{bloom:{value:null},origin:{value:null}},vertexShader:`
    
        varying vec2 vUv;
    
        void main() {
    
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    
        }`,fragmentShader:`
        uniform sampler2D bloom;
        uniform sampler2D origin;
    
        varying vec2 vUv;
    
        void main() {
          vec3 bloomColor = texture2D(bloom, vUv).rgb;
          vec3 originColor = texture2D(origin, vUv).rgb;
          gl_FragColor = vec4(originColor + bloomColor, 1.0);
        }`})}getSeperableBlurMaterial(e){return new We({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new H(.5,.5)},direction:{value:new H(.5,.5)}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}
				void main() {
					vec2 invSize = 1.0 / texSize;
					float fSigma = float(SIGMA);
					float weightSum = gaussianPdf(0.0, fSigma);
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianPdf(x, fSigma);
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(e){return new We({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}};let gr=fr;i(gr,"BlurDirectionX",new H(1,0));i(gr,"BlurDirectionY",new H(0,1));var jc=x({configType:l.SELECTIVEBLOOMPASS,commands:{add:{selectedObjects({target:e,engine:t,value:r}){const s=t.compilerManager.getObject3D(r);s?e.selectedObjects.push(s):console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${r}`)}},set:{renderScene({target:e,engine:t,value:r}){const s=t.compilerManager.getObject3D(r);s instanceof te&&(e.renderScene=s)},renderCamera({target:e,engine:t,value:r}){const s=t.compilerManager.getObject3D(r);s instanceof zr&&(e.renderCamera=s)},selectedObjects({target:e,config:t,engine:r}){const s=t.selectedObjects.map(n=>{const o=r.compilerManager.getObject3D(n);if(o)return o;console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${n}`)}).filter(n=>n);e.selectedObjects=s}},delete:{selectedObjects({target:e,engine:t,value:r}){const s=t.compilerManager.getObject3D(r);s?e.selectedObjects.includes(s)&&e.selectedObjects.splice(e.selectedObjects.indexOf(s),1):console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${r}`)}}},create(e,t){const r=[];for(const o of e.selectedObjects){const a=t.compilerManager.getObject3D(o);a&&r.push(a)}const s=window.devicePixelRatio;return new gr(new H(t.dom?t.dom.offsetWidth*s:window.innerWidth*s,t.dom?t.dom.offsetHeight*s:window.innerWidth*s),e.strength,e.radius,e.threshold,e.renderScene&&t.compilerManager.getObject3D(e.renderScene)||void 0,e.renderCamera&&t.compilerManager.getObject3D(e.renderCamera)||void 0,r)},dispose(e){e.dispose()}});class Gc extends R{constructor(){super();i(this,"MODULE",m.PASS),i(this,"composer")}useEngine(t){return super.useEngine(t),t.effectComposer?(this.composer=t.effectComposer,this):(console.warn("engine need install effectComposer plugin that can use pass compiler."),this)}add(t){const r=super.add(t);return r&&this.composer.addPass(r),r}remove(t){if(!this.map.has(t.vid))return console.warn(`PassCompiler can not found this vid pass: ${t.vid}.`),this;const r=this.map.get(t.vid);return this.composer.removePass(r),super.remove(t),this}}R.processor(Pc);R.processor(Ic);R.processor(jc);var Nc=x({configType:l.POINTS,commands:tt,create(e,t){return _t(new Ge,e,{},t)},dispose:kt});class Hc extends Bt{constructor(){super();i(this,"MODULE",m.POINTS)}}R.processor(Nc);var Uc=x({configType:l.WEBGLRENDERER,commands:{set:{size({target:e,config:t}){t.size?e.setSize(t.size.x,t.size.y):e.setSize(e.domElement.offsetWidth,e.domElement.offsetHeight)},clearColor({target:e,value:t}){const r=Number(t.slice(0,-1).split(",").pop().trim());e.setClearColor(t,r),e.clear()},viewport({target:e,config:t}){const r=t.viewport;if(r)e.setViewport(r.x,r.y,r.width,r.height);else{const s=e.domElement;e.setViewport(0,0,s.offsetWidth,s.offsetHeight)}},scissor({target:e,config:t}){const r=t.scissor;if(r)e.setScissorTest(!0),e.setScissor(r.x,r.y,r.width,r.height);else{e.setScissorTest(!1);const s=e.domElement;e.setScissor(0,0,s.offsetWidth,s.offsetHeight)}},pixelRatio({target:e,value:t}){e.setPixelRatio(t),e.clear()}}},create(e,t){let r;if(t.webGLRenderer?r=t.webGLRenderer:r=new Rt,e.size&&r.setSize(e.size.x,e.size.y),e.clearColor){const s=Number(e.clearColor.slice(0,-1).split(",").pop().trim());r.setClearColor(e.clearColor,s)}if(e.viewport){const s=e.viewport;r.setViewport(s.x,s.y,s.width,s.height)}if(e.scissor){const s=e.scissor;r.setScissorTest(!0),r.setScissor(s.x,s.y,s.width,s.height)}return e.pixelRatio&&r.setPixelRatio(e.pixelRatio),se(e,r,{size:!0,clearColor:!0,viewport:!0,scissor:!0,pixelRatio:!0}),r},dispose(e){e.clear(),e.dispose()}}),Bc=x({configType:l.CSS3DRENDERER,commands:{set:{size({target:e,config:t}){t.size?e.setSize(t.size.x,t.size.y):e.setSize(e.domElement.offsetWidth,e.domElement.offsetHeight)}}},create(e,t){let r;return t.css3DRenderer?r=t.css3DRenderer:r=new Jr,e.size&&r.setSize(e.size.x,e.size.y),se(e,r,{size:!0}),r},dispose(e){}});class zc extends R{constructor(){super();i(this,"MODULE",m.RENDERER)}useEngine(t){return t.webGLRenderer&&this.map.set(l.WEBGLRENDERER,t.webGLRenderer),t.css3DRenderer&&this.map.set(l.CSS3DRENDERER,t.css3DRenderer),super.useEngine(t)}}R.processor(Uc);R.processor(Bc);const ds=function(e,t,r){if(!t){e.background=null;return}if(Xe(t)){const s=r.compilerManager.getTexture(t);s?e.background=s:console.warn(`engine can not found this vid texture : '${t}'`)}else e.background=new k(t)},us=function(e,t,r){if(!t){e.environment=null;return}if(Xe(t)){const s=r.compilerManager.getTexture(t);s?e.environment=s:console.warn(`engine can not found this vid texture : '${t}'`)}else console.warn(`scene environment is illeage: ${t}`)};var _c=x({configType:l.SCENE,commands:{add:z.add,set:Ct(F({},z.set),{lookAt(){},fog({target:e,config:t,key:r,value:s}){const n=t.fog;n.type?n.type==="Fog"?!e.fog||!(e.fog instanceof Xt)?e.fog=new Xt(n.color,n.near,n.far):r==="color"?e.fog.color.copy(new k(n.color)):e.fog[r]&&(e.fog[r]=s):n.type==="FogExp2"&&(!e.fog||!(e.fog instanceof Kt)?e.fog=new Kt(n.color,n.density):r==="color"?e.fog.color.copy(new k(n.color)):e.fog[r]&&(e.fog[r]=s)):e.fog=null},background({target:e,value:t,engine:r}){ds(e,t,r)},environment({target:e,value:t,engine:r}){us(e,t,r)}}),delete:z.delete},create(e,t){const r=new te;if(ds(r,e.background,t),us(r,e.environment,t),e.fog.type){const s=e.fog;s.type==="Fog"?r.fog=new Xt(s.color,s.near,s.far):s.type==="FogExp2"?r.fog=new Kt(s.color,s.density):console.warn(`scene processor can not support this type fog:'${e.type}'`)}return De(r,e,{lookAt:!0,background:!0,environment:!0,fog:!0},t)},dispose:ne});class kc extends Ue{constructor(){super();i(this,"MODULE",m.SCENE)}}R.processor(_c);const ps=new Te({color:"rgb(123, 123, 123)"});var Fc=x({configType:l.SPRITE,commands:{add:tt.add,set:Ct(F({lookAt(){}},tt.set),{material({target:e,engine:t,value:r}){const s=t.compilerManager.getMaterial(r);s&&s instanceof Te?e.material=s:e.material=ps}}),delete:tt.add},create(e,t){const r=new Ne,s=t.compilerManager.getMaterial(e.material);return s&&s instanceof Te?r.material=s:r.material=ps,_t(r,e,{geometry:!0,material:!0,lookAt:!0},t)},dispose:kt});class $c extends Bt{constructor(){super();i(this,"MODULE",m.SPRITE)}}R.processor(Fc);class Wc extends Ye{constructor(t,r,s,n,o,a,c,d,h,p){super(t,r,s,n,o,a,c,d,h,p)}}class yt{constructor(t){i(this,"canvas"),this.canvas=document.createElement("canvas");const r=window.devicePixelRatio;this.canvas.width=((t==null?void 0:t.width)||512)*r,this.canvas.height=((t==null?void 0:t.height)||512)*r,this.canvas.style.backgroundColor=(t==null?void 0:t.bgColor)||"rgb(255, 255, 255)";const s=this.canvas.getContext("2d");s&&s.scale(window.devicePixelRatio,window.devicePixelRatio)}get(){return this.canvas}getDom(){return this.canvas}clear(t=0,r=0,s,n){!s&&(s=this.canvas.width),!n&&(n=this.canvas.height);const o=this.canvas.getContext("2d");return o?(o.clearRect(t,r,s,n),this):(console.warn("you browser can not support canvas 2d"),this)}draw(t){const r=this.canvas.getContext("2d");return r?(t(r),this):(console.warn("you browser can not support canvas 2d"),this)}preview(t){const r=this.canvas;return r.style.position="fixed",r.style.top=(t==null?void 0:t.top)||"5%",r.style.left=(t==null?void 0:t.left)||"5%",r.style.right=(t==null?void 0:t.right)||"unset",r.style.bottom=(t==null?void 0:t.bottom)||"unset",(t==null?void 0:t.scale)&&(r.style.transform=`scale(${t.scale})`),document.body.appendChild(this.canvas),this}}const Ft=new yt({width:512,height:512}).draw(e=>{e.translate(256,256),e.font="72px",e.fillStyle="white",e.fillText("\u6682\u65E0\u56FE\u7247",0,0)}).getDom(),q=function(e,t,r){const s=t.resourceManager.resourceMap;if(!s.has(e))return console.warn(`engine resourceManager can not found this url: ${e}`),Ft;const n=s.get(e);if(Array.isArray(r)){for(const o of r)if(n instanceof o)return n;return console.warn(`this url mapping resource is not a texture image class: ${e}`,n),Ft}else return n instanceof r?n:(console.warn(`this url mapping resource is not a texture image class: ${e}`,n),Ft)},Vc={reg:new RegExp("wrapS|wrapT|format|encoding|anisotropy|magFilter|minFilter|mapping"),handler({target:e,key:t,value:r}){e[t]=r,e.needsUpdate=!0}};var Yc=x({configType:l.IMAGETEXTURE,commands:{set:{url({target:e,value:t,engine:r}){e.image=q(t,r,HTMLImageElement),e.needsUpdate=!0},$reg:[Vc]}},create(e,t){const r=new Wc;return e.url&&(r.image=q(e.url,t,HTMLImageElement)),se(e,r,{type:!0,url:!0}),r.needsUpdate=!0,r},dispose(e){e.dispose()}}),Qc=x({configType:l.CANVASTEXTURE,commands:{set:{url({target:e,value:t,engine:r}){e.image=q(t,r,HTMLCanvasElement),e.needsUpdate=!0}}},create(e,t){const r=new ht(Ft);return e.url&&(r.image=q(e.url,t,HTMLCanvasElement)),se(e,r,{type:!0,url:!0}),r.needsUpdate=!0,r},dispose(e){e.dispose()}});const _e=[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement],nt=function({target:e,index:t,value:r,engine:s}){e.images[t]=q(r,s,_e),e.needsUpdate=!0};var Xc=x({configType:l.CUBETEXTURE,commands:{set:{cube:{px({target:e,value:t,engine:r}){nt({target:e,value:t,engine:r,index:0})},nx({target:e,value:t,engine:r}){nt({target:e,value:t,engine:r,index:1})},py({target:e,value:t,engine:r}){nt({target:e,value:t,engine:r,index:2})},ny({target:e,value:t,engine:r}){nt({target:e,value:t,engine:r,index:3})},pz({target:e,value:t,engine:r}){nt({target:e,value:t,engine:r,index:4})},nz({target:e,value:t,engine:r}){nt({target:e,value:t,engine:r,index:5})}}}},create(e,t){const r=new tn,s=e.cube,n=[q(s.px,t,_e),q(s.nx,t,_e),q(s.py,t,_e),q(s.ny,t,_e),q(s.pz,t,_e),q(s.nz,t,_e)];return r.image=n,se(e,r,{type:!0,cube:!0}),r.needsUpdate=!0,r},dispose(e){e.dispose()}});class Kc extends Ye{constructor(t,r,s,n,o,a,c,d,h){super(t,r,s,n,o,a,c,d,h);i(this,"isVideoTexture",!0),this.format=c!==void 0?c:rn,this.minFilter=a!==void 0?a:wt,this.magFilter=o!==void 0?o:wt,this.generateMipmaps=!1}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image,r="requestVideoFrameCallback"in t;r?this.needsUpdate=!0:r===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}var Zc=x({configType:l.VIDEOTEXTURE,commands:{set:{url({target:e,value:t,engine:r}){e.image=q(t,r,HTMLVideoElement),e.needsUpdate=!0}}},create(e,t){const r=new Kc(document.createElement("video"));return e.url&&(r.image=q(e.url,t,HTMLVideoElement)),se(e,r,{type:!0,url:!0}),r.needsUpdate=!0,r},dispose(e){e.dispose()}});class Jc extends R{constructor(){super();i(this,"MODULE",m.TEXTURE)}}R.processor(Yc);R.processor(Qc);R.processor(Xc);R.processor(Zc);class qc{constructor(t){i(this,"cameraCompiler",new Ua),i(this,"lightCompiler",new Sc),i(this,"geometryCompiler",new dc),i(this,"textureCompiler",new Jc),i(this,"materialCompiler",new Lc),i(this,"rendererCompiler",new zc),i(this,"sceneCompiler",new kc),i(this,"controlsCompiler",new _a),i(this,"spriteCompiler",new $c),i(this,"lineCompiler",new vc),i(this,"meshCompiler",new Dc),i(this,"pointsCompiler",new Hc),i(this,"groupCompiler",new pc),i(this,"css3DCompiler",new Va),i(this,"passCompiler",new Gc),i(this,"animationCompiler",new Ji),i(this,"compilerMap"),t&&Object.keys(t).forEach(s=>{this[s]=t[s]});const r=new Map;Object.keys(this).forEach(s=>{const n=this[s];n instanceof R&&r.set(n.MODULE,n)}),this.compilerMap=r}support(t){this.compilerMap.forEach(s=>{s.useEngine(t)});const r=t.dataSupportManager;return r.textureDataSupport.addCompiler(this.textureCompiler),r.materialDataSupport.addCompiler(this.materialCompiler),r.geometryDataSupport.addCompiler(this.geometryCompiler),r.rendererDataSupport.addCompiler(this.rendererCompiler),r.controlsDataSupport.addCompiler(this.controlsCompiler),r.passDataSupport.addCompiler(this.passCompiler),r.cameraDataSupport.addCompiler(this.cameraCompiler),r.lightDataSupport.addCompiler(this.lightCompiler),r.spriteDataSupport.addCompiler(this.spriteCompiler),r.lineDataSupport.addCompiler(this.lineCompiler),r.meshDataSupport.addCompiler(this.meshCompiler),r.pointsDataSupport.addCompiler(this.pointsCompiler),r.css3DDataSupport.addCompiler(this.css3DCompiler),r.groupDataSupport.addCompiler(this.groupCompiler),r.sceneDataSupport.addCompiler(this.sceneCompiler),r.animationDataSupport.addCompiler(this.animationCompiler),this}getObjectSymbol(t){for(const r of this.compilerMap.values()){const s=r.getObjectSymbol(t);if(s)return s}return null}getObjectBySymbol(t){for(const r of this.compilerMap.values()){const s=r.getObjectBySymbol(t);if(s)return s}return null}getObject3D(t){for(const r of this.compilerMap.values())if(r instanceof Ue&&r.map.has(t))return r.map.get(t);return null}getGeometry(t){return this.geometryCompiler.map.get(t)||null}getMaterial(t){return this.materialCompiler.map.get(t)||null}getTexture(t){return this.textureCompiler.map.get(t)||null}dispose(){for(const t of this.compilerMap.values())t.dispose();return this.compilerMap.clear(),this}}const el=function(e){if(this.compilerManager)return console.warn("engine has installed compilerManager plugin."),!1;if(!this.dataSupportManager)return console.warn("must install dataSupportManager before compilerManager plugin."),!1;if(!this.renderManager)return console.warn("must install renderManager before compilerManager plugin."),!1;const t=new qc;return this.compilerManager=t,this.getObjectSymbol=function(r){return this.compilerManager.getObjectSymbol(r)},this.getObjectBySymbol=function(r){return this.compilerManager.getObjectBySymbol(r)},this.addEventListener("dispose",()=>{this.compilerManager.dispose()}),this.completeSet.add(()=>{this.compilerManager.support(this)}),!0};class tl extends ae{constructor(){super();i(this,"map",new Map)}generateSymbol(t){return Array.isArray(t)?t.join(" + "):t.shortcutKey.join(" + ")}watch(t){return t?Tt.watch(void 0,t):Tt.watch(),this}register(t){const r=this.generateSymbol(t);return this.map.has(r)?(console.warn(`KeyboardManager: shortcutKey already exist: ${r}. desp: ${this.map.get(r).desp}`),this):(Tt.bind(r,t.keydown||null,t.keyup),this.map.set(r,t),this)}update(t){const r=this.generateSymbol(t);return this.map.has(r)?(this.cancel(t.shortcutKey),this.register(t),this):(console.warn("KeyboardManager: shortcutKey unregister then exec register function"),this.register(t),this)}cancel(t){const r=this.generateSymbol(t);if(this.map.has(r)){const s=this.map.get(r);Tt.unbind(r,s.keydown||null,s.keyup),this.map.delete(r)}return this}checkRepeat(t){const r=this.generateSymbol(t);return this.map.has(r)}}const rl=function(e){if(this.keyboardManager)return console.warn("engine has installed keyboardManager plugin."),!1;const t=new tl;return this.keyboardManager=t,this.completeSet.add(()=>{if(this.transformControls)if(this.IS_ENGINESUPPORT){const r=this.dataSupportManager.controlsDataSupport.getData()[l.TRNASFORMCONTROLS];t.register({shortcutKey:["r"],desp:"tranformControls rotate mode",keyup:s=>{s==null||s.preventDefault(),r.mode="rotate"}}).register({shortcutKey:["t"],desp:"tranformControls translate mode",keyup:s=>{s==null||s.preventDefault(),r.mode="translate"}}).register({shortcutKey:["e"],desp:"tranformControls scale mode",keyup:s=>{s==null||s.preventDefault(),r.mode="scale"}}).register({shortcutKey:["x"],desp:"tranformControls switch x axis",keyup:s=>{s==null||s.preventDefault(),r.showX=!r.showX}}).register({shortcutKey:["y"],desp:"tranformControls switch y axis",keyup:s=>{s==null||s.preventDefault(),!(s==null?void 0:s.ctrlKey)&&(r.showY=!r.showY)}}).register({shortcutKey:["z"],desp:"tranformControls switch z axis",keyup:s=>{s==null||s.preventDefault(),!(s==null?void 0:s.ctrlKey)&&(r.showZ=!r.showZ)}}).register({shortcutKey:["space"],desp:"tranformControls switch coordinate space",keyup:s=>{s==null||s.preventDefault(),r.space=r.space==="local"?"world":"local"}}).register({shortcutKey:["shift"],desp:"tranformControls switch tranform numeric value",keyup:s=>{s==null||s.preventDefault(),r.snapAllow=!1},keydown:s=>{s==null||s.preventDefault(),s==null||s.preventRepeat(),r.snapAllow=!0}})}else{const r=this.transformControls;t.register({shortcutKey:["r"],desp:"tranformControls rotate mode",keyup:s=>{s==null||s.preventDefault(),r.mode="rotate"}}).register({shortcutKey:["t"],desp:"tranformControls translate mode",keyup:s=>{s==null||s.preventDefault(),r.mode="translate"}}).register({shortcutKey:["e"],desp:"tranformControls scale mode",keyup:s=>{s==null||s.preventDefault(),r.mode="scale"}}).register({shortcutKey:["x"],desp:"tranformControls switch x axis",keyup:s=>{s==null||s.preventDefault(),r.showX=!r.showX}}).register({shortcutKey:["y"],desp:"tranformControls switch y axis",keyup:s=>{s==null||s.preventDefault(),!(s==null?void 0:s.ctrlKey)&&(r.showY=!r.showY)}}).register({shortcutKey:["z"],desp:"tranformControls switch z axis",keyup:s=>{s==null||s.preventDefault(),!(s==null?void 0:s.ctrlKey)&&(r.showZ=!r.showZ)}}).register({shortcutKey:["space"],desp:"tranformControls switch coordinate space",keyup:s=>{s==null||s.preventDefault(),r.space=r.space==="local"?"world":"local"}}).register({shortcutKey:["shift"],desp:"tranformControls switch tranform numeric value",keyup:s=>{s==null||s.preventDefault(),r.translationSnap=null,r.rotationSnap=null,r.scaleSnap=null},keydown:s=>{s==null||s.preventDefault(),s==null||s.preventRepeat(),r.translationSnap=5,r.rotationSnap=Math.PI/180*10,r.scaleSnap=.1}})}}),!0},sl=function(e={}){if(!this.scene)return console.error("must install some scene plugin before BasicViewpoint plugin."),!1;const t=new Sn(e.length||500);return t.matrixAutoUpdate=!1,t.raycast=()=>{},this.scene.add(t),this.setAxesHelper=function(r){return r.show?this.scene.add(t):this.scene.remove(t),this},this.addEventListener("setScene",r=>{r.scene.add(t)}),!0},nl=function(e={}){if(!this.scene)return console.error("must install some scene before BasicViewpoint plugin."),!1;const t=new Mn(e.range||500,e.spacing||50,e.axesColor||"rgb(130, 130, 130)",e.cellColor||"rgb(70, 70, 70)");if(e.opacity!==1){const r=t.material;r.transparent=!0,r.opacity=e.opacity||.5,r.needsUpdate=!0}return t.matrixAutoUpdate=!1,t.raycast=()=>{},this.scene.add(t),this.setGridHelper=function(r){return r.show?this.scene.add(t):this.scene.remove(t),this},this.addEventListener("setScene",r=>{r.scene.add(t)}),this.completeSet.add(()=>{this.setViewpoint&&this.addEventListener("setViewpoint",r=>{const s=r.viewpoint;s===j.DEFAULT||s===j.TOP||s===j.BOTTOM?t.rotation.set(0,0,0):s===j.RIGHT||s===j.LEFT?t.rotation.set(0,0,Math.PI/2):(s===j.FRONT||s===j.BACK)&&t.rotation.set(Math.PI/2,0,0),t.updateMatrix(),t.updateMatrixWorld()})}),!0};var Z;(function(e){e.GEOMETRY="geometry",e.MATERIAL="material",e.LIGHT="light",e.ENV="env"})(Z||(Z={}));const ol=function(e={}){if(!this.webGLRenderer)return console.error("must install some renderer before DisplayModel plugin."),!1;if(!this.scene)return console.error("must install some scene before DisplayModel plugin."),!1;!e.overrideColor&&(e.overrideColor="rgb(250, 250, 250)"),!e.defaultAmbientLightSetting&&(e.defaultAmbientLightSetting={}),!e.defaultAmbientLightSetting.color&&(e.defaultAmbientLightSetting.color="rgb(255, 255, 255)"),!e.defaultAmbientLightSetting.intensity&&(e.defaultAmbientLightSetting.intensity=.5);const t=new it(e.defaultAmbientLightSetting.color,e.defaultAmbientLightSetting.intensity);t.matrixAutoUpdate=!1,!e.defaultDirectionalLightSetting&&(e.defaultDirectionalLightSetting={}),!e.defaultDirectionalLightSetting.color&&(e.defaultDirectionalLightSetting.color="rgb(255, 255, 255)"),!e.defaultDirectionalLightSetting.intensity&&(e.defaultDirectionalLightSetting.intensity=.5),!e.defaultDirectionalLightSetting.position&&(e.defaultDirectionalLightSetting.position={x:-100,y:100,z:100});const r=new Hr(e.defaultDirectionalLightSetting.color,e.defaultDirectionalLightSetting.intensity);r.castShadow=!1,r.position.set(e.defaultDirectionalLightSetting.position.x,e.defaultDirectionalLightSetting.position.y,e.defaultDirectionalLightSetting.position.z),r.updateMatrix(),r.updateMatrixWorld(),r.matrixAutoUpdate=!1,!e.mode&&(e.mode=Z.ENV),this.displayMode=e.mode;const s=new bn({color:e.overrideColor}),n=new ct({color:e.overrideColor}),o=new Ve({color:e.overrideColor,size:5,sizeAttenuation:!1}),a=new Te({color:e.overrideColor}),c=new WeakMap,d=new Set,h=new Set,p=new Set,f=new Set,g=new Set;let S,b;const T={Object3D:!0,Group:!0};this.scene.addEventListener("afterAdd",E=>{const V=this.displayMode,D=E.objects;for(const O of D)if(!T[O.type])if(O instanceof je&&O.type==="Mesh")h.add(O),V===Z.GEOMETRY&&(c.set(O,O.material),O.material=s);else if(O instanceof at&&O.type.includes("Line"))p.add(O),V===Z.GEOMETRY&&(c.set(O,O.material),O.material=n);else if(O instanceof Xr&&O.type.includes("Light")){if(O===t||O===r)continue;d.has(O)||d.add(O),V!==Z.ENV&&V!==Z.LIGHT&&this.scene.remove(O)}else O instanceof Ge&&O.type==="Points"?(f.add(O),V===Z.GEOMETRY&&(c.set(O,O.material),O.material=o)):O instanceof Ne&&O.type==="Sprite"&&(g.add(O),V===Z.GEOMETRY&&(c.set(O,O.material),O.material=a))}),this.scene.addEventListener("afterRemove",E=>{const V=E.objects;for(const D of V)if(!T[D.type])if(D instanceof je&&D.type==="Mesh")h.delete(D),c.has(D)&&c.delete(D);else if(D instanceof at&&D.type.includes("Line"))p.delete(D),c.has(D)&&c.delete(D);else if(D instanceof Xr&&D.type.includes("Light")){if(D===t||D===r)continue;d.delete(D)}else D instanceof Ge&&D.type==="Points"?(f.delete(D),c.has(D)&&c.delete(D)):D instanceof Ne&&D.type==="Sprite"&&(g.delete(D),c.has(D)&&c.delete(D))});const w=()=>{for(const E of h)E.material!==s&&(c.set(E,E.material),E.material=s);for(const E of p)E.material!==n&&(c.set(E,E.material),E.material=n);for(const E of f)E.material!==o&&(c.set(E,E.material),E.material=o);for(const E of g)E.material!==a&&(c.set(E,E.material),E.material=a)},M=()=>{h.forEach(E=>{c.has(E)&&(E.material=c.get(E),c.delete(E))}),p.forEach(E=>{c.has(E)&&(E.material=c.get(E),c.delete(E))}),f.forEach(E=>{c.has(E)&&(E.material=c.get(E),c.delete(E))}),g.forEach(E=>{c.has(E)&&(E.material=c.get(E),c.delete(E))})},L=()=>{d.forEach(E=>{E.visible=!1}),this.scene.add(t),this.scene.add(r)},P=()=>{d.forEach(E=>{E.visible=!0}),this.scene.remove(t),this.scene.remove(r)},C=()=>{this.scene.background instanceof Ye&&(S=this.scene.background,this.scene.background=null),this.scene.environment instanceof Ye&&(b=this.scene.environment,this.scene.environment=null)},$=()=>{S&&(this.scene.background=S,S=void 0),b&&(this.scene.environment=b,b=void 0)};return this.setDisplayMode=function(E){return this.displayMode=E||Z.ENV,E===Z.GEOMETRY?(w(),C(),L()):E===Z.MATERIAL?(M(),C(),L()):E===Z.LIGHT?(M(),C(),P()):E===Z.ENV?(M(),$(),P()):console.warn(`displayMode plugin can not set this mode: ${E}`),this},this.completeSet.add(()=>{this.objectHelperManager&&this.objectHelperManager.addFilteredObject(r)}),!0},Pe=()=>new ct({color:"rgb(255, 255, 255)"});class ms extends me{constructor(t){super();i(this,"shape"),i(this,"target"),i(this,"type","CameraHelper"),i(this,"cachaData");const r=new J,s=[0,0,0,-1,1,-1,0,0,0,-1,1,1,0,0,0,-1,-1,-1,0,0,0,-1,-1,1,-1,-1,1,-1,-1,-1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,-1,1,0,0,0,0,1,1,0,0,0,0,1,-1,0,0,0,0,-1,-1,0,0,0,0,-1,1,0,1,1,0,1,-1,0,1,-1,0,-1,-1,0,-1,-1,0,-1,1,0,-1,1,0,1,1,0,-1,1,2,-1,1,0,1,-1,2,1,-1,0,-1,-1,2,-1,-1,0,1,1,2,1,1,2,1,1,2,-1,1,2,-1,1,2,-1,-1,2,-1,-1,2,1,-1,2,1,-1,2,1,1];r.setAttribute("position",new oe(s,3)),r.rotateY(-90*Math.PI/180),r.computeBoundingBox();const n=new sn(t);n.matrix=new _r,n.matrixAutoUpdate=!0,n.raycast=()=>{},this.add(n),this.shape=n,this.geometry=r,this.material=Pe(),this.target=t,this.matrixAutoUpdate=!1,this.matrix=t.matrix,t instanceof ee?this.cachaData={fov:t.fov,aspect:t.aspect,near:t.near,far:t.far}:t instanceof Ie?this.cachaData={left:t.left,right:t.right,top:t.top,bottom:t.bottom,near:t.near,far:t.far}:this.cachaData={},this.onBeforeRender=()=>{let o=!1;const a=this.cachaData;Object.keys(a).forEach(c=>{a[c]!==t[c]&&(a[c]=t[c],o=!0)}),o&&this.shape.update()}}raycast(t,r){const s=this.matrixWorld,n=this.geometry.boundingBox.clone();if(n.applyMatrix4(s),t.ray.intersectsBox(n)){const o=this.target;r.push({distance:t.ray.origin.distanceTo(o.position),object:o,point:o.position})}}}class il extends me{constructor(t){super();i(this,"sphere"),i(this,"target"),i(this,"shape"),i(this,"type","VisDirectionalLightHelper"),i(this,"cacheColor"),i(this,"cacheVector3"),this.geometry=new J;const r=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new oe(r,3)),this.material=Pe(),this.geometry.boundingSphere;const s=new k().copy(t.color).multiplyScalar(t.intensity),n=new Re(20,20);n.dispose();const o=new me(new we(n),new ct({color:s}));o.raycast=()=>{},this.shape=o,this.target=t,this.sphere=new Zt(new A(0,0,0),1),this.cacheColor=t.color.getHex(),this.cacheVector3=new A,this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=t.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=t.matrixWorld,this.onBeforeRender=()=>{const a=this.target,c=this.shape;a.color.getHex()!==this.cacheColor&&(c.material.color.copy(a.color).multiplyScalar(a.intensity),this.cacheColor=a.color.getHex()),c.lookAt(a.target.position)}}raycast(t,r){const s=this.target,n=s.matrixWorld,o=this.sphere;o.set(this.cacheVector3.set(0,0,0),1),o.applyMatrix4(n),t.ray.intersectsSphere(o)&&r.push({distance:t.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class al extends me{constructor(t){super();i(this,"sphere"),i(this,"target"),i(this,"shape"),i(this,"type","VisPointLightHelper"),i(this,"cacheColor"),i(this,"cacheDistance"),i(this,"cacheVector3"),this.geometry=new J;const r=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new oe(r,3)),this.material=Pe(),this.geometry.boundingSphere;const s=new k().copy(t.color).multiplyScalar(t.intensity),n=new je(new kr(t.distance,0),new vt({color:s,wireframe:!0}));n.raycast=()=>{},n.matrixAutoUpdate=!1,this.shape=n,this.target=t,this.sphere=new Zt(new A(0,0,0),1),this.cacheColor=t.color.getHex(),this.cacheDistance=t.distance,this.cacheVector3=new A,this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=t.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=t.matrixWorld,this.onBeforeRender=()=>{const o=this.target,a=this.shape;o.distance!==this.cacheDistance&&(a.geometry.dispose(),a.geometry=new kr(o.distance,0),this.cacheDistance=o.distance),o.color.getHex()!==this.cacheColor&&(a.material.color.copy(o.color).multiplyScalar(o.intensity),this.cacheColor=o.color.getHex())}}raycast(t,r){const s=this.target,n=s.matrixWorld,o=this.sphere;o.set(this.cacheVector3.set(0,0,0),1),o.applyMatrix4(n),t.ray.intersectsSphere(o)&&r.push({distance:t.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class cl extends me{constructor(t){super();i(this,"sphere"),i(this,"target"),i(this,"shape"),i(this,"type","VisSpotLightHelper"),i(this,"cacheVector3"),i(this,"cacheColor"),i(this,"cacheAngle"),i(this,"cacheDistance"),this.geometry=new J;const r=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new oe(r,3)),this.material=Pe(),this.geometry.boundingSphere;const s=new J,n=[0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let h=0,p=1,f=32;h<f;h++,p++){const g=h/f*Math.PI*2,S=p/f*Math.PI*2;n.push(Math.cos(g),Math.sin(g),1,Math.cos(S),Math.sin(S),1)}s.setAttribute("position",new oe(n,3));const o=Pe(),a=new me(s,o);a.material.color.copy(t.color).multiplyScalar(t.intensity);const c=t.distance?t.distance:1e3,d=c*Math.tan(t.angle);a.scale.set(d,d,c),a.raycast=()=>{},this.add(a),this.matrixAutoUpdate=!1,this.matrix=t.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=t.matrixWorld,this.target=t,this.shape=a,this.sphere=new Zt(new A(0,0,0),1),this.cacheColor=t.color.getHex(),this.cacheDistance=t.distance,this.cacheAngle=t.angle,this.cacheVector3=new A,this.onBeforeRender=()=>{const h=this.target,p=this.shape;let f=!1;if(h.distance!==this.cacheDistance&&(this.cacheDistance=h.distance,p.scale.z=h.distance,f=!0),h.angle!==this.cacheAngle&&(this.cacheAngle=h.angle,f=!0),f){const g=h.distance*Math.tan(h.angle);p.scale.set(g,g,h.distance)}h.color.getHex()!==this.cacheColor&&(p.material.color.copy(h.color).multiplyScalar(h.intensity),this.cacheColor=h.color.getHex()),p.lookAt(h.target.position)}}raycast(t,r){const s=this.target,n=s.matrixWorld,o=this.sphere;o.set(this.cacheVector3.set(0,0,0),1),o.applyMatrix4(n),t.ray.intersectsSphere(o)&&r.push({distance:t.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class ll extends me{constructor(t){super();i(this,"target"),i(this,"type","VisCSS3DHelper");const s=t.element.getBoundingClientRect(),n=s.width,o=s.height;this.geometry=new we(new Re(n,o)),this.geometry.computeBoundingBox(),this.material=Pe(),this.matrixAutoUpdate=!1,this.matrix=t.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=t.matrixWorld,this.target=t}raycast(t,r){const s=this.target,n=s.matrixWorld,o=this.geometry.boundingBox.clone();o.applyMatrix4(n),t.ray.intersectsBox(o)&&r.push({distance:t.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class hl extends me{constructor(t){super();i(this,"target"),i(this,"type","VisCSS3DPlaneHelper"),i(this,"observer"),this.geometry=new we(new Re(t.width,t.height)),this.geometry.computeBoundingBox(),this.material=Pe(),this.matrixAutoUpdate=!1,this.matrix=t.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=t.matrixWorld,this.target=t;const r=new MutationObserver(()=>{this.geometry.dispose(),this.geometry=new we(new Re(t.width,t.height)),this.geometry.computeBoundingBox()});r.observe(t.element,{attributeFilter:["style"]}),this.observer=r}dispose(){this.observer.disconnect()}}const fs=class extends Ne{constructor(e){super();i(this,"target"),i(this,"type","VisGroupHelper"),this.target=e,this.geometry.computeBoundingBox(),this.material=new Te({map:fs.colorTexture}),this.material.depthTest=!1,this.material.depthWrite=!1,this.scale.set(5,5,5);const t=this.updateMatrixWorld.bind(this);this.updateMatrixWorld=r=>{const s=this.position,n=this.target.position;s.x=n.x,s.y=n.y,s.z=n.z,t(r)}}raycast(e,t){const r=this.matrixWorld,s=this.geometry.boundingBox.clone();if(s.applyMatrix4(r),e.ray.intersectsBox(s)){const n=this.target;t.push({distance:e.ray.origin.distanceTo(n.position),object:n,point:n.position})}}};let gs=fs;i(gs,"colorTexture",new ht(new yt({width:512,height:512}).draw(e=>{e.beginPath(),e.fillStyle="rgba(0, 0, 0, 0)",e.fillRect(0,0,512,512),e.closePath(),e.translate(256,200),e.beginPath(),e.fillStyle="yellow",e.fillRect(-200,0,400,200),e.closePath(),e.beginPath(),e.fillStyle="yellow",e.fillRect(-200,-70,200,70),e.closePath()}).get()));const Es=class extends Ge{constructor(e){super();i(this,"target"),i(this,"cachaGeometryUUid"),i(this,"type","VisLineHelper"),this.target=e,this.geometry.dispose(),this.geometry.copy(e.geometry),this.cachaGeometryUUid=e.geometry.uuid,this.material=new Ve({color:"rgb(255, 255, 255)",alphaMap:Es.alphaTexture,transparent:!0,size:5,sizeAttenuation:!1}),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.renderOrder=-1,this.raycast=()=>{},this.onBeforeRender=()=>{const t=this.target;t.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=t.geometry.clone(),this.cachaGeometryUUid=t.geometry.uuid)}}};let ys=Es;i(ys,"alphaTexture",new ht(new yt({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.fillStyle="rgb(255, 255, 255)",e.arc(256,256,200,0,Math.PI*2),e.fill(),e.closePath()}).getDom()));class dl extends me{constructor(t){super();i(this,"target"),i(this,"type","VisMeshHelper"),i(this,"cachaGeometryUUid");const r=1;this.target=t,this.geometry=new we(t.geometry,r),this.cachaGeometryUUid=t.geometry.uuid,this.material=Pe(),this.raycast=()=>{},this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=t.matrix,this.matrixWorld=t.matrixWorld,this.onBeforeRender=()=>{const s=this.target;s.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=new we(s.geometry,r),this.cachaGeometryUUid=s.geometry.uuid)}}}const Ss=class extends Ge{constructor(e){super();i(this,"target"),i(this,"type","VisPointsHelper"),this.target=e,this.geometry.dispose(),this.geometry.copy(e.geometry),this.material.dispose(),this.material=new Ve({color:"rgb(255, 255, 255)",alphaMap:Ss.alphaTexture,transparent:!0});const t=Array.isArray(e.material)?e.material[0]:e.material;t instanceof Ve&&(this.material.size=t.size,this.material.sizeAttenuation=t.sizeAttenuation),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.raycast=()=>{}}};let Ms=Ss;i(Ms,"alphaTexture",new ht(new yt({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.strokeStyle="rgb(255, 255, 255)",e.lineWidth=4,e.strokeRect(0,0,512,512),e.closePath()}).get()));const bs=class extends Ne{constructor(e){super();i(this,"target"),i(this,"type","VisSpriteHelper"),this.target=e,this.material.dispose(),this.material=new Te({color:"rgb(255, 255, 255)",alphaMap:bs.alphaTexture,transparent:!0,depthWrite:!1}),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.raycast=()=>{}}};let vs=bs;i(vs,"alphaTexture",new ht(new yt({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.strokeStyle="rgb(255, 255, 255)",e.lineWidth=4,e.strokeRect(0,0,512,512),e.closePath()}).get()));class ul extends ae{constructor(t={}){super();i(this,"helperGenerator",{[l.POINTLIGHT]:al,[l.SPOTLIGHT]:cl,[l.DIRECTIONALLIGHT]:il,[l.PERSPECTIVECAMERA]:ms,[l.ORTHOGRAPHICCAMERA]:ms,[l.MESH]:dl,[l.GROUP]:gs,[l.SPRITE]:vs,[l.POINTS]:Ms,[l.LINE]:ys,[l.CSS3DOBJECT]:ll,[l.CSS3DPLANE]:hl}),i(this,"helperFilter",{AmbientLight:!0,Object3D:!0,TransformControls:!0,Scene:!0}),i(this,"objectFilter",new Set),i(this,"objectHelperMap",new Map),t.helperGenerator&&(this.helperGenerator=Object.assign(this.helperGenerator,t.helperGenerator)),t.helperFilter&&(this.helperFilter=Object.assign(this.helperFilter,t.helperFilter)),t.objectFilter&&(this.objectFilter=new Set(t.objectFilter.concat(Array.from(this.objectFilter))))}addFilteredObject(...t){for(const r of t)this.objectFilter.add(r);return this}addObjectHelper(t){if(this.objectFilter.has(t)||this.objectHelperMap.has(t)||this.helperFilter[t.type]||t.type.toLocaleLowerCase().includes("helper"))return null;if(!this.helperGenerator[t.type])return console.warn(`object helper can not support this type object: '${t.type}'`),null;const r=new this.helperGenerator[t.type](t);return this.objectHelperMap.set(t,r),r}disposeObjectHelper(t){if(this.objectFilter.has(t)||this.helperFilter[t.type]||t.type.toLocaleLowerCase().includes("helper"))return null;if(!this.objectHelperMap.has(t))return console.warn("object helper manager can not found this object`s helper: ",t),null;const r=this.objectHelperMap.get(t);return r.geometry&&r.geometry.dispose(),r.material&&(r.material instanceof Qr?r.material.dispose():r.material.forEach(s=>{s.dispose()})),this.objectHelperMap.delete(t),r}}const pl=function(e={}){if(!this.scene)return console.error("must install some scene plugin before ObjectHelper plugin."),!1;e.interact===void 0&&(e.interact=!0),e.interact&&(this.eventManager||(console.warn("must install eventManager plugin that can use interact function."),e.interact=!1));const t=new ul,r=new Map,s=new Map,n=new Map,o=t.objectHelperMap;this.objectHelperManager=t,!e.activeColor&&(e.activeColor="rgb(230, 20, 240)"),!e.hoverColor&&(e.hoverColor="rgb(255, 158, 240)"),!e.defaultColor&&(e.defaultColor="rgb(255, 255, 255)"),!e.selectedColor&&(e.selectedColor=e.activeColor);const a=new k(e.defaultColor).getHex(),c=new k(e.activeColor).getHex(),d=new k(e.hoverColor).getHex(),h=new k(e.selectedColor).getHex(),p=new WeakSet,f=T=>{const w=T.objects;for(const M of w){const L=t.addObjectHelper(M);if(!!L&&(L.material.color.setHex(a),this.scene.add(L),e.interact)){const P=()=>{var E;((E=this.transformControls)==null?void 0:E.dragging)||this.selectionBox&&this.selectionBox.has(M)||L.material.color.setHex(d)},C=()=>{var E;((E=this.transformControls)==null?void 0:E.dragging)||this.selectionBox&&this.selectionBox.has(M)||L.material.color.setHex(a)},$=()=>{var E;((E=this.transformControls)==null?void 0:E.dragging)||this.selectionBox&&this.selectionBox.has(M)||L.material.color.setHex(c)};M.addEventListener("pointerenter",P),M.addEventListener("pointerleave",C),M.addEventListener("click",$),r.set(M,P),s.set(M,C),n.set(M,$)}}},g=T=>{const w=T.objects;for(const M of w){const L=t.disposeObjectHelper(M);!L||(this.scene.remove(L),e.interact&&(M.removeEventListener("pointerenter",r.get(M)),M.removeEventListener("pointerleave",s.get(M)),M.removeEventListener("click",n.get(M)),r.delete(M),s.delete(M),n.delete(M)))}},S=T=>{p.has(T)||(T.traverse(w=>{const M=t.addObjectHelper(w);M&&T.add(M)}),p.add(T))};this.scene.addEventListener("afterAdd",f),this.scene.addEventListener("afterRemove",g),this.setObjectHelper=function(T){return T.show?this.scene.traverse(w=>{o.has(w)&&this.scene.add(o.get(w))}):this.scene.traverse(w=>{o.has(w)&&this.scene.remove(o.get(w))}),this},this.addEventListener("setScene",T=>{const w=T.scene;!p.has(w)&&S(w),w.hasEventListener("afterAdd",f)||w.addEventListener("afterAdd",f),w.hasEventListener("afterRemove",g)||w.addEventListener("afterRemove",g)});const b=new Set;return this.completeSet.add(()=>{this.selectionBox&&this.addEventListener("selected",T=>{b.forEach(w=>{w.material.color.setHex(a)}),b.clear();for(const w of T.objects)if(o.has(w)){const M=o.get(w);M.material.color.setHex(h),b.add(M)}})}),!0},ml=function(e={}){if(this.selectionBox)return console.warn("engine has installed selection plugin."),!1;if(!this.eventManager)return console.warn("must install eventManager plugin before Selection plugin."),!1;this.selectionBox=new Set;const t=()=>{const r=[];this.IS_ENGINESUPPORT&&this.selectionBox.forEach(s=>{const n=this.compilerManager.getObjectSymbol(s);n?r.push(n):console.warn("selection plugin can not font vid in compilerManager.",s)}),this.dispatchEvent({type:"selected",objects:[...this.selectionBox],objectSymbols:r})};return this.setSelectionBox=function(r){this.selectionBox.clear();for(const s of r.objects)this.selectionBox.add(s);return t(),this},this.eventManager.addEventListener("click",r=>{var s,n,o;if(this.transing){this.transing=!1;return}const a=r.intersections;if(r.ctrlKey||this.selectionBox.clear(),this.eventManager.penetrate)for(const c of a){if(r.ctrlKey&&((s=this.selectionBox)==null?void 0:s.has(c.object))){this.selectionBox.delete(c.object);continue}this.selectionBox.add(c.object)}else if(a.length){const c=a[0].object;if(r.ctrlKey&&((n=this.selectionBox)==null?void 0:n.has(c))){this.selectionBox.delete(c);return}(o=this.selectionBox)==null||o.add(c)}t()}),!0},fl=function(e={}){if(this.css3DRenderer)return console.warn("this has installed css3DRenderer plugin."),!1;this.css3DRenderer=new Jr;const t=this.css3DRenderer.domElement;if(t.classList.add("vis-css3D"),t.style.position="absolute",t.style.top="0",t.style.left="0",this.addEventListener("setDom",r=>{r.dom.appendChild(this.css3DRenderer.domElement)}),this.addEventListener("setSize",r=>{this.css3DRenderer.setSize(r.width,r.height)}),this.addEventListener("setScene",r=>{r.oldScene.traverse(n=>{n instanceof ut&&(n.element.style.display="none")})}),this.renderManager)this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",r=>{this.css3DRenderer.render(this.scene,this.camera)});else if(this.webGLRenderer){const r=this.render.bind(this);this.render=function(){return r(),this.webGLRenderer.render(this.scene,this.camera),this}}else this.render=function(){return this.webGLRenderer.render(this.scene,this.camera),this};return!0};var y;(function(e){e.WEBGLRENDERER="WebGLRenderer",e.CSS3DRENDERER="CSS3DRenderer",e.SCENE="Scene",e.MODELINGSCENE="ModelingScene",e.RENDERMANAGER="RenderManager",e.ORBITCONTROLS="OrbitControls",e.STATS="Stats",e.EFFECTCOMPOSER="EffectComposer",e.POINTERMANAGER="PointerManager",e.EVENTMANAGER="EventManager",e.TRANSFORMCONTROLS="TransformControls",e.LOADERMANAGER="LoaderManager",e.RESOURCEMANAGER="ResourceManager",e.DATASUPPORTMANAGER="DataSupportManager",e.COMPILERMANAGER="CompilerManager",e.KEYBOARDMANAGER="KeyboardManager",e.AXESHELPER="AxesHelper",e.GRIDHELPER="GridHelper",e.VIEWPOINT="Viewpoint",e.DISPLAYMODE="DisplayMode",e.OBJECTHELPER="ObjectHelper",e.SELECTION="Selection"})(y||(y={}));const ke=class extends ae{constructor(){super();i(this,"completeSet"),i(this,"camera",new ee),i(this,"scene",new te),i(this,"IS_ENGINESUPPORT",!1),i(this,"dom"),i(this,"webGLRenderer"),i(this,"css3DRenderer"),i(this,"orbitControls"),i(this,"transformControls"),i(this,"effectComposer"),i(this,"renderManager"),i(this,"pointerManager"),i(this,"eventManager"),i(this,"loaderManager"),i(this,"resourceManager"),i(this,"dataSupportManager"),i(this,"compilerManager"),i(this,"keyboardManager"),i(this,"objectHelperManager"),i(this,"transing"),i(this,"stats"),i(this,"displayMode"),i(this,"selectionBox"),i(this,"getScreenshot"),i(this,"setStats"),i(this,"setTransformControls"),i(this,"setViewpoint"),i(this,"setDisplayMode"),i(this,"setAxesHelper"),i(this,"setGridHelper"),i(this,"setObjectHelper"),i(this,"setSelectionBox"),i(this,"loadResources"),i(this,"loadResourcesAsync"),i(this,"registerResources"),i(this,"toJSON"),i(this,"exportConfig"),i(this,"applyConfig"),i(this,"reactiveConfig"),i(this,"getConfigBySymbol"),i(this,"removeConfigBySymbol"),i(this,"getObjectSymbol"),i(this,"getObjectBySymbol"),i(this,"play"),i(this,"stop"),i(this,"render"),this.completeSet=new Set,this.render=function(){return console.warn("can not install some plugin"),this},this.camera.position.set(50,50,50),this.addEventListener("setSize",e=>{this.camera.aspect=e.width/e.height,this.camera.updateProjectionMatrix()})}optimizeMemory(){Object.keys(this).forEach(e=>{this[e]===void 0&&delete this[e]})}install(e,t){return ke.pluginHandler.has(e)?ke.pluginHandler.get(e).call(this,t):console.error(`engine can not support ${e} plugin.`),this}complete(){return this.completeSet.forEach(e=>{e(this)}),this.completeSet.clear(),this}dispose(){return this.dispatchEvent({type:"dispose"}),this}setDom(e){return this.dom=e,this.dispatchEvent({type:"setDom",dom:e}),this}setSize(e,t){var r,s;return e&&e<=0||t&&t<=0?(console.warn(`you must be input width and height bigger then zero, width: ${e}, height: ${t}`),this):(!e&&(e=((r=this.dom)==null?void 0:r.offsetWidth)||window.innerWidth),!t&&(t=((s=this.dom)==null?void 0:s.offsetHeight)||window.innerHeight),this.dispatchEvent({type:"setSize",width:e,height:t}),this)}setCamera(e,t){if(typeof e=="object"&&e instanceof zr)this.camera=e,this.dispatchEvent({type:"setCamera",camera:e,options:Object.assign({orbitControls:!0,transformControls:!0},t||{})});else if(this.IS_ENGINESUPPORT){const r=this.compilerManager.getObjectBySymbol(e);r?(this.camera=r,this.dispatchEvent({type:"setCamera",camera:r,options:Object.assign({orbitControls:!0,transformControls:!0},t||{})})):console.warn(`can not found camera in compilerManager: ${e}`)}else console.warn("engine is not a Engine support but use symbol to found camera.");return this}setScene(e){if(typeof e=="object"&&e instanceof te)this.dispatchEvent({type:"setScene",scene:e,oldScene:this.scene}),this.scene=e;else if(this.IS_ENGINESUPPORT){const t=this.compilerManager.getObjectBySymbol(e);t?(this.dispatchEvent({type:"setScene",scene:t,oldScene:this.scene}),this.scene=t):console.warn(`can not found scene in compilerManager: ${e}`)}else console.warn("engine is not a Engine support but use symbol to found scene.");return this}};let I=ke;i(I,"pluginHandler",new Map);i(I,"register",function(e,t){return ke.pluginHandler&&ke.pluginHandler.set(e,t),ke});i(I,"dispose",function(){ke.pluginHandler=void 0});I.register(y.WEBGLRENDERER,Zn);I.register(y.CSS3DRENDERER,fl);I.register(y.EFFECTCOMPOSER,Wn);I.register(y.RENDERMANAGER,zn);I.register(y.POINTERMANAGER,Yn);I.register(y.EVENTMANAGER,Xn);I.register(y.LOADERMANAGER,qn);I.register(y.RESOURCEMANAGER,li);I.register(y.DATASUPPORTMANAGER,Wi);I.register(y.COMPILERMANAGER,el);I.register(y.KEYBOARDMANAGER,rl);I.register(y.ORBITCONTROLS,kn);I.register(y.TRANSFORMCONTROLS,Kn);I.register(y.AXESHELPER,sl);I.register(y.GRIDHELPER,nl);I.register(y.OBJECTHELPER,pl);I.register(y.DISPLAYMODE,ol);I.register(y.VIEWPOINT,_n);I.register(y.STATS,$n);I.register(y.SELECTION,ml);class wl extends I{constructor(){super();this.install(y.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(y.RENDERMANAGER).install(y.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(y.ORBITCONTROLS).install(y.POINTERMANAGER).install(y.EVENTMANAGER).complete()}}class Tl extends I{constructor(){super();this.install(y.RENDERMANAGER).install(y.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(y.POINTERMANAGER).install(y.EVENTMANAGER).install(y.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(y.SELECTION).install(y.AXESHELPER).install(y.GRIDHELPER).install(y.OBJECTHELPER).install(y.VIEWPOINT).install(y.DISPLAYMODE).install(y.STATS).install(y.ORBITCONTROLS).install(y.KEYBOARDMANAGER).install(y.TRANSFORMCONTROLS).complete()}}const Er=new Ur("rgb(255, 255, 255)",.5,200,1);Er.position.set(-30,5,20);Er.castShadow=!0;const $t=new je(new ot(80,2,80),new Br({color:"rgb(255, 255, 255)"}));$t.position.set(0,-11,0);$t.receiveShadow=!0;$t.castShadow=!0;const Me=class{constructor(e){i(this,"material"),i(this,"dom"),i(this,"renderer"),i(this,"scene"),i(this,"camera"),i(this,"object");const t=new Rt({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=Kr;const r=new te,s=new ee(45,window.innerWidth/window.innerHeight,1,500);s.position.set(0,0,35),s.up.x=0,s.up.y=1,s.up.z=0,s.lookAt(new A(0,0,0)),r.add(Me.ambientLight),r.add(Me.pointLight),r.add(Me.plane),this.scene=r,this.renderer=t,this.camera=s,this.object=new $e,(e==null?void 0:e.material)&&this.setMaterial(e.material),(e==null?void 0:e.dom)&&this.setDom(e.dom)}setMaterial(e){if(this.scene.remove(this.object),this.material=e,e.type.includes("Mesh"))this.object=new je(Me.geometry,e);else if(e.type.includes("Line"))this.object=new at(Me.geometry,e);else if(e.type.includes("Ponits"))this.object=new Ge(Me.geometry,e);else if(e.type.includes("Sprite"))this.object=new Ne(e);else return console.warn(`material displayer can not support this type material: '${e.type}'`),this;return this.object.castShadow=!0,this.object.receiveShadow=!0,this.scene.add(this.object),this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("material displayer must set dom before setSize with empty parameters"),this;const r=this.dom;this.camera.aspect=r.offsetWidth/r.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(r.offsetWidth,r.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(e){return this.renderer.domElement.toDataURL(e||"image/png")}dispose(){this.renderer.dispose()}};let St=Me;i(St,"ambientLight",new it("rgb(255, 255, 255)",.7));i(St,"pointLight",Er);i(St,"geometry",new Nr(10,12,12));i(St,"plane",$t);i(St,"dispose",()=>{Me.geometry.dispose(),Me.plane.geometry.dispose()});const Rs=class{constructor(e){i(this,"dom"),i(this,"texture"),i(this,"renderer"),i(this,"scene"),i(this,"camera");const t=new Rt({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=Kr;const r=new te,s=new ee(45,window.innerWidth/window.innerHeight,1,500);s.position.set(0,0,35),s.up.x=0,s.up.y=1,s.up.z=0,s.lookAt(new A(0,0,0)),r.add(Rs.ambientLight),this.scene=r,this.renderer=t,this.camera=s,(e==null?void 0:e.texture)&&this.setTexture(e.texture),(e==null?void 0:e.dom)&&this.setDom(e.dom)}setTexture(e){return this.scene.background=e,this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("texture displayer must set dom before setSize with empty parameters"),this;const r=this.dom;this.camera.aspect=r.offsetWidth/r.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(r.offsetWidth,r.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(e){return this.renderer.domElement.toDataURL(e||"image/png")}dispose(){this.renderer.dispose()}};let gl=Rs;i(gl,"ambientLight",new it("rgb(255, 255, 255)",1));class ws extends I{constructor(t={},r={}){super();i(this,"IS_ENGINESUPPORT",!0),this.install(y.LOADERMANAGER).install(y.RESOURCEMANAGER,{resources:r}).install(y.POINTERMANAGER).install(y.EVENTMANAGER).install(y.RENDERMANAGER).install(y.DATASUPPORTMANAGER,t).install(y.COMPILERMANAGER)}loadLifeCycle(t){const r=this.dataSupportManager;t.texture&&r.load({texture:t.texture}),t.material&&r.load({material:t.material}),delete t.texture,delete t.material,r.load(t)}removeLifeCycle(t){const r=this.dataSupportManager,s=t[m.TEXTURE]||{},n=t[m.MATERIAL]||{},o=t.assets||[];delete t.texture,delete t.material,delete t.assets,r.remove(t),r.remove({[m.MATERIAL]:n}),r.remove({[m.TEXTURE]:s});const a=this.resourceManager,c=this.loaderManager;o.forEach(d=>{a.remove(d),c.remove(d)})}loadConfig(t,r){const s=this.renderManager.hasRendering();if(s&&this.renderManager.stop(),t.assets&&t.assets.length){const n=o=>{delete t.assets,this.loadLifeCycle(t),this.resourceManager.removeEventListener("mapped",n),r&&r(o),s?this.renderManager.play():this.renderManager.render()};this.resourceManager.addEventListener("mapped",n),this.loaderManager.reset().load(t.assets)}else this.loadLifeCycle(t),r&&r(),s?this.renderManager.play():this.renderManager.render();return this}loadConfigAsync(t){return new Promise((r,s)=>{const n=this.renderManager.hasRendering();if(n&&this.renderManager.stop(),t.assets&&t.assets.length){const o=a=>{delete t.assets,this.loadLifeCycle(t),this.resourceManager.removeEventListener("mapped",o),n?this.renderManager.play():this.renderManager.render(),r(a)};this.resourceManager.addEventListener("mapped",o),this.loaderManager.reset().load(t.assets)}else this.loadLifeCycle(t),n?this.renderManager.play():this.renderManager.render(),r(void 0)})}removeConfig(t){this.removeLifeCycle(t)}getObjectConfig(t){const r=this.getObjectSymbol(t);return r?this.getConfigBySymbol(r):null}}class Cl extends ws{constructor(t){super(t);i(this,"IS_ENGINESUPPORT",!0),this.install(y.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(y.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(y.SELECTION).install(y.AXESHELPER).install(y.GRIDHELPER).install(y.OBJECTHELPER).install(y.VIEWPOINT).install(y.DISPLAYMODE).install(y.STATS).install(y.ORBITCONTROLS).install(y.KEYBOARDMANAGER).install(y.TRANSFORMCONTROLS).complete()}}class xl extends ws{constructor(t){super(t);this.install(y.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(y.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(y.ORBITCONTROLS).complete()}}class El{constructor(t){i(this,"visible",!0),t.visible&&(this.visible=t.visible)}}class Ol extends El{constructor(t){super(t);i(this,"source"),i(this,"target"),i(this,"mode"),i(this,"cacheSourceMatrix"),i(this,"cacheTargetMatrix"),i(this,"cacheSoruceGeometryUuid"),i(this,"cacheTargetGeometryUuid"),i(this,"originalGeometry"),i(this,"modifiedGeometry"),this.source=t.source,this.target=t.target,this.mode=t.mode||"subtract",this.cacheSourceMatrix=this.source.matrix.clone(),this.cacheTargetMatrix=this.target.matrix.clone(),this.cacheSoruceGeometryUuid=this.source.geometry.uuid,this.cacheTargetGeometryUuid=this.target.geometry.uuid,this.originalGeometry=this.source.geometry,this.modifiedGeometry=new J,this.modify(),this.source.geometry=this.modifiedGeometry}async modify(){const t=this.source,r={geometry:this.originalGeometry,matrix:this.source.matrix},s=sr.fromMesh(r),n=sr.fromMesh(this.target),o=sr.toGeometry(s[this.mode](n),t.matrix);this.modifiedGeometry.copy(o),this.modifiedGeometry.uuid=o.uuid}render(){if(this.visible){if(!this.cacheSourceMatrix.equals(this.source.matrix)){this.modify(),this.cacheSourceMatrix.copy(this.source.matrix);return}if(!this.cacheTargetMatrix.equals(this.target.matrix)){this.modify(),this.cacheTargetMatrix.copy(this.target.matrix);return}if(this.originalGeometry.uuid!==this.cacheSoruceGeometryUuid){this.modify(),this.cacheSoruceGeometryUuid=this.originalGeometry.uuid;return}if(this.target.geometry.uuid!==this.cacheTargetGeometryUuid){this.modify(),this.cacheTargetGeometryUuid=this.target.geometry.uuid;return}}else this.modifiedGeometry.copy(this.originalGeometry)}apply(){this.originalGeometry.copy(this.modifiedGeometry),this.originalGeometry.uuid=this.modifiedGeometry.uuid,this.source.geometry=this.originalGeometry}dispose(){this.source.geometry=this.originalGeometry,this.modifiedGeometry.dispose()}}class Ll{next(){console.warn(`this action can not set next function: ${this.constructor.name}`)}prev(){console.warn(`this action can not set prev function: ${this.constructor.name}`)}}class Al{constructor(t){i(this,"actionList",[]),i(this,"index",-1),i(this,"step",50),this.step=t||50}do(t){this.actionList[this.index][t]()}apply(t,r=!1){const s=this.actionList;this.index===s.length-1&&s.length>=this.step?(s.shift(),this.index=this.actionList.length-1):this.index!==-1?s.splice(this.index+1,s.length-1):this.index===-1&&(this.actionList=[]),this.actionList.push(t),r?this.redo():this.index+=1}redo(){if(this.index+=1,this.index>this.actionList.length-1){this.index=this.actionList.length-1;return}this.do("next")}undo(){this.index<0||(this.do("prev"),this.index-=1)}clear(){this.actionList=[]}}const yl="0.2.0";window.__THREE__||console.error("vis-three dependent on three.js module, pleace run 'npm i three' first.");window.__VIS__?console.warn("Duplicate vis-three frames are introduced"):window.__VIS__=yl;te.prototype.add=function(...e){if(!arguments.length)return this;if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.add(arguments[r]);return this}const t=e[0];if(t===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this;if(t&&t.isObject3D){if(t.parent!==null){const r=this.children.indexOf(t);r!==-1&&(t.parent=null,this.children.splice(r,1),t.dispatchEvent({type:"removed"}))}t.parent=this,this.children.push(t),t.dispatchEvent({type:"added"})}else console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e);return this};const Sl=te.prototype.add,Ml=te.prototype.remove;te.prototype.add=function(...e){return Sl.call(this,...e),this.dispatchEvent({type:"afterAdd",objects:e}),this};te.prototype.remove=function(...e){return Ml.call(this,...e),this.dispatchEvent({type:"afterRemove",objects:e}),this};const yr=new Ln(new Ie(-256,256,256,-256));yr.autoUpdate=!1;yr.needsUpdate=!1;it.prototype.shadow=yr;export{Ll as A,Ol as B,yt as C,xl as D,N as E,gs as G,Al as H,Rl as J,tl as K,Ei as L,Cl as M,dr as P,ci as R,gr as S,pi as T,mt as V,Tl as a,m as b,Jn as c,St as d,gl as e,wl as f,G as g,I as h,l as i,ms as j,il as k,al as l,cl as m,qe as n,Z as o,j as p};
